<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.wddyxd.productservice.mapper.ProductMapper"> <!-- 替换为你的实际包路径 -->

    <resultMap id="ProductProfileMap" type="com.wddyxd.productservice.pojo.VO.ProductProfileVO">
        <id column="id" property="id"/>
        <result column="product_category_name" property="productCategoryName"/>
        <result column="product_sku_name" property="productSkuName"/>
        <result column="user_id" property="userId"/>
        <result column="username" property="username"/>
        <result column="product_name" property="productName"/>
        <result column="price" property="price"/>
        <result column="stock" property="stock"/>
        <result column="sales" property="sales"/>
        <result column="positive_comment" property="positiveComment"/>
        <result column="negative_comment" property="negativeComment"/>
        <result column="logo" property="logo"/>
        <result column="status" property="status"/>
        <result column="create_time" property="createTime"/>
        <result column="update_time" property="updateTime"/>
        <result column="is_deleted" property="isDeleted"/>
    </resultMap>

    <select id="getPageProductProfileVO" resultMap="ProductProfileMap">
        SELECT
        p.id,
        pc.name AS product_category_name,
        ps.specs AS product_sku_name,
        p.user_id,
        u.username,
        p.name AS product_name,
        ps.price,
        p.stock,
        p.sales,
        p.positiveComment AS positive_comment,
        p.negativeComment AS negative_comment,
        ps.logo,
        p.status,
        p.create_time,
        p.update_time,
        p.is_deleted
        FROM
        product p
        LEFT JOIN product_category pc ON p.category_id = pc.id AND pc.is_deleted = 0
        LEFT JOIN product_sku ps ON p.product_sku_id = ps.id AND ps.is_deleted = 0
        LEFT JOIN user u ON p.user_id = u.id AND u.is_deleted = 0 AND u.status = 0
        <if test="search != null and search != ''">
            AND p.name LIKE CONCAT('%', #{search}, '%')
        </if>
    </select>

</mapper>