# 计划经济分配机----名字待定

&gt; 为什么是这个名字而不是说某某某系统某某某平台名字呢？  
&gt; 因为我还没想到好名字……也有可能做着做着就改需求了。

---

## 背景

九月末，有人找到我说学校的选修课不满足他们的个性化要求，学生由于信息差选不到如意的选修课，想委托我做一个类似虎扑的网站去打挑战杯。  
经过调研，发现委托的网站创新性不足、难以落地和竞争，于是对方打消了想法。  
但我之前答应过要做一个网站，正好自己十月也打算“搓”一个，于是决定：  
**做一个拼多多性质的低仿版，暂定名《计划经济分配机》。**

---

## 项目定位

- **比赛向？**  
  偏应用、非创新，打挑战杯肯定不行，也没有人脉落地。  
  索性做成**非盈利、非官方、纯练手**的项目。

- **目的**
    1. 兑现帮别人“拿到网站”的承诺。
    2. 用**全栈闭环**（架构→原型→接口→模型→前后端→部署）给自己刷简历。

- **程度**  
  后端业务尽量按企业级抠，前台 UI 能跑就行。  
  技术栈不局限于 SpringBoot + Vue，必须上微服务、集群、多级缓存。

---

## 技术栈（已落地）

| 层级 | 选型                                                                         |
|----|----------------------------------------------------------------------------|
| 前端 | Vue + ElementUI                                                            |
| 后端 | SpringBoot、MyBatis、SpringCloud、SpringSecurity、RabbitMQ、Elasticsearch、Redis |
| 运维 | Docker、ApiFox                                                              |

---

## 已完成业务

- 用户模块
    - 账号密码认证授权
    - 多角色 CRUD 与动态路由
    - 登录后每次刷新全站拉最新个人信息

---

## 关键决策 & 踩坑纪实

1. **帖子业务选型**  
   拼多多的业务逻辑：

2. **单体 or 微服务？**  
   练手项目必须**微服务 + 集群部署 + 多级缓存**，否则缺少挑战性。

3. **认证方案**  
   抛弃纯 Session，在**JWT + RBAC + Redis**基础上再套 SpringSecurity，中期加验证码登录，后期考虑 OAuth2。

4. **项目启动**
    - 模块依赖、版本冲突、IDEA 更新、文件夹权限、破解插件连环坑。
    - 从 SpringBoot 2.x 照搬依赖被“教做人”，最后按 Spring Cloud 2023.0.x 官方兼容表重新整理。

5. **RBAC + Security 落地**
    - 先设计用户-角色-权限表，写接口造数据。
    - 接入 Swagger，搓 security 模块，解决 bug 后先接入 user 服务。
    - 实现**全服务单点登录**与**跨服务授权调用**，后端脚手架第一阶段完成。

6. **前端脚手架**
    - 0 基础现学 Vue3 + ES6 一周。
    - 参考优秀项目源码后发现：  
      – 权限表需简化，用户表需扩充。  
      – 后台用**静态路由 + 路由守卫 + 按钮级权限**比纯动态路由性价比更高。
    - 最终实现：后台动态路由、分页搜索（未接 ES）、前台静态路由。

7. **Security 进阶**
    - 只存 userId 到 Token，雪花算法生成 ID，非对称加密签 Token。
    - Redis 存 **Token ↔ UserInfo 多对一**，支持**多端登录**（最多 3  Token），统一过期时间 30 min，访问即续期，Lua 脚本保证原子性。
    - 权限变动时同步刷 Redis。
    - 把各服务的 UserDetailsService 全部收拢到 security 模块，解决远程调用无法序列化问题；网关层面对外屏蔽验证接口。

8. **异常体系**
    - 过滤器链外抛的异常无法被 @ControllerAdvice 捕获，啃源码后自定义 AuthenticationEntryPoint / AccessDeniedHandler，统一错误返回。

9. **部署 & 重构**
    - 统一 JDK 版本，解决打包与服务调用不匹配，成功上云。
    - 捋清过滤器链，完成日志、连接池配置。
    - 跳过 Lua 并发优化与前端路由优化，先出原型再补。

---

## 下一步

1. 根据原型锁定最终数据库与接口。
2. 补 Lua 脚本解决并发 Token 插入 & 性能优化。
3. 前台路由逻辑再梳理。
