# 接口文档
---
## 用户模块 user-service
### 认证相关接口 AuthController
#### 用户登录接口
##### 基础信息
- **接口名称**: 用户登录
- **接口路径**: `/api/user/auth/login`
- **请求方法**: POST
- **接口权限**:任何用户可访问
- **接口描述**: 在前端任何客户端按下登录按钮时触发,可以用用户名/手机/邮箱进行密码登录,
- 同时可以用手机或邮箱进行验证码登录,通用在用户端,商户端和管理端,
- 需要标明是用密码还是验证码登录,需要标明是在哪个端登录,需要获取用户的IP和设备,
- 登录成功后返回token,token有效时间是7天,
- **接口实现**:前端传入UserLoginForm,然后这个请求被springSecurity过滤器链捕捉,在被判断是登录接口后被TokenLoginFilter拦截后,从HttpRequest解析表单数据并判断登录的类型并加工表单.
- 加工完成后被LoginAuthenticationToken包装并交给AuthenticationManager的实现类链AuthenticationProvider,
- AuthenticationProvider根据LoginAuthenticationToken包装的数据调用不同的UserDetailService来获取用户信息,
- 调用远程接口AuthController的相关方法,首先从redis拿,拿不到就去mysql拿. 并包装到UserDetail的实现类,
- 然后在密码加工(目前用MD5加工密码)比较器判断密码/验证码是否吻合,最后回到TokenLoginFilter来生成token(用对称加密生成)
- token包装用户id,timestamp,ip,device并设置7天有效期,一个用户支持3个token实现最多三个设备登录.
- 然后将用户信息保存到redis14天有效期,最后给前端返回token.
##### 请求参数
###### 请求头
| 参数名             | 是否必填      | 数据类型   | 说明                          | 示例                                        |
|-----------------|-----------|--------|-----------------------------|-------------------------------------------|
| Content-Type    | 是         | string | 请求体类型                       | application/json                          |
| User-Agent      | 否         | string | 客户端设备及浏览器信息                 | Mozilla/5.0 (Windows NT 10.0; Win64; x64) |
| X-Real-IP       | 否（由代理层传递） | string | 客户端公网 IP（通常由 Nginx 等反向代理设置） | 220.181.38.148                            |
| X-Forwarded-For | 否（由代理层传递） | string | 经过代理的客户端 IP 链               | 220.181.38.148, 10.0.0.1                  |
| X-Local-IP      | 否         | string | 客户端局域网 IP（前端自定义传递）          | 192.168.1.100                             |

###### 请求体
| 参数名       | 是否必填        | 数据类型   | 说明    | 示例                  |
|-----------|-------------|--------|-------|---------------------|
| id        | 否           | Long   | id    | 1984531291470573570 |
| username  | 绑定loginType | string | 用户名   | admin               |
| phone     | 绑定loginType | string | 手机号   | 13800000000         |
| email     | 绑定loginType | string | 邮箱    | 111111111@qq.com    |
| password  | 绑定loginType | string | 密码    | 123456              |
| phoneCode | 绑定loginType | string | 手机验证码 | 123456              |
| emailCode | 绑定loginType | string | 邮箱验证码 | 123456              |
| loginType | 是           | string | 登录类型  | password            |
| client    | 是           | string | 客户端   | user                |


##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 401: 用户名或密码错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
  }
}
```
#### 用户登录接口的密码登录接口
##### 基础信息
- **接口名称**: 密码登录
- **接口路径**: `/api/user/auth/passwordSecurityGetter/{username}`
- **请求方法**: GET
- **接口权限**:任何用户可访问,但不能通过网关访问
- **接口描述**: 在用户登录接口触发时如果登录类型为password则触发,可以用用户名/手机/邮箱根据密码获取用户信息,
- 得到用户信息后返回UserDetail对象
- **接口实现**:PasswordUserDetailServiceImpl调用该接口,调用数据库得到用户基本信息来得到密码,然后从redis得到用户信息,
- 拿不到就去mysql拿. 包装到UserDetail的实现类SecurityUser并返回
##### 请求参数
###### 请求头
| 参数名             | 是否必填      | 数据类型   | 说明                          | 示例                                        |
|-----------------|-----------|--------|-----------------------------|-------------------------------------------|
| Content-Type    | 是         | string | 请求体类型                       | application/json                          |

###### 请求体
| 参数名       | 是否必填 | 数据类型   | 说明    | 示例                  |
|-----------|------|--------|-------|---------------------|
| username  | 是    | string | 用户名   | admin               |


##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 401: 用户名或密码错误
- 500: 服务器错误
- 
###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "loginUserForm": {
      "id": 1,
      "username": "wddyxd",
      "password": "202cb962ac59075b964b07152d234b70",
      "phone": "15626448742",
      "phoneCode": null,
      "email": "www778005729@qq.com",
      "emailCode": null,
      "loginType": null,
      "client": null
    },
    "currentUserInfo": {
      "id": 1,
      "username": "wddyxd",
      "nickName": "wddyxd",
      "avatar": "",
      "roles": [
        "ROLE_SUPER_ADMIN"
      ],
      "permissionValueList": [
        "user.add",
        "user.update",
        "user.list",
        "user.remove"
      ]
    }
  }
}
```
#### 用户登出接口
##### 基础信息
- **接口名称**: 用户登录
- **接口路径**: `/api/user/auth/logout`
- **请求方法**: POST
- **接口权限**:任何已登录用户可访问
- **接口描述**: 按下登出按钮后触发,然后删除redis中的token信息
- **接口实现**:在TokenLogoutHandler删除redis中的token信息然后返回空结果
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体
| 参数名  | 是否必填 | 数据类型 | 说明   | 示例   |
|------|------|------|------|------|
| null | null | null | null | null |


##### 响应数据
###### 响应状态码
- 200: 请求成功
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "message": "操作成功",
  "data": null
}
```

#### 获取手机验证码接口
##### 基础信息
- **接口名称**: 获取手机验证码
- **接口路径**: `/api/user/auth/phoneCode`
- **请求方法**: POST
- **接口权限**:任何用户可访问
- **接口描述**: 获取手机验证码接口,前端设置用户60秒访问一次
- **接口实现**:- 获取手机号,判断合法性后发送手机验证码,同时要根据手机号对接口进行基于 Redis 的计数器限流,
- 可以用短信服务商 API 将验证码发送给用户,但这里简化为后端生成并打印随机验证码,
- 同一手机号在验证码有效期内重复请求，可直接返回成功(幂等性问题),
- 验证码保存在redis中,过期时间为5分钟
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |

###### 请求体
| 参数名              | 是否必填                    | 数据类型   | 说明       | 示例                   |
|------------------|-------------------------|--------|----------|----------------------|
| phone            | 是                       | string | 手机号      | 15626448742          |

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "message": "操作成功",
  "data": null
}
```

#### 获取邮箱验证码接口
##### 基础信息
- **接口名称**: 获取邮箱验证码
- **接口路径**: `/api/user/auth/emailCode`
- **请求方法**: POST
- **接口权限**:任何用户可访问
- **接口描述**: 获取邮箱验证码接口,前端设置用户60秒访问一次
- **接口实现**:- 获取邮箱,判断合法性后发送邮箱验证码,同时要根据邮箱对接口进行基于 Redis 的计数器限流,
- 可以用第三方邮箱服务商将验证码发送给用户,但这里简化为编写邮箱发送工具类,根据SMTP协议发送验证码,
- 同一邮箱在验证码有效期内重复请求，可直接返回成功(幂等性问题),
- 验证码保存在redis中,过期时间为5分钟
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |

###### 请求体
| 参数名   | 是否必填 | 数据类型   | 说明 | 示例                 |
|-------|------|--------|----|--------------------|
| email | 是    | string | 邮箱 | 15626448742@qq.com |

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "message": "操作成功",
  "data": null
}
```


- (注册业务备注: 如果用户先成为了管理者就只能让超级管理者手动分配该管理者为其他角色,
- 如果之前不存在注册表单描述的用户将会在检测账号合法性后添加账号,并根据注册的客户端分配不同角色,
- 如果注册时发现表单描述的账户有另一个客户端的角色则额外分配另一个角色
- 如果已存在的用户不是管理者但需要成为管理者则需要超级管理员分配该用户为管理者)
#### 用户端用户注册接口
##### 基础信息
- **接口名称**: 用户注册
- **接口路径**: `/api/user/auth/customUserRegister`
- **请求方法**: POST
- **接口权限**:任何用户可访问
- **接口描述**: 用户端的注册接口,
- 需要判断用户名,手机号或邮箱是否已存在,如果都为null则注册成功,
- 然后分配ROLE_NEW_USER角色,创建user表,关联user_role表,创建user_detail表,
- 否则返回错误
- **接口实现**:得到参数后分别根据用户名,手机号和邮箱获取user表的一条数据,
- 如果三份数据都是null则注册用户,分配ROLE_NEW_USER角色,创建user表,关联user_role表,创建user_detail表并填充默认数据
- 其他情况返回错误
- 其中,用加密算法(这里用MD5)加密密码,同时将事先存储到redis的phoneCode和emailCode提取来验证手机和邮箱的有效性
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |

###### 请求体
| 参数名              | 是否必填                    | 数据类型   | 说明       | 示例                   |
|------------------|-------------------------|--------|----------|----------------------|
| username         | 是                       | string | 用户名      | wddyxd               |
| phone            | 是                       | string | 手机号      | 15626448742          |
| phoneCode        | 是                       | string | 手机验证码    | 123456               |
| email            | 是                       | string | 邮箱       | 15626448742@qq.com   |
| emailCode        | 是                       | string | 邮箱验证码    | 123456               |
| password         | 是                       | string | 密码       | 123456               |

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 40?: 用户已存在
- 40?: 手机验证码错误
- 40?: 邮箱验证码错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "message": "操作成功",
  "data": null
}
```

#### 商户端商户注册接口
##### 基础信息
- **接口名称**: 商户端商户注册
- **接口路径**: `/api/user/auth/merchantRegister`
- **请求方法**: POST
- **接口权限**:任何用户可访问
- **接口描述**: 商户端的注册接口,
- 要判断用户名,手机号或邮箱是否已存在,如果都为null则调用用户端注册接口
- 如果存在不指向同一个用户的情况则返回错误,
- 如果指向同一个用户则判断有没有商户相关角色,如果有则返回错误,否则分配ROLE_NEW_MERCHANT角色并创建merchant_supplement表
- **接口实现**:得到参数后分别根据用户名,手机号和邮箱获取user表的一条数据,
- 如果三份数据都是null则调用用户端注册接口
- 如果三份数据都指向同一个用户而且没有被分配商户相关角色则将该用户分配ROLE_NEW_MERCHANT角色,
- 其他情况返回错误
- 其中,用加密算法(这里用MD5)加密密码,同时将事先存储到redis的phoneCode和emailCode提取来验证手机和邮箱的有效性
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |

###### 请求体
| 参数名              | 是否必填 | 数据类型    | 说明       | 示例                   |
|------------------|------|---------|----------|----------------------|
| username         | 是    | string  | 用户名      | wddyxd               |
| phone            | 是    | string  | 手机号      | 15626448742          |
| phoneCode        | 是    | string  | 手机验证码    | 123456               |
| email            | 是    | string  | 邮箱       | 15626448742@qq.com   |
| emailCode        | 是    | string  | 邮箱验证码    | 123456               |
| password         | 是    | string  | 密码       | 123456               |
| shopName         | 是    | string  | 商户名      | 广文书店                 |
| shopCategoryId   | 是    | Integer | 商户类别id   | 1                    |
| shopAddress      | 是    | string  | 商户地址     | 广东汕头濠江区达濠街道西元大盘1010号 |
| shopLicense      | 是    | string  | 商户营业执照   | 123456               |
| shopLicenseImage | 是    | string  | 商户营业执照图片 | 123456               |



##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 40?: 用户已存在
- 40?: 手机验证码错误
- 40?: 邮箱验证码错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "message": "操作成功",
  "data": null
}
```

#### 根据验证码找回密码接口
##### 基础信息
- **接口名称**: 根据验证码找回密码
- **接口路径**: `/api/user/auth/updatePasswordByCode`
- **请求方法**: POST
- **接口权限**: 任何用户可访问
- **接口描述**: 支持根据手机验证码或邮箱验证码找回密码
- **接口实现**: 如果type=phoneCode则需要手机和验证码和新密码,后端会判断手机和验证码是否合法且吻合.
- 成功更改密码后时redis存储5秒过期的时间戳,过期时间内不能重新更改密码,更改密码后强制在redis的当前用户的token删除

##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |

###### 请求体
| 参数名         | 是否必填 | 数据类型   | 说明    | 示例                  |
|-------------|------|--------|-------|---------------------|
| type        | 是    | String | 验证码类型 | phoneCode/emailCode |
| phone       | 否    | String | 手机号   | 15626448742         |
| email       | 否    | String | 邮箱    | 15626448742@qq.com  |
| phoneCode   | 否    | String | 手机验证码 | 123456              |
| emailCode   | 否    | String | 邮箱验证码 | 123456              |
| newPassword | 是    | String | 密码    | 123456              |

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data":null
}
```



### 用户相关接口 UserController
#### 分页获取用户列表接口
##### 基础信息
- **接口名称**: 分页获取用户列表
- **接口路径**: `/api/user/user/list`
- **请求方法**: GET
- **接口权限**:需要user.list权限
- **接口描述**: 在管理员的用户管理主界面查看所有用户
- **接口实现**: 在管理员的用户管理主界面查看所有用户,支持根据关键字搜索,
- 如果不接入elasticsearch则在mysql为用户名,手机,邮箱,昵称建立索引以支持关键字搜索
- 返回List<UserProfileVO>并由PageResult包装,对敏感信息进行脱敏处理
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |


###### 请求体
| 参数名      | 是否必填    | 数据类型    | 说明    | 示例  |
|----------|---------|---------|-------|-----|
| pageNum  | 否(默认1)  | Integer | 页码    | 1   |
| pageSize | 否(默认10) | Integer | 每页数据量 | 10  |
| search   | 否(默认"") | string  | 关键字   | abc |


##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "records": [
      {
        "id": 1,
        "username": "wddyxd",
        "phone": "156****8742",
        "email": "www********@qq.com",
        "nickName": "wddyxd",
        "avatar": "",
        "status": 0,
        "createTime": "2025-10-21T12:17:56.000+00:00",
        "updateTime": "2025-10-21T12:18:00.000+00:00",
        "deleted": false
      }
    ],
    "total": 1,
    "size": 10,
    "current": 1,
    "pages": 1
  }
}
```

#### 获取个人用户详细信息接口
##### 基础信息
- **接口名称**: 获取个人用户详细信息
- **接口路径**: `/api/user/user/userDetail/{id}`
- **请求方法**: GET
- **接口权限**:需要user.list权限或者访问者的id等于参数的id
- **接口描述**: 查看用户的详细信息
- **接口实现**: 在用户端点击头像跳转到用户设置界面,后台或商户端前往个人中心,管理员在用户管理点击用户可触发该接口,查询该用户详细信息
- 返回UserDetailVO,其中必携带BasicUserDetailVO和currentUserInfo,如果是商户且在商户端额外携带MerchantDetailVO,
- 如果是管理员查看用户详细信息则额外携带userAddressVO,MerchantDetailVO,对敏感信息进行脱敏处理
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体
| 参数名    | 是否必填 | 数据类型   | 说明  | 示例  |
|--------|------|--------|-----|-----|
| id     | 是    | Long   | id  | 1   |
| client | 是    | string | 客户端 | 后台端 |


##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "basicUserDetailVO": {
      "id": 1,
      "username": "wddyxd",
      "phone": "156****8742",
      "email": "www********@qq.com",
      "nickName": "wddyxd",
      "avatar": "",
      "realName": "张三",
      "gender": 1,
      "birthday": "2005-10-21T12:17:56.000+00:00",
      "region": "上海",
      "idCard": "123456789012345678",
      "isIdCardVerified": true,
      "lastLoginTime": "2025-10-21T12:17:56.000+00:00",
      "lastLoginIp": "127.0.0.1",
      "lastLoginDevice": "Windows 11",
      "money": 1000.00,
      "status": 0
    },
    "userAddressVO": [
      {
        "id": 1,
        "receiver": "张三",
        "phone": "15626448742",
        "province": "广东",
        "city": "汕头",
        "district": "濠江",
        "address": "达濠街道西元大盘1010号",
        "isDefault": true
      }
    ],
    "currentUserInfo": {
      "id": 1,
      "username": "wddyxd",
      "nickName": "wddyxd",
      "avatar": "",
      "roles": [
        "ROLE_SUPER_ADMIN"
      ],
      "permissionValueList": [
        "user.add",
        "user.update",
        "user.list",
        "user.remove"
      ]
    },
    "merchantSupplementVO": {
      "id": 1,
      "shopName": "广文书店",
      "shopCategory": "美食",
      "shopAddress": "汕头达濠西元大盘1010号",
      "shopLicense": "xxx",
      "shopLicenseImage": "xxx",
      "shopStar": 5,
      "shopStatus": 1
      
    }
  }
}
```

#### 获取自己的认证信息接口
##### 基础信息
- **接口名称**: 获取自己的认证信息
- **接口路径**: `/api/user/user/me`
- **请求方法**: GET
- **接口权限**:用户登录后每次刷新路由访问
- **接口描述**: 获取自己的id,用户名,昵称,头像,角色,权限
- **接口实现**: 访问接口时被spring-security的过滤器链拦截,
- 其中TokenAuthFilter会解析token并根据token信息从redis获得用户信息然后将信息包装到SecurityContextHolder,
- 然后从SecurityContextHolder获得用户信息并返回CurrentUserDTO
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体
| 参数名  | 是否必填 | 数据类型 | 说明   | 示例   |
|------|------|------|------|------|
| none | none | none | none | none |


##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 401: token类的异常
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "id": 1,
    "username": "wddyxd",
    "nickName": "wddyxd",
    "avatar": "",
    "roles": [
      "ROLE_SUPER_ADMIN"
    ],
    "permissionValueList": [
      "user.add",
      "user.update",
      "user.list",
      "user.remove"
    ]
  }
}
```

#### 添加管理员接口
##### 基础信息
- **接口名称**: 添加用户
- **接口路径**: `/api/user/user/add`
- **请求方法**: GET
- **接口权限**:需要user.add权限
- **接口描述**: 在后台的用户管理中添加用户,这里的用户指的是管理员
- **接口实现**: 传入User类,然后判断用户的用户名,手机或邮箱是否被其他用户占用,
- 如果都没被占用则直接添加用户,为这个用户赋予ROLE_NEW_ADMIN角色,然后在user_detail中添加默认的用户详细信息
- 否则返回错误
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体
| 参数名         | 是否必填            | 数据类型    | 说明   | 示例                            |
|-------------|-----------------|---------|------|-------------------------------|
| id          | 否               | Long    | id   | none                          |
| username    | 是               | String  | 用户名  | wddyxd                        |
| nickName    | 否(如果否那么生成随机昵称)  | String  | 昵称   | wddyxd                        |
| phone       | 是               | String  | 手机   | 15626448742                   |
| email       | 是               | String  | 邮箱   | www********@qq.com            |
| password    | 否(如果否则生成123456) | String  | 密码   | 123456                        |
| avatar      | 否(如果否那么生成默认头像)  | String  | 头像   | http:xxx:xx/xxx/xxx/...       |
| isDeleted   | 否(默认为0)         | Boolean | 删除状态 | 0                             |
| status      | 否(默认为0)         | Integer | 状态   | 0                             |
| createdTime | 否(默认为当前时间)      | Date    | 创建时间 | 2025-10-21T12:17:56.000+00:00 |
| updatedTime | 否(默认为当前时间)      | Date    | 修改时间 | 2025-10-21T12:17:56.000+00:00 |


##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data":null
}
```

#### 通用更新用户信息接口
##### 基础信息
- **接口名称**: 更新用户信息
- **接口路径**: `/api/user/user/customUpdate`
- **请求方法**: POST
- **接口权限**: 需要user.update权限或更新者的id等于参数id
- **接口描述**: 实现了对单个用户的user表,user_detail表,merchant_supplement表的单条或关联字段数据的更新,但更新某些字段需要验证码
- **接口实现**:
- 首先要明确,敏感字段需要手机验证码,而敏感字段包括password,phone,email,shopLicense和shopLicenseImage,其他字段不需要验证码,
- 然后updateType包括:PHONE,EMAIL,PASSWORD,LICENSE(需要同时修改shopLicense和shopLicenseImage),CARD(需要同时修改realName,IdCard),
- SHOP(需要同时修改shopName,shopCategoryId和shopAddress),NICKNAME,AVATAR,GENDER,REGION.
- 根据传入的用户id来查询user,user_detail,merchant_supplement表,然后根据updateType执行对应的更新逻辑,
- 特别注意,如果updateType=CARD则只需判定身份证格式是否合法并且没有被其他用户占用后在数据库更新is_id_card_verified字段
- 后台的用户管理模块不提供更新敏感字段的按钮,更新敏感字段的按钮仅对本人开放
- 对于敏感字段,PHONE和EMAIL在数据库有唯一性约束,但密码和许可证没有,所以应该在redis记录上次修改密码或许可证的时间戳,有效期5秒,有效期内禁止修改
- username字段不参与字段更新
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体
| 参数名              | 是否必填      | 数据类型    | 说明     | 示例                            |
|------------------|-----------|---------|--------|-------------------------------|
| id               | 是         | Long    | id     | 1                             |
| updateType       | 是         | String  | 更新字段类型 | phone                         |
| code             | 否(敏感数据须填) | String  | 验证码    | 123456                        |
| nickName         | 否         | String  | 昵称     | wddyxd                        |
| phone            | 否         | String  | 手机     | 15626448742                   |
| email            | 否         | String  | 邮箱     | www********@qq.com            |
| oldPassword      | 否         | String  | 旧密码    | 123456                        |
| newPassword      | 否         | String  | 密码     | 123456                        |
| avatar           | 否         | String  | 头像     | http:xxx:xx/xxx/xxx/...       |
| realName         | 否         | String  | 真实姓名   | 张三                            |
| gender           | 否         | Integer | 性别     | 1                             |
| birthday         | 否         | Date    | 生日     | 2005-10-21T12:17:56.000+00:00 |
| region           | 否         | String  | 地区     | 上海                            |
| idCard           | 否         | String  | 身份证号   | 123456789012345678            |
| shopName         | 否         | String  | 店铺名称   | 广文书店                          |
| shopCategoryId   | 否         | String  | 店铺类别   | 美食                            |
| shopAddress      | 否         | String  | 店铺地址   | 汕头达濠西元大盘1010号                 |
| shopLicense      | 否         | String  | 营业执照   | xxx                           |
| shopLicenseImage | 否         | String  | 营业执照图片 | xxx                           |

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data":null
}
```

#### 删除用户接口
##### 基础信息
- **接口名称**: 删除用户
- **接口路径**: `/api/user/user/delete`
- **请求方法**: DELETE
- **接口权限**:需要user.delete权限
- **接口描述**: 只有管理员有权限删除用户,普通用户要注销需要将注销请求发送给管理员
- **接口实现**:- 在删除账户之前在redis查看上次删除该用户的时间戳如果存在则直接返回,
- 否则要须保证该该账户存在且该账户不存在状态为已付款,待发货,待收货的订单,然后调用商户端的删除商户接口,然后将用户的充值和领取的优惠券退还,
- 然后将唯一约束字段(都是varchar字段)修改成 "用户ID+DELETED+删除时间戳:原先字段"的格式,然后将user,user_detail,user_address表的相关字段逻辑删除
- 然后在redis添加本次删除的时间戳,然后返回被删除用户的id
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体
| 参数名         | 是否必填 | 数据类型    | 说明   | 示例                            |
|-------------|------|---------|------|-------------------------------|
| id          | 是    | Long    | id   | none                          |


##### 响应数据
###### 响应状态码
- 200: 删除成功
- 400: 请求参数错误
- 403: 权限不足（非管理员）
- 404: 用户不存在
- 409: 存在未完成订单，无法删除
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data":{
    "id": 11232439947510
  }
}
```

### 商户相关接口 MerchantSupplementController
