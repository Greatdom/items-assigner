# 接口文档
---
## 用户模块 user-service

### 认证相关接口 AuthController

#### 用户登录接口
##### 基础信息
- **接口名称**: 用户登录
- **接口路径**: `/api/user/auth/login`
- **请求方法**: POST
- **接口权限**:任何用户可访问
- **接口描述**: 在前端任何客户端按下登录按钮时触发,可以用用户名/手机/邮箱进行密码登录,
- 同时可以用手机或邮箱进行验证码登录,通用在用户端,商户端和管理端,
- 需要标明是用密码还是验证码登录,需要获取用户的IP和设备,
- 登录成功后返回token,token有效时间是7天,
- **接口实现**:前端传入UserLoginForm,然后这个请求被springSecurity过滤器链捕捉,在被判断是登录接口后被TokenLoginFilter拦截后,从HttpRequest解析表单数据并判断登录的类型并加工表单.
- 加工完成后被LoginAuthenticationToken包装并交给AuthenticationManager的实现类链AuthenticationProvider,
- AuthenticationProvider根据LoginAuthenticationToken包装的数据调用不同的UserDetailService来获取用户信息,
- 调用远程接口AuthController的相关方法,首先从redis拿,拿不到就去mysql拿. 并包装到UserDetail的实现类,
- 然后在密码加工(目前用MD5加工密码)比较器判断密码/验证码是否吻合,最后回到TokenLoginFilter来生成token(用对称加密生成)
- token包装用户id,timestamp,ip,device并设置7天有效期,一个用户支持3个token实现最多三个设备登录.
- 然后将用户信息保存到redis14天有效期,最后给前端返回token.
##### 请求参数
###### 请求头
| 参数名             | 是否必填      | 数据类型   | 说明                          | 示例                                        |
|-----------------|-----------|--------|-----------------------------|-------------------------------------------|
| Content-Type    | 是         | string | 请求体类型                       | application/json                          |
| User-Agent      | 否         | string | 客户端设备及浏览器信息                 | Mozilla/5.0 (Windows NT 10.0; Win64; x64) |
| X-Real-IP       | 否（由代理层传递） | string | 客户端公网 IP（通常由 Nginx 等反向代理设置） | 220.181.38.148                            |
| X-Forwarded-For | 否（由代理层传递） | string | 经过代理的客户端 IP 链               | 220.181.38.148, 10.0.0.1                  |
| X-Local-IP      | 否         | string | 客户端局域网 IP（前端自定义传递）          | 192.168.1.100                             |

###### 请求体
| 参数名       | 是否必填        | 数据类型   | 说明    | 示例                  |
|-----------|-------------|--------|-------|---------------------|
| id        | 否           | Long   | id    | 1984531291470573570 |
| username  | 绑定loginType | string | 用户名   | admin               |
| phone     | 绑定loginType | string | 手机号   | 13800000000         |
| email     | 绑定loginType | string | 邮箱    | 111111111@qq.com    |
| password  | 绑定loginType | string | 密码    | 123456              |
| phoneCode | 绑定loginType | string | 手机验证码 | 123456              |
| emailCode | 绑定loginType | string | 邮箱验证码 | 123456              |
| loginType | 是           | string | 登录类型  | password            |


##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 401: 用户名或密码错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
  }
}
```

#### 用户登录接口的密码登录接口
##### 基础信息
- **接口名称**: 密码登录
- **接口路径**: `/api/user/auth/passwordSecurityGetter/{username}`
- **请求方法**: GET
- **接口权限**:任何用户可访问,但不能通过网关访问
- **接口描述**: 在用户登录接口触发时如果登录类型为password则触发,
- 参数username指代用户名/手机/邮箱,可以用用户名/手机/邮箱获取用户信息,
- 如果用户被封禁或被删除则直接返回错误信息,
- 得到用户信息后返回UserDetail对象
- **接口实现**:PasswordUserDetailServiceImpl调用该接口,调用数据库得到用户基本信息来得到密码,先从redis得到用户信息,
- 拿不到就去mysql拿. 包装到UserDetail的实现类SecurityUser并返回
##### 请求参数
###### 请求头
| 参数名             | 是否必填      | 数据类型   | 说明                          | 示例                                        |
|-----------------|-----------|--------|-----------------------------|-------------------------------------------|
| Content-Type    | 是         | string | 请求体类型                       | application/json                          |

###### 请求体
| 参数名       | 是否必填 | 数据类型   | 说明    | 示例                  |
|-----------|------|--------|-------|---------------------|
| username  | 是    | string | 用户名   | admin               |


##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 401: 用户名或密码错误
- 500: 服务器错误
- 
###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "loginUserForm": {
      "id": 1,
      "username": "wddyxd",
      "password": "202cb962ac59075b964b07152d234b70",
      "phone": "15626448742",
      "phoneCode": null,
      "email": "www778005729@qq.com",
      "emailCode": null,
      "loginType": null
    },
    "currentUserInfo": {
      "id": 1,
      "username": "wddyxd",
      "nickName": "wddyxd",
      "avatar": "",
      "roles": [
        "ROLE_SUPER_ADMIN"
      ],
      "permissionValueList": [
        "user.add",
        "user.update",
        "user.list",
        "user.remove"
      ]
    }
  }
}
```

#### 用户登录接口的手机验证码登录接口
##### 基础信息
- **接口名称**: 手机验证码登录
- **接口路径**: `/api/user/auth/phoneCodeSecurityGetter/{phone}`
- **请求方法**: GET
- **接口权限**:任何用户可访问,但不能通过网关访问
- **接口描述**: 在用户登录接口触发时如果登录类型为phoneCode则触发,
- 参数phone指代手机,可以用手机获取用户信息和手机验证码,
- 如果用户被封禁或被删除则直接返回错误信息,
- 得到用户信息后返回UserDetail对象
- **接口实现**:PhoneCodeUserDetailServiceImpl调用该接口,调用数据库得到用户基本信息,先从redis得到用户信息,
- 拿不到就去mysql拿.最后从redis获取手机验证码,对获得的密码进行脱敏处理,包装到UserDetail的实现类SecurityUser并返回
##### 请求参数
###### 请求头
| 参数名             | 是否必填      | 数据类型   | 说明                          | 示例                                        |
|-----------------|-----------|--------|-----------------------------|-------------------------------------------|
| Content-Type    | 是         | string | 请求体类型                       | application/json                          |

###### 请求体
| 参数名   | 是否必填 | 数据类型   | 说明    | 示例          |
|-------|------|--------|-------|-------------|
| phone | 是    | string | 用户名   | 13800000001 |


##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 401: 用户名或密码错误
- 500: 服务器错误
-
###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "loginUserForm": {
      "id": 1,
      "username": "wddyxd",
      "password": "202cb9*************234b70",
      "phone": "15626448742",
      "phoneCode": 123456,
      "email": "www778005729@qq.com",
      "emailCode": null,
      "loginType": null
    },
    "currentUserInfo": {
      "id": 1,
      "username": "wddyxd",
      "nickName": "wddyxd",
      "avatar": "",
      "roles": [
        "ROLE_SUPER_ADMIN"
      ],
      "permissionValueList": [
        "user.add",
        "user.update",
        "user.list",
        "user.remove"
      ]
    }
  }
}
```

#### 用户登录接口的邮箱验证码登录接口
##### 基础信息
- **接口名称**: 手机验证码登录
- **接口路径**: `/api/user/auth/emailCodeSecurityGetter/{phone}`
- **请求方法**: GET
- **接口权限**:任何用户可访问,但不能通过网关访问
- **接口描述**: 在用户登录接口触发时如果登录类型为emailCode则触发,
- 参数email指代邮箱,可以用邮箱获取用户信息和邮箱验证码,
- 如果用户被封禁或被删除则直接返回错误信息,
- 得到用户信息后返回UserDetail对象
- **接口实现**:EmailCodeUserDetailServiceImpl调用该接口,调用数据库得到用户基本信息,先从redis得到用户信息,
- 拿不到就去mysql拿.最后从redis获取邮箱验证码,对获得的密码进行脱敏处理,包装到UserDetail的实现类SecurityUser并返回
##### 请求参数
###### 请求头
| 参数名             | 是否必填      | 数据类型   | 说明                          | 示例                                        |
|-----------------|-----------|--------|-----------------------------|-------------------------------------------|
| Content-Type    | 是         | string | 请求体类型                       | application/json                          |

###### 请求体
| 参数名   | 是否必填 | 数据类型   | 说明    | 示例                       |
|-------|------|--------|-------|--------------------------|
| email | 是    | string | 用户名   | www778005729@outlook.com |


##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 401: 用户名或密码错误
- 500: 服务器错误
-
###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "loginUserForm": {
      "id": 1,
      "username": "wddyxd",
      "password": "202cb9*************234b70",
      "phone": "15626448742",
      "phoneCode": null,
      "email": "www778005729@qq.com",
      "emailCode": 123456,
      "loginType": null
    },
    "currentUserInfo": {
      "id": 1,
      "username": "wddyxd",
      "nickName": "wddyxd",
      "avatar": "",
      "roles": [
        "ROLE_SUPER_ADMIN"
      ],
      "permissionValueList": [
        "user.add",
        "user.update",
        "user.list",
        "user.remove"
      ]
    }
  }
}
```

#### 用户登出接口
##### 基础信息
- **接口名称**: 用户登录
- **接口路径**: `/api/user/auth/logout`
- **请求方法**: POST
- **接口权限**:任何已登录用户可访问
- **接口描述**: 按下登出按钮后触发,然后删除redis中的token信息
- **接口实现**:在TokenLogoutHandler删除redis中的token信息然后返回空结果
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体
| 参数名  | 是否必填 | 数据类型 | 说明   | 示例   |
|------|------|------|------|------|
| null | null | null | null | null |


##### 响应数据
###### 响应状态码
- 200: 请求成功
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "message": "操作成功",
  "data": null
}
```

#### 获取手机验证码接口
##### 基础信息
- **接口名称**: 获取手机验证码
- **接口路径**: `/api/user/auth/phoneCode`
- **请求方法**: POST
- **接口权限**:任何用户可访问
- **接口描述**: 获取手机验证码接口,前端设置用户60秒访问一次
- **接口实现**:- 获取手机号,判断合法性后发送手机验证码,同时要根据手机号对接口进行基于 Redis 的计数器限流,
- 可以用短信服务商 API 将验证码发送给用户,但这里简化为后端生成并打印随机验证码,
- 同一手机号在验证码有效期内重复请求，可直接返回成功(幂等性问题),
- 验证码保存在redis中,过期时间为5分钟
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |

###### 请求体
| 参数名              | 是否必填                    | 数据类型   | 说明       | 示例                   |
|------------------|-------------------------|--------|----------|----------------------|
| phone            | 是                       | string | 手机号      | 15626448742          |

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "message": "操作成功",
  "data": null
}
```

#### 获取邮箱验证码接口
##### 基础信息
- **接口名称**: 获取邮箱验证码
- **接口路径**: `/api/user/auth/emailCode`
- **请求方法**: POST
- **接口权限**:任何用户可访问
- **接口描述**: 获取邮箱验证码接口,前端设置用户60秒访问一次
- **接口实现**:- 获取邮箱,判断合法性后发送邮箱验证码,同时要根据邮箱对接口进行基于 Redis 的计数器限流,
- 可以用第三方邮箱服务商将验证码发送给用户,但这里简化为编写邮箱发送工具类,根据SMTP协议发送验证码,
- 同一邮箱在验证码有效期内重复请求，可直接返回成功(幂等性问题),
- 验证码保存在redis中,过期时间为5分钟
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |

###### 请求体
| 参数名   | 是否必填 | 数据类型   | 说明 | 示例                 |
|-------|------|--------|----|--------------------|
| email | 是    | string | 邮箱 | 15626448742@qq.com |

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "message": "操作成功",
  "data": null
}
```


- (注册业务备注: 如果用户先成为了管理者就只能让超级管理者手动分配该管理者为其他角色,
- 如果之前不存在注册表单描述的用户将会在检测账号合法性后添加账号,并根据注册的客户端分配不同角色,
- 如果注册时发现表单描述的账户有另一个客户端的角色则额外分配另一个角色
- 如果已存在的用户不是管理者但需要成为管理者则需要超级管理员分配该用户为管理者)

#### 用户端用户注册接口
##### 基础信息
- **接口名称**: 用户注册
- **接口路径**: `/api/user/auth/customUserRegister`
- **请求方法**: POST
- **接口权限**:任何用户可访问
- **接口描述**: 用户端的注册接口,
- 需要判断用户名,手机号或邮箱是否已存在,如果都为null则注册成功,
- 然后分配ROLE_NEW_USER角色,创建user表,关联user_role表,创建user_detail表,
- 否则返回错误
- **接口实现**:得到参数后分别根据用户名,手机号和邮箱获取user表的一条数据,
- 如果三份数据都是null则注册用户,分配ROLE_NEW_USER角色,创建user表,关联user_role表,创建user_detail表并填充默认数据
- 其他情况返回错误
- 其中,用加密算法(这里用MD5)加密密码,同时将事先存储到redis的phoneCode和emailCode提取来验证手机和邮箱的有效性
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |

###### 请求体
| 参数名              | 是否必填                    | 数据类型   | 说明       | 示例                   |
|------------------|-------------------------|--------|----------|----------------------|
| username         | 是                       | string | 用户名      | wddyxd               |
| phone            | 是                       | string | 手机号      | 15626448742          |
| phoneCode        | 是                       | string | 手机验证码    | 123456               |
| email            | 是                       | string | 邮箱       | 15626448742@qq.com   |
| emailCode        | 是                       | string | 邮箱验证码    | 123456               |
| password         | 是                       | string | 密码       | 123456               |

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 40?: 用户已存在
- 40?: 手机验证码错误
- 40?: 邮箱验证码错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "message": "操作成功",
  "data": null
}
```

#### 商户端商户注册接口
##### 基础信息
- **接口名称**: 商户端商户注册
- **接口路径**: `/api/user/auth/merchantRegister`
- **请求方法**: POST
- **接口权限**:任何用户可访问
- **接口描述**: 商户端的注册接口,
- **接口实现**:得到参数后分别根据用户名,手机号和邮箱获取user表的一条数据,
- 如果三份数据都是null则调用用户端注册接口
- 如果三份数据都指向同一个用户而且没有被分配商户相关角色则将该用户分配ROLE_NEW_MERCHANT角色,
- 并创建merchant_supplement表,
- 其他情况返回错误
- 其中,用加密算法(这里用MD5)加密密码,同时将事先存储到redis的phoneCode和emailCode提取来验证手机和邮箱的有效性
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |

###### 请求体
| 参数名              | 是否必填 | 数据类型    | 说明       | 示例                   |
|------------------|------|---------|----------|----------------------|
| username         | 是    | string  | 用户名      | wddyxd               |
| phone            | 是    | string  | 手机号      | 15626448742          |
| phoneCode        | 是    | string  | 手机验证码    | 123456               |
| email            | 是    | string  | 邮箱       | 15626448742@qq.com   |
| emailCode        | 是    | string  | 邮箱验证码    | 123456               |
| password         | 是    | string  | 密码       | 123456               |
| shopName         | 是    | string  | 商户名      | 广文书店                 |
| shopCategoryId   | 是    | Integer | 商户类别id   | 1                    |
| shopAddress      | 是    | string  | 商户地址     | 广东汕头濠江区达濠街道西元大盘1010号 |
| shopLicense      | 是    | string  | 商户营业执照   | 123456               |
| shopLicenseImage | 是    | string  | 商户营业执照图片 | 123456               |



##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 40?: 用户已存在
- 40?: 手机验证码错误
- 40?: 邮箱验证码错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "message": "操作成功",
  "data": null
}
```

#### 根据验证码找回密码接口
##### 基础信息
- **接口名称**: 根据验证码找回密码
- **接口路径**: `/api/user/auth/updatePasswordByCode`
- **请求方法**: POST
- **接口权限**: 任何用户可访问
- **接口描述**: 支持根据手机验证码或邮箱验证码为账号找回密码
- **接口实现**: 如果type=phoneCode则需要手机和验证码和新密码,后端会判断手机和验证码是否合法且吻合.
- 成功更改密码后时redis存储5秒过期的时间戳,过期时间内不能重新更改密码,更改密码后强制在redis的当前用户的token删除

##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |

###### 请求体
| 参数名         | 是否必填 | 数据类型   | 说明    | 示例                  |
|-------------|------|--------|-------|---------------------|
| type        | 是    | String | 验证码类型 | phoneCode/emailCode |
| phone       | 否    | String | 手机号   | 15626448742         |
| email       | 否    | String | 邮箱    | 15626448742@qq.com  |
| phoneCode   | 否    | String | 手机验证码 | 123456              |
| emailCode   | 否    | String | 邮箱验证码 | 123456              |
| newPassword | 是    | String | 密码    | 123456              |

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data":null
}
```

### 用户相关接口 UserController

#### 分页获取用户列表接口
##### 基础信息
- **接口名称**: 分页获取用户列表
- **接口路径**: `/api/user/user/list`
- **请求方法**: GET
- **接口权限**:需要user.list权限
- **接口描述**: 在管理员的用户管理主界面查看所有用户
- **接口实现**: 在管理员的用户管理主界面查看所有用户,支持根据关键字搜索,
- 如果不接入elasticsearch则在mysql为用户名,手机,邮箱,昵称建立索引以支持关键字搜索
- 返回List<User>并由PageResult包装,对敏感信息进行脱敏处理
- 注意无论用户是否被逻辑删除都应该被被查到
- 
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |


###### 请求体
| 参数名      | 是否必填    | 数据类型    | 说明    | 示例  |
|----------|---------|---------|-------|-----|
| pageNum  | 否(默认1)  | Integer | 页码    | 1   |
| pageSize | 否(默认10) | Integer | 每页数据量 | 10  |
| search   | 否(默认"") | string  | 关键字   | abc |


##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "records": [
      {
        "id": 1,
        "username": "wddyxd",
        "phone": "156****8742",
        "email": "www********@qq.com",
        "nickName": "wddyxd",
        "avatar": "",
        "status": 0,
        "createTime": "2025-10-21T12:17:56.000+00:00",
        "updateTime": "2025-10-21T12:18:00.000+00:00",
        "deleted": false
      }
    ],
    "total": 1,
    "size": 10,
    "current": 1,
    "pages": 1
  }
}
```

#### 获取个人用户详细信息接口
##### 基础信息
- **接口名称**: 获取个人用户详细信息
- **接口路径**: `/api/user/user/detail/{id}`
- **请求方法**: GET
- **接口权限**:需要user.list权限或者访问者的id等于参数的id
- **接口描述**: 查看用户的详细信息,适用于后台
- **接口实现**: 在用户端点击头像跳转到用户设置界面,后台或商户端前往个人中心,管理员在用户管理点击用户可触发该接口,查询该用户详细信息
- 返回UserDetailVO,其中必携带BasicUserDetailVO和currentUserInfo,如果是商户且在商户端额外携带MerchantDetailVO,
- 如果是管理员查看用户详细信息则额外携带userAddressVO,MerchantDetailVO,对敏感信息进行脱敏处理
- 注意无论该用户是否被逻辑删除都应该被被查到
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体
| 参数名    | 是否必填 | 数据类型   | 说明  | 示例  |
|--------|------|--------|-----|-----|
| id     | 是    | Long   | id  | 1   |
| client | 是    | string | 客户端 | 后台端 |


##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "basicUserDetailVO": {
      "id": 1,
      "username": "wddyxd",
      "phone": "156****8742",
      "email": "www********@qq.com",
      "nickName": "wddyxd",
      "avatar": "",
      "realName": "张三",
      "gender": 1,
      "birthday": "2005-10-21T12:17:56.000+00:00",
      "region": "上海",
      "idCard": "123456789012345678",
      "isIdCardVerified": true,
      "lastLoginTime": "2025-10-21T12:17:56.000+00:00",
      "lastLoginIp": "127.0.0.1",
      "lastLoginDevice": "Windows 11",
      "money": 1000.00,
      "status": 0
    },
    "userAddressVO": [
      {
        "id": 1,
        "receiver": "张三",
        "phone": "15626448742",
        "province": "广东",
        "city": "汕头",
        "district": "濠江",
        "address": "达濠街道西元大盘1010号",
        "isDefault": true
      }
    ],
    "currentUserInfo": {
      "id": 1,
      "username": "wddyxd",
      "nickName": "wddyxd",
      "avatar": "",
      "roles": [
        "ROLE_SUPER_ADMIN"
      ],
      "permissionValueList": [
        "user.add",
        "user.update",
        "user.list",
        "user.remove"
      ]
    },
    "merchantSupplementVO": {
      "id": 1,
      "shopName": "广文书店",
      "shopCategory": "美食",
      "shopAddress": "汕头达濠西元大盘1010号",
      "shopLicense": "xxx",
      "shopLicenseImage": "xxx",
      "positiveComment": 10,
      "negativeComment": 0,
      "shopStatus": 1
      
    }
  }
}
```

#### 用户概要接口
##### 基础信息
- **接口名称**: 用户概要
- **接口路径**: `/api/user/user/profile/{id}`
- **请求方法**: GET
- **接口权限**: 任何用户都可访问
- **接口描述**: 在用户端或商户端点击某用户可以访问该用户
- **接口实现**:查询user表获取用户概要
- 访问被删除的用户则返回空用户
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体
| 参数名    | 是否必填 | 数据类型   | 说明   | 示例  |
|--------|------|--------|------|-----|
| id     | 是    | Long   | 用户id | 1   |


##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data":{

    "id": 1,
    "username": "wddyxd",
    "nickName": "wddyxd",
    "avatar": "https://example.com/avatar.png"
      
    
  }
}
```

#### 访问某用户接口
##### 基础信息
- **接口名称**: 访问某用户
- **接口路径**: `/api/user/user/visit/{id}`
- **请求方法**: GET
- **接口权限**: 任何用户都可访问
- **接口描述**: 在用户端或商户端点击某用户可以访问该用户
- **接口实现**:查询user,user_detail,merchant_supplement表获取用户信息
- 访问被删除的用户则返回空用户
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体
| 参数名    | 是否必填 | 数据类型   | 说明   | 示例  |
|--------|------|--------|------|-----|
| id     | 是    | Long   | 用户id | 1   |


##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data":{
    
    "id": 1,
    "username": "wddyxd",
    "nickName": "wddyxd",
    "avatar": "https://example.com/avatar.png",
    "status": 0,

    "gender": 1,
    "birthday": "2005-10-21T12:17:56.000+00:00",
    "region": "上海",

    "shopName": "广文书店",
    "shopCategory": "美食",
    "shopAddress": "汕头达濠西元大盘1010号",

    "shopStatus": 1  
      
    
  }
}
```

#### 获取个人用户地址簿接口
##### 基础信息
- **接口名称**: 获取个人用户地址簿
- **接口路径**: `/api/user/user/address/{id}`
- **请求方法**: GET
- **接口权限**:需要user.list权限或者访问者的id等于参数的id
- **接口描述**: 查看用户的详细信息
- **接口实现**: 在用户端个人中心或后台的用户管理可查询用户端地址簿
- 只需返回没有被逻辑删除的地址
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体
| 参数名    | 是否必填 | 数据类型   | 说明  | 示例  |
|--------|------|--------|-----|-----|
| id     | 是    | Long   | id  | 1   |


##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": [
    {
      "id": 1,
      "receiver": "张三",
      "phone": "15626448742",
      "province": "广东",
      "city": "汕头",
      "district": "濠江",
      "address": "达濠街道西元大盘1010号",
      "isDefault": true
    }
  ]
}
```

#### 获取自己的认证信息接口
##### 基础信息
- **接口名称**: 获取自己的认证信息
- **接口路径**: `/api/user/user/me`
- **请求方法**: GET
- **接口权限**:用户登录后每次刷新路由访问
- **接口描述**: 获取自己的id,用户名,昵称,头像,角色,权限
- **接口实现**: 访问接口时被spring-security的过滤器链拦截,
- 其中TokenAuthFilter会解析token并根据token信息从redis获得用户信息然后将信息包装到SecurityContextHolder,
- 然后从SecurityContextHolder获得用户信息并返回CurrentUserDTO
- 只需返回没有被逻辑删除的数据
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体
| 参数名  | 是否必填 | 数据类型 | 说明   | 示例   |
|------|------|------|------|------|
| none | none | none | none | none |


##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 401: token类的异常
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "id": 1,
    "username": "wddyxd",
    "nickName": "wddyxd",
    "avatar": "",
    "roles": [
      "ROLE_SUPER_ADMIN"
    ],
    "permissionValueList": [
      "user.add",
      "user.update",
      "user.list",
      "user.remove"
    ]
  }
}
```

#### 添加管理员接口
##### 基础信息
- **接口名称**: 添加用户
- **接口路径**: `/api/user/user/add`
- **请求方法**: GET
- **接口权限**:需要user.add权限
- **接口描述**: 在后台的用户管理中添加用户,这里的用户指的是管理员
- **接口实现**: 传入User类,然后判断用户的用户名,手机或邮箱是否被其他用户占用,
- 如果都没被占用则直接添加用户,为这个用户赋予ROLE_NEW_ADMIN角色,然后在user_detail中添加默认的用户详细信息
- 否则返回错误
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体
| 参数名         | 是否必填            | 数据类型    | 说明   | 示例                            |
|-------------|-----------------|---------|------|-------------------------------|
| id          | 否               | Long    | id   | none                          |
| username    | 是               | String  | 用户名  | wddyxd                        |
| nickName    | 否(如果否那么生成随机昵称)  | String  | 昵称   | wddyxd                        |
| phone       | 是               | String  | 手机   | 15626448742                   |
| email       | 是               | String  | 邮箱   | www********@qq.com            |
| password    | 否(如果否则生成123456) | String  | 密码   | 123456                        |
| avatar      | 否(如果否那么生成默认头像)  | String  | 头像   | http:xxx:xx/xxx/xxx/...       |
| isDeleted   | 否(默认为0)         | Boolean | 删除状态 | 0                             |
| status      | 否(默认为0)         | Integer | 状态   | 0                             |
| createdTime | 否(默认为当前时间)      | Date    | 创建时间 | 2025-10-21T12:17:56.000+00:00 |
| updatedTime | 否(默认为当前时间)      | Date    | 修改时间 | 2025-10-21T12:17:56.000+00:00 |


##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data":null
}
```

#### 更新用户密码接口
##### 基础信息
- **接口名称**: 更新用户密码
- **接口路径**: `/api/user/user/update/passowrd`
- **请求方法**: PUT
- **接口权限**: 需要user.update权限或更新者的id等于参数id
- **接口描述**: 更新用户密码
- **接口实现**:传入用户id,手机验证码,旧密码,新密码,查询当前用户,
- 比较旧密码和新密码是否不一致,接下来比较旧密码是否吻合,接下来比较手机验证码是否和手机吻合,然后才更新密码
- 最后在在redis记录上次修改密码的时间戳,有效期5秒,有效期内禁止修改
- 查询不到用户或用户被逻辑删除则不应该执行更新
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体
| 参数名         | 是否必填 | 数据类型    | 说明     | 示例          |
|-------------|------|---------|--------|-------------|
| id          | 是    | Long    | id     | 1           |
| phoneCode   | 是    | String  | 验证码    | 123456      |
| phone       | 是    | String  | 手机     | 15626448742 |
| oldPassword | 是    | String  | 旧密码    | 123456      |
| newPassword | 是    | String  | 密码     | 654321      |

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data":null
}
```

#### 换绑手机号接口
##### 基础信息
- **接口名称**: 换绑手机号
- **接口路径**: `/api/user/user/update/phone`
- **请求方法**: PUT
- **接口权限**: 需要user.update权限或更新者的id等于参数id
- **接口描述**: 换绑手机号
- **接口实现**:传入用户id,手机验证码,旧手机号,新手机号,查询当前用户,
- 比较旧手机号和新手机号是否不一致,接下来比较旧手机号是否吻合,接下来比较手机验证码是否和新手机号吻合,然后才更新手机号
- 在mysql设置手机号唯一性约束
- 查询不到用户或用户被逻辑删除则不应该执行更新
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体
| 参数名       | 是否必填 | 数据类型   | 说明  | 示例          |
|-----------|------|--------|-----|-------------|
| id        | 是    | Long   | id  | 1           |
| oldPhone  | 是    | String | 旧手机 | 15626448742 |
| newPhone  | 是    | String | 新手机 | 15626448743 |
| phoneCode | 是    | String | 验证码 | 123456      |


##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data":null
}
```

#### 换绑邮箱接口
##### 基础信息
- **接口名称**: 换绑邮箱
- **接口路径**: `/api/user/user/update/email`
- **请求方法**: PUT
- **接口权限**: 需要user.update权限或更新者的id等于参数id
- **接口描述**: 换绑邮箱
- **接口实现**:传入用户id,邮箱验证码,旧邮箱,新邮箱,查询当前用户,
- 比较旧邮箱和新邮箱是否不一致,接下来比较旧邮箱是否吻合,接下来比较邮箱验证码是否和新邮箱吻合,然后才更新邮箱
- 在mysql设置邮箱唯一性约束
- 查询不到用户或用户被逻辑删除则不应该执行更新
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体
| 参数名       | 是否必填 | 数据类型   | 说明  | 示例          |
|-----------|------|--------|-----|-------------|
| id        | 是    | Long   | id  | 1           |
| oldEmail  | 是    | String | 旧邮箱 | 15626448742 |
| newEmail  | 是    | String | 新邮箱 | 15626448743 |
| emailCode | 是    | String | 验证码 | 123456      |


##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data":null
}
```

#### 更新头像接口
##### 基础信息
- **接口名称**: 更换头像
- **接口路径**: `/api/user/user/update/avatar`
- **请求方法**: PUT
- **接口权限**: 需要user.update权限或更新者的id等于参数id
- **接口描述**: 更换头像
- **接口实现**: 查询不到用户或用户被逻辑删除则不应该执行更新
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体
| 参数名    | 是否必填 | 数据类型   | 说明 | 示例           |
|--------|------|--------|----|--------------|
| id     | 是    | Long   | id | 1            |
| avatar | 是    | String | 头像 | http:/www... |


##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data":null
}
```

#### 更新昵称接口
##### 基础信息
- **接口名称**: 更新昵称
- **接口路径**: `/api/user/user/update/nickName`
- **请求方法**: PUT
- **接口权限**: 需要user.update权限或更新者的id等于参数id
- **接口描述**: 更新昵称
- **接口实现**: 查询不到用户或用户被逻辑删除则不应该执行更新
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体
| 参数名      | 是否必填 | 数据类型   | 说明 | 示例     |
|----------|------|--------|----|--------|
| id       | 是    | Long   | id | 1      |
| nickname | 是    | String | 昵称 | wddyxd |


##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data":null
}
```

#### 更新性别接口
##### 基础信息
- **接口名称**: 更新性别
- **接口路径**: `/api/user/user/update/gender`
- **请求方法**: PUT
- **接口权限**: 需要user.update权限或更新者的id等于参数id
- **接口描述**: 更换性别
- **接口实现**: 查询不到用户或用户被逻辑删除则不应该执行更新
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体
| 参数名    | 是否必填 | 数据类型   | 说明 | 示例 |
|--------|------|--------|----|----|
| id     | 是    | Long   | id | 1  |
| gender | 是    | String | 性别 | 1  |


##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data":null
}
```

#### 更新生日接口
##### 基础信息
- **接口名称**: 更新生日
- **接口路径**: `/api/user/user/update/birthday`
- **请求方法**: PUT
- **接口权限**: 需要user.update权限或更新者的id等于参数id
- **接口描述**: 更新生日
- **接口实现**: 查询不到用户或用户被逻辑删除则不应该执行更新,更新后在redis进行记录,过期时间是1年,
- 访问接口时存在redis记录则拒绝更新
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体
| 参数名      | 是否必填 | 数据类型   | 说明 | 示例           |
|----------|------|--------|----|--------------|
| id       | 是    | Long   | id | 1            |
| birthday | 是    | String | 生日 | 2020-01-01   |


##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data":null
}
```

#### 更新地域接口
##### 基础信息
- **接口名称**: 更新地域
- **接口路径**: `/api/user/user/update/region`
- **请求方法**: PUT
- **接口权限**: 需要user.update权限或更新者的id等于参数id
- **接口描述**: 更新地域
- **接口实现**: 查询不到用户或用户被逻辑删除则不应该执行更新,更新后在redis进行记录,过期时间是90天,
- 访问接口时存在redis记录则拒绝更新
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体
| 参数名    | 是否必填 | 数据类型   | 说明 | 示例 |
|--------|------|--------|----|----|
| id     | 是    | Long   | id | 1  |
| region | 是    | String | 地域 | 广东 |


##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data":null
}
```

#### 实名认证接口
##### 基础信息
- **接口名称**: 实名认证
- **接口路径**: `/api/user/user/update/card`
- **请求方法**: PUT
- **接口权限**: 需要user.update权限或更新者的id等于参数id
- **接口描述**: 实名认证
- **接口实现**: 传入id,realName,IdCard,虽然需要对接外部API,但这里简化实现:
- 检验IdCard格式正确后并且没有已使用的realName和IdCard则直接设置用户是已经完成实名认证的,并为用户升级角色,
- 查询不到用户或用户被逻辑删除则不应该执行更新,
- 在mysql为real_name和id_card添加唯一约束
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体
| 参数名    | 是否必填 | 数据类型   | 说明 | 示例 |
|--------|------|--------|----|----|
| id     | 是    | Long   | id | 1  |
| gender | 是    | String | 性别 | 1  |


##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data":null
}
```

#### 删除用户接口
##### 基础信息
- **接口名称**: 删除用户
- **接口路径**: `/api/user/user/delete/{id}`
- **请求方法**: DELETE
- **接口权限**:需要user.delete权限
- **接口描述**: 只有管理员有权限删除用户,普通用户要注销需要将注销请求发送给管理员
- **接口实现**:- 在删除账户之前在redis查看上次删除该用户的时间戳如果存在则直接返回,
- 否则要须保证该该账户存在且该账户不存在状态为已付款,待发货,待收货的订单,然后保证该用户没有注册商户,然后将用户的充值和领取的优惠券退还,
- 然后将唯一约束字段(都是varchar字段)修改成 "原先字段.DELETED.删除时间戳"的格式,然后将user,user_detail,user_address表的相关字段逻辑删除
- 然后将用户和用户相关角色的关联逻辑删除
- 然后在redis添加本次删除的时间戳,然后返回被删除用户的id
- **接口备注**:删除接口需要引入MQ和seata和状态机
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体
| 参数名         | 是否必填 | 数据类型    | 说明   | 示例                            |
|-------------|------|---------|------|-------------------------------|
| id          | 是    | Long    | id   | none                          |


##### 响应数据
###### 响应状态码
- 200: 删除成功
- 400: 请求参数错误
- 403: 权限不足（非管理员）
- 404: 用户不存在
- 409: 未满足删除前置条件，无法删除
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data":null
}
```

### 商户补丁相关接口 MerchantSupplementController

#### 删除商户接口
##### 基础信息
- **接口名称**: 删除商户
- **接口路径**: `/api/user/merchantSupplement/delete/{id}`
- **请求方法**: DELETE
- **接口权限**:需要user.delete权限
- **接口描述**: 只有管理员有权限删除商户,普通商户要注销需要将注销请求发送给管理员
- **接口实现**:- 在删除账户之前在redis查看上次删除该用户的时间戳如果存在则直接返回, 
- 否则要须保证该账户的所有订单都已收货, 然后保证所有优惠券已经回收,然后保证优惠券已被退还,然后保证商户的优惠券已被删除, 然后保证所有商品被下架已经删除,
- 然后将唯一约束字段(都是varchar字段)修改成 "原先字段.DELETED.删除时间戳"的格式,然后将merchant_supplement表逻辑删除
- 然后将用户和商户相关角色的关联逻辑删除
- 然后在redis添加本次删除的时间戳,然后返回被删除用户的id
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体
| 参数名         | 是否必填 | 数据类型    | 说明   | 示例                            |
|-------------|------|---------|------|-------------------------------|
| id          | 是    | Long    | id   | none                          |


##### 响应数据
###### 响应状态码
- 200: 删除成功
- 400: 请求参数错误
- 403: 权限不足（非管理员）
- 404: 用户不存在
- 409: 未满足删除前置条件，无法删除
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data":{
    "id": 11232439947510
  }
}
```

#### 更新基础商户信息接口
##### 基础信息
- **接口名称**: 更新基础商户信息
- **接口路径**: `/api/user/merchantSupplement/update/custom`
- **请求方法**: PUT
- **接口权限**: 需要user.update权限或更新者的id等于参数id
- **接口描述**: 同时更新merchant_supplement表的shopName,shopCategoryId和shopAddress字段
- **接口实现**: 更新基础商户信息,查询不到用户或用户被逻辑删除则不应该执行更新

##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体
| 参数名              | 是否必填 | 数据类型   | 说明     | 示例            |
|------------------|------|--------|--------|---------------|
| id               | 是    | Long   | id     | 1             |
| shopName         | 是    | String | 店铺名称   | 广文书店          |
| shopCategoryId   | 是    | String | 店铺类别   | 1             |
| shopAddress      | 是    | String | 店铺地址   | 汕头达濠西元大盘1010号 |

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data":null
}
```

#### 许可证认证接口
##### 基础信息
- **接口名称**: 许可证认证
- **接口路径**: `/api/user/merchantSupplement/update/license`
- **请求方法**: PUT
- **接口权限**: 需要user.update权限或更新者的id等于参数id
- **接口描述**: 同时更新merchant_supplement表的license,licenseImage字段
- **接口实现**: 提供许可证后异步通知管理员审核,应该审核后管理员手动为其升级角色,但这里实现为直接为该用户升级角色

##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体
| 参数名              | 是否必填 | 数据类型   | 说明     | 示例  |
|------------------|------|--------|--------|-----|
| id               | 是    | Long   | id     | 1   |
| shopLicense      | 是    | String | 营业执照   | xxx |
| shopLicenseImage | 是    | String | 营业执照图片 | xxx |

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data":null
}
```

### 店铺分类相关接口 ShopCategoryController

#### 增加店铺分类接口
##### 基础信息
- **接口名称**: 增加店铺分类
- **接口路径**: `/api/user/shopCategory/add`
- **请求方法**: POST
- **接口权限**:需要shopCategory.add权限
- **接口描述**: 管理员可以在店铺分类界面增加店铺分类
- **接口实现**: 增加店铺分类
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体
| 参数名        | 是否必填 | 数据类型    | 说明     | 示例    |
|------------|------|---------|--------|-------|
| id         | 否    | Integer | id     | null  |
| name       | 是    | string  | 店铺分类名  | 家居    |
| code       | 是    | string  | 店铺分类编码 | 1001  |
| createTime | 否    | Date    | 创建时间   | null  |
| updateTime | 否    | Date    | 修改时间   | null  |
| deleted    | 否    | boolean | 逻辑删除   | false |

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": null
}
```

#### 分页查询店铺分类接口
##### 基础信息
- **接口名称**: 分页查询店铺分类
- **接口路径**: `/api/user/shopCategory/list`
- **请求方法**: GET
- **接口权限**:需要shopCategory.list权限
- **接口描述**: 在管理员的角色管理主界面查看所有存在的店铺分类
- **接口实现**: 在管理员的角色管理主界面查看所有存在的店铺分类,支持根据关键字搜索,
- 在mysql为店铺分类名建立索引以支持关键字搜索
- 返回List<ShopCategory>并由PageResult包装
- 注意无论店铺分类是否被逻辑删除都应该被被查到
- **接口备注**:由于店铺分类数量较少, 所以后期也可以改为分组获取全部店铺分类
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |


###### 请求体
| 参数名      | 是否必填    | 数据类型    | 说明    | 示例  |
|----------|---------|---------|-------|-----|
| pageNum  | 否(默认1)  | Integer | 页码    | 1   |
| pageSize | 否(默认10) | Integer | 每页数据量 | 10  |
| search   | 否(默认"") | string  | 关键字   | abc |


##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "records": [
      {
        "id": 1,
        "name": "家居",
        "code": "1001",
        "createTime": "2025-10-21T12:17:56.000+00:00",
        "updateTime": "2025-10-21T12:18:00.000+00:00",
        "deleted": false
      }
    ],
    "total": 1,
    "size": 10,
    "current": 1,
    "pages": 1
  }
}
```

#### 更新店铺分类内容接口
##### 基础信息
- **接口名称**: 更新店铺分类
- **接口路径**: `/api/user/shopCategory/update`
- **请求方法**: PUT
- **接口权限**:需要shopCategory.update权限
- **接口描述**: 管理员可以在店铺分类管理界面更新店铺分类信息
- **接口实现**: 更新店铺分类信息,店铺分类被逻辑删除则拒绝更新
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体
| 参数名        | 是否必填 | 数据类型    | 说明   | 示例        |
|------------|------|---------|------|-----------|
| id         | 是    | Integer | id   | 1         |
| name       | 否    | string  | 店铺分类名  | ROLE_USER |
| code       | 否    | string  | 店铺分类编码 | 1001      |
| createTime | 否    | Date    | 创建时间 | null      |
| updateTime | 否    | Date    | 修改时间 | null      |
| deleted    | 否    | boolean | 逻辑删除 | false     |

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": null
}
```

#### 删除店铺分类接口
##### 基础信息
- **接口名称**: 删除店铺分类
- **接口路径**: `/api/user/shopCategory/delete/{id}`
- **请求方法**: DELETE
- **接口权限**:需要shopCategory.delete权限
- **接口描述**: 只有管理员有权限删除店铺分类,删除店铺分类按钮在店铺分类管理界面
- **接口实现**:- 删除店铺分类包括根据id将role表的主键等于id,
- role_permissions表role_id等于id和user_role表role_id等于id的行逻辑删除
- 不能删除"默认分类",然后遍历merchant_supplement表,将涉及被删除分类的记录变成"默认分类"
- 只有超级管理员才可以删除店铺分类
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体
| 参数名         | 是否必填 | 数据类型    | 说明   | 示例                            |
|-------------|------|---------|------|-------------------------------|
| id          | 是    | Long    | id   | none                          |


##### 响应数据
###### 响应状态码
- 200: 删除成功
- 400: 请求参数错误
- 403: 权限不足（非管理员）
- 404: 用户不存在
- 409: 未满足删除前置条件，无法删除
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data":{
    "id": 11232439947510
  }
}
```

### 角色相关接口 RoleController

#### 分页获取角色列表接口
##### 基础信息
- **接口名称**: 分页获取角色列表
- **接口路径**: `/api/user/role/list`
- **请求方法**: GET
- **接口权限**:需要role.list权限
- **接口描述**: 在管理员的角色管理主界面查看所有存在的角色
- **接口实现**: 在管理员的角色管理主界面查看所有存在的角色,支持根据关键字搜索,
- 在mysql为角色名建立索引以支持关键字搜索
- 返回List<Role>并由PageResult包装
- 注意无论角色是否被逻辑删除都应该被被查到
- **接口备注**:由于角色数量较少也只能根据客户端分为3个组,每个用户在每组最多只能获得一个角色
- ,所以后期也可以改为分组获取全部角色
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |


###### 请求体
| 参数名      | 是否必填    | 数据类型    | 说明    | 示例  |
|----------|---------|---------|-------|-----|
| pageNum  | 否(默认1)  | Integer | 页码    | 1   |
| pageSize | 否(默认10) | Integer | 每页数据量 | 10  |
| search   | 否(默认"") | string  | 关键字   | abc |


##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "records": [
      {
        "id": 1,
        "roleName": "ROLE_SUPER_ADMIN",
        "roleCode": "1001",
        "createTime": "2025-10-21T12:17:56.000+00:00",
        "updateTime": "2025-10-21T12:18:00.000+00:00",
        "deleted": false
      }
    ],
    "total": 1,
    "size": 10,
    "current": 1,
    "pages": 1
  }
}
```

#### 查看角色详细信息接口
##### 基础信息
- **接口名称**: 查看角色详细信息
- **接口路径**: `/api/user/role/detail/{id}`
- **请求方法**: GET
- **接口权限**:需要role.list权限
- **接口描述**: 在管理员的角色管理主界面查看角色详情
- **接口实现**: 查询role和permissions表中获取角色信息和角色关联的权限
- 注意无论角色是否被逻辑删除都应该被被查到,但权限应该是没有被逻辑删除的
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |


###### 请求体
| 参数名 | 是否必填 | 数据类型    | 说明    | 示例 |
|-----|------|---------|-------|----|
| id  | 是    | string  | 关键字   | 1  |


##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "id": 1,
    "roleName": "ROLE_SUPER_ADMIN",
    "roleCode": "1001",
    "createTime": "2025-10-21T12:17:56.000+00:00",
    "updateTime": "2025-10-21T12:18:00.000+00:00",
    "deleted": false,
    
    "permissions": [
      {
        "id": 1,
        "name": "用户管理",
        "permissionValue": "user.list",
        "createTime": "2025-10-21T12:17:56.000+00:00",
        "updateTime": "2025-10-21T12:18:00.000+00:00",
        "deleted": false
      }
    ]
  }
}
```

#### 手动为特定用户分配角色接口
##### 基础信息
- **接口名称**: 手动为特定用户分配角色
- **接口路径**: `/api/user/role/assignRole`
- **请求方法**: POST
- **接口权限**:需要user.update权限
- **接口描述**: 管理员可以在用户管理界面查看用户详细信息的时候为某用户分配角色,
- **接口实现**:一个用户可以分配最多三个角色,分别是最多一个购物者角色,一个商户角色和一个管理员角色,
- 如果发现roleId不满足分配角色合法性则拒绝分配,
- 否则根据参数查询用户和用户的角色,然后删除用户拥有的角色,然后重新增加角色
- 如果原先没有商户角色但添加了商户则创建商户表,并插入默认商户信息(但如果给了最高级商户角色但没有许可证呢?)
- 只有超级管理员才可以给用户分配管理员角色,管理员只能给用户分配除管理员外的角色
- 如果查询不到用户或用户被逻辑删除则拒绝分配
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |


###### 请求体
| 参数名     | 是否必填 | 数据类型    | 说明     | 示例    |
|---------|------|---------|--------|-------|
| userId  | 是    | Integer | 用户id   | 1     |
| roleIds | 是    | Integer | 角色id数组 | 1,2,3 |


##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": null
}
```

#### 添加角色接口
##### 基础信息
- **接口名称**: 添加角色
- **接口路径**: `/api/user/role/add`
- **请求方法**: POST
- **接口权限**:需要role.add权限
- **接口描述**: 管理员可以在角色管理界面添加角色
- **接口实现**: 添加角色
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体
| 参数名        | 是否必填 | 数据类型    | 说明   | 示例        |
|------------|------|---------|------|-----------|
| id         | 否    | Integer | id   | null      |
| roleName   | 是    | string  | 角色名  | ROLE_USER |
| roleCode   | 是    | string  | 角色编码 | 1001      |
| createTime | 否    | Date    | 创建时间 | null      |
| updateTime | 否    | Date    | 修改时间 | null      |
| deleted    | 否    | boolean | 逻辑删除 | false     |

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": null
}
```

#### 更新角色内容接口
##### 基础信息
- **接口名称**: 更新角色
- **接口路径**: `/api/user/role/update`
- **请求方法**: PUT
- **接口权限**:需要role.update权限
- **接口描述**: 管理员可以在角色管理界面更新角色信息
- **接口实现**: 更新角色信息,角色被逻辑删除则拒绝更新
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体
| 参数名        | 是否必填 | 数据类型    | 说明   | 示例        |
|------------|------|---------|------|-----------|
| id         | 是    | Integer | id   | 1         |
| roleName   | 否    | string  | 角色名  | ROLE_USER |
| roleCode   | 否    | string  | 角色编码 | 1001      |
| createTime | 否    | Date    | 创建时间 | null      |
| updateTime | 否    | Date    | 修改时间 | null      |
| deleted    | 否    | boolean | 逻辑删除 | false     |

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": null
}
```

#### 删除角色接口
##### 基础信息
- **接口名称**: 删除角色
- **接口路径**: `/api/user/role/delete/{id}`
- **请求方法**: DELETE
- **接口权限**:需要role.delete权限
- **接口描述**: 只有管理员有权限删除角色,删除角色按钮在角色管理界面
- **接口实现**:- 删除角色包括根据id将role表的主键等于id,
- role_permissions表role_id等于id和user_role表role_id等于id的行逻辑删除,
- 不能删除每个角色组的"默认角色",然后遍历用户,如果用户有该角色则将该角色变成所在组的"默认角色"
- 只有超级管理员才可以删除角色
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体
| 参数名         | 是否必填 | 数据类型    | 说明   | 示例                            |
|-------------|------|---------|------|-------------------------------|
| id          | 是    | Long    | id   | none                          |


##### 响应数据
###### 响应状态码
- 200: 删除成功
- 400: 请求参数错误
- 403: 权限不足（非管理员）
- 404: 用户不存在
- 409: 未满足删除前置条件，无法删除
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data":{
    "id": 11232439947510
  }
}
```

### 权限相关接口 PermissionsController

#### 分页获取权限列表接口
##### 基础信息
- **接口名称**: 分页获取角色列表
- **接口路径**: `/api/user/permissions/list`
- **请求方法**: GET
- **接口权限**:需要permissions.list权限
- **接口描述**: 在管理员的权限管理主界面查看所有存在的权限
- **接口实现**: 在管理员的权限管理主界面查看所有存在的权限,支持根据关键字搜索,
- 在mysql为权限值建立索引以支持关键字搜索
- 返回List<Permissions>并由PageResult包装
- 注意无论用户是否被逻辑删除都应该被被查到
- - **接口备注**:由于权限数量较少也只能根据模块分组
- ,所以后期也可以改为分组获取全部权限
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |


###### 请求体
| 参数名      | 是否必填    | 数据类型    | 说明    | 示例  |
|----------|---------|---------|-------|-----|
| pageNum  | 否(默认1)  | Integer | 页码    | 1   |
| pageSize | 否(默认10) | Integer | 每页数据量 | 10  |
| search   | 否(默认"") | string  | 关键字   | abc |


##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "records": [
      {
        "id": 1,
        "name": "增加用户",
        "permissionValue": "user.add",
        "createTime": "2025-10-21T12:17:56.000+00:00",
        "updateTime": "2025-10-21T12:18:00.000+00:00",
        "deleted": false
      }
    ],
    "total": 1,
    "size": 10,
    "current": 1,
    "pages": 1
  }
}
```

#### 为角色分配权限接口
##### 基础信息
- **接口名称**: 手动为特定角色分配权限
- **接口路径**: `/api/user/permissions/assignPermissions`
- **请求方法**: POST
- **接口权限**:需要role.update权限
- **接口描述**: 管理员可以在角色管理界面查看角色详细信息的时候为某角色分配权限,
- **接口实现**:permissionsId都指向存在的正常运作的权限才可继续执行接口,
- 根据参数查询角色和角色的权限,然后删除角色拥有的权限,然后重新增加权限
- 只有超级管理员才可以给角色分配权限
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |


###### 请求体
| 参数名            | 是否必填 | 数据类型    | 说明     | 示例    |
|----------------|------|---------|--------|-------|
| roleId         | 是    | Integer | 角色id   | 1     |
| permissionsIds | 是    | Integer | 权限id数组 | 1,2,3 |


##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": null
}
```

#### 添加权限接口
##### 基础信息
- **接口名称**: 添加权限
- **接口路径**: `/api/user/permissions/add`
- **请求方法**: POST
- **接口权限**:需要permissions.add权限
- **接口描述**: 管理员可以在权限管理界面添加权限
- **接口实现**: 添加权限
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体
| 参数名             | 是否必填 | 数据类型    | 说明   | 示例        |
|-----------------|------|---------|------|-----------|
| id              | 否    | Integer | id   | null      |
| name            | 是    | string  | 角色名  | ROLE_USER |
| permissionValue | 是    | string  | 角色编码 | 1001      |
| createTime      | 否    | Date    | 创建时间 | null      |
| updateTime      | 否    | Date    | 修改时间 | null      |
| deleted         | 否    | boolean | 逻辑删除 | false     |

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": null
}
```

#### 更改权限内容接口
##### 基础信息
- **接口名称**: 更新权限内容接口
- **接口路径**: `/api/user/permissions/update`
- **请求方法**: PUT
- **接口权限**:需要permissions.update权限
- **接口描述**: 管理员可以在权限管理界面更新权限信息
- **接口实现**: 更新权限信息,权限被逻辑删除则拒绝更新
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体
| 参数名             | 是否必填 | 数据类型    | 说明   | 示例        |
|-----------------|------|---------|------|-----------|
| id              | 是    | Integer | id   | 1         |
| name            | 否    | string  | 角色名  | ROLE_USER |
| permissionValue | 否    | string  | 角色编码 | 1001      |
| createTime      | 否    | Date    | 创建时间 | null      |
| updateTime      | 否    | Date    | 修改时间 | null      |
| deleted         | 否    | boolean | 逻辑删除 | false     |

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": null
}
```

#### 删除权限接口
##### 基础信息
- **接口名称**: 删除权限
- **接口路径**: `/api/user/permissions/delete/{id}`
- **请求方法**: DELETE
- **接口权限**:需要permissions.delete权限
- **接口描述**: 只有超级管理员有权限删除权限,删除权限按钮在权限管理界面
- **接口实现**:- 删除权限包括根据id将permissions表的主键等于id,
- role_permissions表permissions_id等于id的行逻辑删除
- 只有超级管理员才可以删除角色
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体
| 参数名         | 是否必填 | 数据类型    | 说明   | 示例                            |
|-------------|------|---------|------|-------------------------------|
| id          | 是    | Long    | id   | none                          |


##### 响应数据
###### 响应状态码
- 200: 删除成功
- 400: 请求参数错误
- 403: 权限不足（非管理员）
- 404: 用户不存在
- 409: 未满足删除前置条件，无法删除
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data":{
    "id": 11232439947510
  }
}
```


## 商品模块 product-service

### 商品相关接口 ProductController

#### 分页获取商品列表接口
##### 基础信息
- **接口名称**: 分页获取商品列表
- **接口路径**: `/api/product/product/list`
- **请求方法**: GET
- **接口权限**: 需要product.list权限或者参数userId等于访问者的id
- **接口描述**: 在后台和商户端的商品管理界面查看所有商品
- **接口实现**: 在后台和商户端的商品管理界面查看所有存在的商品或当前商户的商品,
- 支持根据商品名搜索,支持根据创建时间或更新时间检索,支持根据商品分类检索,
- 支持根据商品状态检索,支持根据价格范围排序检索
- 在mysql建立索引以支持关键字搜索,后期可接入Elasticsearch
- 返回List<ProductVO>并由PageResult包装
- 这里是展示类而不是实体类,因为返回的商品不是商品本身,而是商品+商品分类+默认商品样式的整合
- 返回的商品的名字是商品名字和默认样式的名字的拼接,库存是总库存,价格是默认样式的价格,销量是总销量
- 注意无论商品是否被逻辑删除都应该被被查到
- - **接口备注**:该接口不用于用户端!
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |


###### 请求体
| 参数名        | 是否必填          | 数据类型       | 说明                          | 示例  |
|------------|---------------|------------|-----------------------------|-----|
| pageNum    | 否(默认1)        | Integer    | 页码                          | 1   |
| pageSize   | 否(默认10)       | Integer    | 每页数据量                       | 10  |
| name       | 否(默认"")       | string     | 关键字                         | abc |
| categoryId | 否(默认0)        | Long       | 分类id                        | 0   |
| status     | 否(默认0)        | Integer    | 状态                          | 0   |
| sortBy     | 否(默认"")       | string     | 排序字段(createTime/updateTime) | ""  |
| sortOrder  | 否(默认desc)     | string     | 排序顺序(asc/desc)              | asc |
| userId     | 否(默认0)        | Long       | 用户id                        | 0   |
| minPrice   | 否(默认0.00)     | BigDecimal | 价格下限                        | 0   |
| maxPrice   | 否(默认10000.00) | BigDecimal | 价格上限                        | 0   |



##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "records": [
      {
        "id": 1,
        "productSkuName": "蔡徐坤篮球",
        "userId": 1,
        "username": "wddyxd",
        "name": "篮球",
        "categoryName": "文具",
        "price": 50.00,
        "stock": 100,
        "sales": 100,
        "positiveComment": 10,
        "negativeComment": 0,
        "logo": "https://example.com/logo.png",
        "status": 1,
        "createTime": "2025-10-21T12:17:56.000+00:00",
        "updateTime": "2025-10-21T12:18:00.000+00:00",
        "deleted": false
      }
    ],
    "total": 1,
    "size": 10,
    "current": 1,
    "pages": 1
  }
}
```

#### 在用户端访问商品接口
##### 基础信息
- **接口名称**: 在用户端访问商品
- **接口路径**: `/api/product/product/productProfile/{id}`
- **请求方法**: GET
- **接口权限**: 任何用户都可访问
- **接口描述**: 在用户端点击被推送的商品可以访问该商品
- **接口实现**:查询product,product_category,product_sku,coupon,user,order_item表并返回ProductDetailVO,这个类展示了商品详情页面的信息
- 用户端不应该访问被下架或删除的商品
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体
| 参数名    | 是否必填 | 数据类型   | 说明        | 示例  |
|--------|------|--------|-----------|-----|
| id     | 是    | Long   | id        | 1   |


##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data":{
    "ProductProfile":{

      "ProductProfileVO": {
        "id": 1,
        "userId": 10,
        "productSkuName": "蔡徐坤篮球",
        "name": "篮球",
        "categoryId": 1,
        "categoryName": "文具",
        "price": 50.00,
        "stock": 100,
        "sales": 100,
        "logo": "https://example.com/logo.png",
        "positiveComment": 10,
        "negativeComment": 0,
        "description": "篮球......",
        "status": 1,
        "createTime": "2025-10-21T12:17:56.000+00:00",
        "updateTime": "2025-10-21T12:18:00.000+00:00",
        "deleted": false
      },
      
      "userProfileVO": {
        "id": 10,
        "username": "wddyxd",
        "nickName": "wddyxd",
        "avatar": "https://example.com/avatar.png"
      },
      
      "couponVO": [
        {
          "id": 1,
          "name": "蔡徐坤联名优惠券",
          "getType": 1,
          "targetType": 1,
          "isDiscount": 1,
          "targetId": 1,
          "threshold": 100.00,
          "value": 0.1,
          "startTime": "2025-10-21T12:17:56.000+00:00",
          "endTime": "2025-10-21T12:17:56.000+00:00",
          "isDeleted": false,
          "createTime": "2025-10-21T12:17:56.000+00:00",
          "updateTime": "2025-10-21T12:18:00.000+00:00"
        }
      ],
      
      "productSkuVO": [
        {
          "id": 1000,
          "productId": 1,
          "specs": "颜色:褐色,尺寸:L",
          "price": 50.00,
          "stock": 100,
          "sales": 100,
          "logo": "https://example.com/logo.png",
          "skuCode": "BM-L"
        }
      ]
      
    }
  }
}
```

#### 查看商品详情接口
##### 基础信息
- **接口名称**: 在用户端访问商品
- **接口路径**: `/api/product/product/productDetail/{id}/{userId}`
- **请求方法**: GET
- **接口权限**:需要product.list权限或者访问者的id等于参数的userId
- **接口描述**: 查看商品的详细信息,商户端和管理端查看商品时访问该接口
- **接口实现**: 首先查询product表的该商品,商品合法且商品的userId等于参数的userId则执行下一步,
- 查询product,product_category,product_sku,coupon,user,order_item表并返回ProductDetailVO,这个类展示了商品详情页面的信息
- 在商户端和后台可以访问被下架或删除的商品
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体
| 参数名    | 是否必填 | 数据类型   | 说明        | 示例  |
|--------|------|--------|-----------|-----|
| id     | 是    | Long   | id        | 1   |
| userId | 是    | Long   | 商品指向的用户id | 1   |


##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data":{
    "ProductProfile":{

      "ProductProfileVO": {
        "id": 1,
        "productSkuName": "蔡徐坤篮球",
        "name": "篮球",
        "categoryId": 1,
        "categoryName": "文具",
        "price": 50.00,
        "stock": 100,
        "sales": 100,
        "logo": "https://example.com/logo.png",
        "positiveComment": 10,
        "negativeComment": 0,
        "description": "篮球......",
        "status": 1,
        "createTime": "2025-10-21T12:17:56.000+00:00",
        "updateTime": "2025-10-21T12:18:00.000+00:00",
        "deleted": false
      },

      "userProfileVO": {
        "userId": 1,
        "username": "wddyxd",
        "nickName": "wddyxd",
        "avatar": "https://example.com/avatar.png"
      },

      "couponVO": [
        {
          "id": 1,
          "name": "蔡徐坤联名优惠券",
          "getType": 1,
          "targetType": 1,
          "isDiscount": 1,
          "targetId": 1,
          "threshold": 100.00,
          "value": 0.1,
          "startTime": "2025-10-21T12:17:56.000+00:00",
          "endTime": "2025-10-21T12:17:56.000+00:00",
          "isDeleted": false,
          "createTime": "2025-10-21T12:17:56.000+00:00",
          "updateTime": "2025-10-21T12:18:00.000+00:00"
        }
      ],

      "productSkuVO": [
        {
          "id": 1,
          "productId": 1,
          "specs": "颜色:褐色,尺寸:L",
          "price": 50.00,
          "stock": 100,
          "sales": 100,
          "logo": "https://example.com/logo.png",
          "skuCode": "BM-L"
        }
      ]

    }
  }
}
```

#### 添加商品接口
##### 基础信息
- **接口名称**: 增加商品
- **接口路径**: `/api/product/product/add`
- **请求方法**: POST
- **接口权限**: 需要product.add权限而且访问者的id等于参数的userId
- **接口描述**: 商户上架一件商品
- **接口实现**: 先查询商品指向的商品分类是否存在,如果存在且没被逻辑删除则进入下一步,
- 在事务中，商品和规格需要互相引用 ID，但它们的 ID 在插入数据库前才能生成，这造成了依赖循环,
- 所以需要在操作数据库前手动生成ID的工作(这里采用mybatis_plus的雪花算法),
- 然后遍历规格,为每个规格设置productId,检查价格和规格的合法性,计算规格的总库存然后加到商品的总库存字段,
- 然后查看商品规格中第一个isDefault=true的规格,将这个规格的id赋给商品的productSkuId字段,
- 在插入前在redis插入添加商品的时间戳,过期时间5秒,下次访问接口时如果查询到该redis记录则直接返回
- 然后将商品和规格插入到数据库,数据库对没有处理的字段默认处理
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体
```json
{
  "name": "篮球",
  "categoryId": 1,
  "description": "篮球......",
  "userId": 1,
  "productSku": [
    {
      "isDefault": true,
      "specs": "颜色:褐色,尺寸:L",
      "price": 50.00,
      "stock": 100,
      "logo": "https://example.com/logo.png",
      "skuCode": "BM-L"
    },
    {
      "...": "..."
    }
  ]
}
```

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": null
}
```

#### 修改商品内容接口
##### 基础信息
- **接口名称**: 修改商品内容
- **接口路径**: `/api/prodcut/product/update`
- **请求方法**: PUT
- **接口权限**:(需要product.update权限而且访问者的id等于参数的userId),或者(需要product.update权限而且访问者是管理员(但非默认角色))
- **接口描述**: 在商品管理界面更新商品内容
- **接口实现**: 商品被逻辑删除则拒绝更新
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体
| 参数名         | 是否必填 | 数据类型    | 说明   | 示例    |
|-------------|------|---------|------|-------|
| id          | 是    | Integer | id   | 1     |
| name        | 是    | string  | 角色名  | 篮球    |
| categoryId  | 是    | string  | 角色编码 | 1     |
| description | 是    | Date    | 创建时间 | 篮球... |

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": null
}
```

#### 删除商品接口

#### 在用户端推送商品接口

### 商品分类相关接口 ProductCategoryController

#### 添加商品分类接口

#### 修改商品分类接口

#### 分页查询商品分类列表接口

#### 删除商品分类接口

### 商品规格相关接口 ProductSkuController

#### 分页获取商品规格列表接口

#### 添加商品规格接口

#### 删除商品规格接口

#### 修改商品规格接口

### 优惠券相关接口

#### 分页查询优惠券列表接口

#### 添加优惠券接口

#### 修改优惠券接口

#### 删除优惠券接口

### 用户录取的优惠券相关接口

#### 分页查询用户领取的优惠券列表接口

#### 添加用户领取的优惠券接口

#### 修改用户领取的优惠券接口

#### 删除用户领取的优惠券接口

## 订单模块 order-service