# 接口文档
---
## 用户模块 user-service

### 认证相关接口 AuthController

#### 用户登录接口
##### 基础信息
- **接口名称**: 用户登录
- **接口路径**: `/api/user/auth/login`
- **请求方法**: POST
- **接口权限**:任何用户无需登录可访问
- **接口描述**: 在前端任何客户端按下登录按钮时触发,可以用用户名/手机/邮箱进行密码登录,
- 同时可以用手机或邮箱进行验证码登录,通用在用户端,商户端和管理端,
- 需要标明是用密码还是验证码登录,需要获取用户的IP和设备,
- 登录成功后返回token,token有效时间是7天,
- **接口实现**:前端传入UserLoginForm,然后这个请求被springSecurity过滤器链捕捉,在被判断是登录接口后被TokenLoginFilter拦截后,从HttpRequest解析表单数据并判断登录的类型并加工表单.
- 加工完成后被LoginAuthenticationToken包装并交给AuthenticationManager的实现类链AuthenticationProvider,
- AuthenticationProvider根据LoginAuthenticationToken包装的数据调用不同的UserDetailService来获取用户信息,
- 调用远程接口AuthController的相关方法,首先从redis拿,拿不到就去mysql拿. 并包装到UserDetail的实现类,
- 然后在密码加工(目前用MD5加工密码)比较器判断密码/验证码是否吻合,最后回到TokenLoginFilter来生成token(用对称加密生成)
- token包装用户id,timestamp,ip,device,client并设置7天有效期,一个用户支持3个token实现最多三个设备登录.
- 然后将用户信息保存到redis14天有效期,最后给前端返回token.不能给被删除或封禁的用户登录.
##### 请求参数
###### 请求头
| 参数名             | 是否必填      | 数据类型   | 说明                          | 示例                                        |
|-----------------|-----------|--------|-----------------------------|-------------------------------------------|
| Content-Type    | 是         | string | 请求体类型                       | application/json                          |
| User-Agent      | 否         | string | 设备及浏览器信息                    | Mozilla/5.0 (Windows NT 10.0; Win64; x64) |
| X-Real-IP       | 否（由代理层传递） | string | 客户端公网 IP（通常由 Nginx 等反向代理设置） | 220.181.38.148                            |
| X-Forwarded-For | 否（由代理层传递） | string | 经过代理的客户端 IP 链               | 220.181.38.148, 10.0.0.1                  |
| X-Local-IP      | 否         | string | 客户端局域网 IP（前端自定义传递）          | 192.168.1.100                             |

###### 请求体 UserLoginForm
```json
{
  "id?(Long)": null,
  "username?(String)": "wdd",
  "phone?(String)": null,
  "email?(String)": null,
  "password?(String)": "123",
  "phoneCode?(String)": null,
  "emailCode?(String)": null,
  "LoginType(String)": "PASSWORD",
  "client(String)": "USER"
}
```
##### 响应数据
###### 响应状态码
- 200: 请求成功
- else: 异常

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "token(String)": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
  }
}
```

#### 用户登录接口的密码登录接口
##### 基础信息
- **接口名称**: 密码登录
- **接口路径**: `/api/user/auth/passwordSecurityGetter/{username}`
- **请求方法**: GET
- **接口权限**:任何用户无需登录可访问,但不能通过网关访问
- **接口描述**: 在用户登录接口触发时如果登录类型为password则触发, 得到用户密码和用户信息
- **接口实现**:PasswordUserDetailServiceImpl调用该接口,在username这个参数进行正则表达式校验,判断是用户名/手机/邮箱,
- 然后用username参数查找数据库得到用户基本信息User来得到密码,然后先从redis得到用户信息currentUserVO,
- 拿不到就去mysql继续得到用户信息currentUserVO. 将数据包装到PasswordSecurityGetterVO并返回如果用户被封禁或被删除则直接返回错误信息
##### 请求参数
###### 请求头
| 参数名             | 是否必填      | 数据类型   | 说明                          | 示例                                        |
|-----------------|-----------|--------|-----------------------------|-------------------------------------------|
| Content-Type    | 是         | string | 请求体类型                       | application/json                          |


##### 响应数据
###### 响应状态码
- 200: 请求成功
- else: 异常

###### 响应体 PasswordSecurityGetterVO
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "phoneCode(String)": "123456",
    "currentUserDTO(CurrentUserDTO)": {
      "id(Long)": 1,
      "username(String)": "wddyxd",
      "nickName(String)": "wddyxd",
      "avatar(String)": "",
      "roles(List<String>)": [
        "ROLE_SUPER_ADMIN"
      ],
      "permissionValueList(List<String>)": [
        "user.add",
        "user.update",
        "user.list",
        "user.remove"
      ]
    }
  }
}
```

#### 用户登录接口的手机验证码登录接口
##### 基础信息
- **接口名称**: 手机验证码登录
- **接口路径**: `/api/user/auth/phoneCodeSecurityGetter/{phone}`
- **请求方法**: GET
- **接口权限**:任何用户无需登录可访问,但不能通过网关访问
- **接口描述**: 在用户登录接口触发时如果登录类型为phoneCode则触发, 得到手机验证码和用户信息
- **接口实现**:        PhoneCodeUserDetailServiceImpl调用该接口,
  - 然后根据手机号查找数据库得到用户基本信息User来判断用户是否存在和正常使用,然后先从redis得到用户信息currentUserVO和用户的手机验证码,
  - 拿不到用户信息就去mysql继续得到用户信息CurrentUserVO,但拿不到手机验证码就返回错误. 将数据包装到PhoneCodeSecurityGetterVO并返回
  - 如果用户被封禁或被删除则直接返回错误信息
##### 请求参数
###### 请求头
| 参数名             | 是否必填      | 数据类型   | 说明                          | 示例                                        |
|-----------------|-----------|--------|-----------------------------|-------------------------------------------|
| Content-Type    | 是         | string | 请求体类型                       | application/json                          |


##### 响应数据
###### 响应状态码
- 200: 请求成功
- else: 异常
-
###### 响应体 PhoneCodeSecurityGetterVO
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "phoneCode(String)": "123456",
    "currentUserDTO(CurrentUserDTO)": {
      "id(Long)": 1,
      "username(String)": "wddyxd",
      "nickName(String)": "wddyxd",
      "avatar(String)": "",
      "roles(List<String>)": [
        "ROLE_SUPER_ADMIN"
      ],
      "permissionValueList(List<String>)": [
        "user.add",
        "user.update",
        "user.list",
        "user.remove"
      ]
    }
  }
}
```

#### 用户登录接口的邮箱验证码登录接口
##### 基础信息
- **接口名称**: 邮箱验证码登录
- **接口路径**: `/api/user/auth/emailCodeSecurityGetter/{email}`
- **请求方法**: GET
- **接口权限**:任何用户无需登录可访问,但不能通过网关访问
- **接口描述**: 在用户登录接口触发时如果登录类型为emailCode则触发, 得到邮箱验证码和用户信息
- **接口实现**:        EmailCodeUserDetailServiceImpl调用该接口,
  - 然后根据邮箱查找数据库得到用户基本信息User来判断用户是否存在和正常使用,然后先从redis得到用户信息currentUserVO和用户的邮箱验证码,
  - 拿不到用户信息就去mysql继续得到用户信息CurrentUserVO,但拿不到邮箱验证码就返回错误. 将数据包装到EmailCodeSecurityGetterVO并返回
  如果用户被封禁或被删除则直接返回错误信息
##### 请求参数
###### 请求头
| 参数名             | 是否必填      | 数据类型   | 说明                          | 示例                                        |
|-----------------|-----------|--------|-----------------------------|-------------------------------------------|
| Content-Type    | 是         | string | 请求体类型                       | application/json                          |


##### 响应数据
###### 响应状态码
- 200: 请求成功
- else: 异常
-
###### 响应体(EmailCodeSecurityGetterVO)
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "emailCode(String)": "123456",
    "currentUserDTO(CurrentUserDTO)": {
      "id(Long)": 1,
      "username(String)": "wddyxd",
      "nickName(String)": "wddyxd",
      "avatar(String)": "",
      "roles(List<String>)": [
        "ROLE_SUPER_ADMIN"
      ],
      "permissionValueList(List<String>)": [
        "user.add",
        "user.update",
        "user.list",
        "user.remove"
      ]
    }
  }
}
```

#### 用户登出接口
##### 基础信息
- **接口名称**: 用户登出
- **接口路径**: `/api/user/auth/logout`
- **请求方法**: POST
- **接口权限**:任何已登录用户可访问
- **接口描述**: 按下登出按钮后触发,然后删除redis中的token信息
- **接口实现**:在TokenLogoutHandler删除redis中的token信息然后返回空结果
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |


##### 响应数据
###### 响应状态码
- 200: 请求成功
- else: 异常

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": null
}
```

#### 获取手机验证码接口
##### 基础信息
- **接口名称**: 获取手机验证码
- **接口路径**: `/api/user/auth/phoneCode/{phone}`
- **请求方法**: GET
- **接口权限**:任何用户无需登录可访问
- **接口描述**: 获取手机验证码接口,在手机登录,修改个人信息时调用
- **接口实现**:        前端设置用户60秒访问一次该接口,
- 获取手机号,判断合法性后发送手机验证码,同时要根据手机号对接口进行基于 Redis 的计数器限流和sentinel限流,
- 可以用短信服务商 API 将验证码发送给用户,但这里暂时简化为后端生成并打印随机验证码,
- 在redis查询到手机号的访问信息则直接返回提示,
- 验证码保存在redis中,过期时间为15分钟,然后在redis记录该手机号的访问信息,过期时间为60秒,返回空值
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |


##### 响应数据
###### 响应状态码
- 200: 请求成功
- else: 异常

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": null
}
```

#### 获取邮箱验证码接口
##### 基础信息
- **接口名称**: 获取邮箱验证码
- **接口路径**: `/api/user/auth/emailCode`
- **请求方法**: POST
- **接口权限**:任何用户无需登录可访问
- **接口描述**: 获取邮箱验证码接口,在邮箱登录,修改个人信息时调用
- **接口实现**:-         前端设置用户60秒访问一次该接口,
- 获取邮箱,判断合法性后发送邮箱验证码,同时要根据邮箱对接口进行基于 Redis 的计数器限流和sentinel限流,
- 可以用第三方邮箱服务商将验证码发送给用户,但这里简化为编写邮箱发送工具类,根据SMTP协议发送验证码,
- 在redis查询到邮箱的访问信息则直接返回提示,
- 验证码保存在redis中,过期时间为15分钟,然后在redis记录该邮箱的访问信息,过期时间为60秒,返回空值
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |


##### 响应数据
###### 响应状态码
- 200: 请求成功
- else: 异常

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": null
}
```


- (注册业务备注: 如果用户先成为了管理者就只能让超级管理者手动分配该管理者为其他角色,
- 如果之前不存在注册表单描述的用户将会在检测账号合法性后添加账号,并根据注册的客户端分配不同角色,
- 如果注册时发现表单描述的账户有另一个客户端的角色则额外分配另一个角色
- 如果已存在的用户不是管理者但需要成为管理者则需要超级管理员分配该用户为管理者)

#### 用户端用户注册接口
##### 基础信息
- **接口名称**: 用户注册
- **接口路径**: `/api/user/auth/customUserRegister`
- **请求方法**: POST
- **接口权限**:任何用户无需登录可访问
- **接口描述**: 用户端的注册接口
- **接口实现**:首先判断用户名,手机号和邮箱的合法性,
- 得到参数后分别根据用户名,手机号和邮箱获取user表的一条数据,
- 如果三份数据都是null则注册用户,分配ROLE_NEW_USER角色,创建user表,关联user_role表,创建user_detail表并填充默认数据
- 其他情况返回错误
- 其中,用加密算法(这里用MD5)加密密码,同时将事先存储到redis的phoneCode和emailCode提取来验证手机和邮箱的有效性
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |

###### 请求体 (CustomUserRegisterDTO)
```json
{
  "username(String)": "wdd",
  "phone(String)": "13800000001",
  "phoneCode(String)": "123456",
  "email(String)": "xxxx@qq.com",
  "emailCode(String)": "123456",
  "password(String)": "123456"
}
```

##### 响应数据
###### 响应状态码
- 200: 请求成功
- else: 异常

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": null
}
```

#### 商户端商户注册接口
##### 基础信息
- **接口名称**: 商户端商户注册
- **接口路径**: `/api/user/auth/merchantRegister`
- **请求方法**: POST
- **接口权限**:任何用户无需登录可访问
- **接口描述**: 商户端的注册接口
- **接口实现**:首先判断用户名,手机号和邮箱的合法性,
- 得到参数后分别根据用户名,手机号和邮箱获取user表的一条数据,
- 如果三份数据都是null则调用用户端注册接口
- 如果三份数据都指向同一个用户而且没有被分配商户相关角色则将该用户分配ROLE_NEW_MERCHANT角色,
- 并创建merchant_supplement表,
- 其他情况返回错误
- 其中,用加密算法(这里用MD5)加密密码,同时将事先存储到redis的phoneCode和emailCode提取来验证手机和邮箱的有效性
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |

###### 请求体 (MerchantRegisterDTO)
```json
{
  "username(String)": "wdd",
  "phone(String)": "13800000001",
  "phoneCode(String)": "123456",
  "email(String)": "xxxx@qq.com",
  "emailCode(String)": "123456",
  "password(String)": "123456",
  "shopName(String)": "shopName",
  "shopCategoryId(Long)": 1,
  "shopAddress(String)": "shopAddress",
  "shopLicense(String)": "shopLicense",
  "shopLicenseImage(String)": "shopLicenseImage"
}
```

##### 响应数据
###### 响应状态码
- 200: 请求成功
- else: 异常

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": null
}
```

#### 根据验证码找回密码接口
##### 基础信息
- **接口名称**: 根据验证码找回密码
- **接口路径**: `/api/user/auth/rebuildPassword`
- **请求方法**: POST
- **接口权限**: 任何用户无需登录可访问
- **接口描述**: 支持根据手机验证码为账号找回密码
- **接口实现**: 需要手机和验证码和新密码,后端会判断手机和验证码是否合法且吻合.
- 成功更改密码后时redis存储5秒过期的时间戳,过期时间内不能重新更改密码,更改密码后强制在redis的当前用户的token删除

##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |

###### 请求体 (RebuildPasswordDTO)
```json
{
  "phone(String)":"13800000001",
  "phoneCode(String)": "123456",
  "newPassword(String)": "123456"
}
```

##### 响应数据
###### 响应状态码
- 200: 请求成功
- else: 异常

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data":null
}
```

### 用户相关接口 UserController

#### 分页获取用户列表接口
##### 基础信息
- **接口名称**: 分页获取用户列表
- **接口路径**: `/api/user/user/list`
- **请求方法**: GET
- **接口权限**:需要user.list权限
- **接口描述**: 在管理员的用户管理主界面查看所有用户
- **接口实现**: 在管理员的用户管理主界面查看所有用户,支持根据关键字在mysql为用户名,昵称建立索引以支持关键字搜索
- 返回List<User>并由PageResult包装,对敏感信息进行脱敏处理
- 注意无论用户是否被逻辑删除或被封禁都应该被被查到
- 
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |


###### 请求体
| 参数名      | 是否必填    | 数据类型    | 说明    | 示例  |
|----------|---------|---------|-------|-----|
| pageNum  | 否(默认1)  | Integer | 页码    | 1   |
| pageSize | 否(默认10) | Integer | 每页数据量 | 10  |
| search   | 否(默认"") | string  | 关键字   | abc |


##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "records(List<User>)": [
      {
        "id": 1,
        "username": "wddyxd",
        "phone": "156****8742",
        "email": "www********@qq.com",
        "nickName": "wddyxd",
        "avatar": "",
        "status": 0,
        "createTime": "2025-10-21T12:17:56.000+00:00",
        "updateTime": "2025-10-21T12:18:00.000+00:00",
        "deleted": false
      }
    ],
    "total": 1,
    "size": 10,
    "current": 1,
    "pages": 1
  }
}
```

#### 获取个人用户详细信息接口
##### 基础信息
- **接口名称**: 获取个人用户详细信息
- **接口路径**: `/api/user/user/detail/{id}`
- **请求方法**: GET
- **接口权限**:需要user.list权限而且(参数的id等于访问者的id或者访问者是管理员)
- **接口描述**: 在用户端点击头像跳转到用户设置界面,后台或商户端前往个人中心,管理员在用户管理点击用户可触发该接口,查询该用户详细信息
- **接口实现**:返回UserDetailVO,其中必携带BasicUserDetailVO和CurrentUserDTO,如果是商户且在商户端额外携带MerchantDetailVO,
- 如果是管理员查看用户详细信息则额外调用获取用户的地址簿接口,携带List<userAddressVO>,MerchantDetailVO,对敏感信息进行脱敏处理
- 注意无论该用户是否被逻辑删除都应该被被查到,但不应该查到被删除的子信息
##### 请求参数
###### 请求头
| 参数名          | 是否必填    | 数据类型   | 说明    | 示例                                      |
|--------------|---------|--------|-------|-----------------------------------------|
| Content-Type | 是       | string | 请求体类型 | application/json                        |
| token        | 是       | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |
| client       | 是(前端填充) | string | 客户端类型 | 用户端                                     |


##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体 (UserDetailVO)
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "basicUserDetailVO(BasicUserDetailVO)": {
      "id": 1,
      "username": "wddyxd",
      "phone": "156****8742",
      "email": "www********@qq.com",
      "nickName": "wddyxd",
      "avatar": "",
      "realName": "张三",
      "gender": 1,
      "birthday": "2005-10-21T12:17:56.000+00:00",
      "region": "上海",
      "idCard": "123456789012345678",
      "isIdCardVerified": true,
      "lastLoginTime": "2025-10-21T12:17:56.000+00:00",
      "lastLoginIp": "127.0.0.1",
      "lastLoginDevice": "Windows 11",
      "money": 1000.00,
      "status": 0,
      "createTime": "2025-10-21T12:17:56.000+00:00",
      "updateTime": "2025-10-21T12:18:00.000+00:00",
      "deleted": false
    },
    "userAddressVO(List<UserAddressVO>)": [
      {
        "id": 1,
        "receiver": "张三",
        "phone": "156****8742",
        "province": "广东",
        "city": "汕头",
        "district": "濠江",
        "address": "达濠街道西元大盘1010号",
        "isDefault": true
      }
    ],
    "currentUserDTO(CurrentUserDTO)": {
      "id": 1,
      "username": "wddyxd",
      "nickName": "wddyxd",
      "avatar": "",
      "roles": [
        "ROLE_SUPER_ADMIN"
      ],
      "permissionValueList": [
        "user.add",
        "user.update",
        "user.list",
        "user.remove"
      ]
    },
    "merchantSupplementVO(MerchantSupplementVO)": {
      "id": 1,
      "shopName": "广文书店",
      "shopCategory": "美食",
      "shopAddress": "汕头达濠西元大盘1010号",
      "shopLicense": "123*******4352",
      "shopLicenseImage": "http://example.com/logo.png",
      "positiveComment": 10,
      "negativeComment": 0,
      "shopStatus": 1
      
    }
  }
}
```

#### 用户概要接口
##### 基础信息
- **接口名称**: 用户概要
- **接口路径**: `/api/user/user/profile/{id}`
- **请求方法**: GET
- **接口权限**: 任何用户无需登录都可访问
- **接口描述**: 网站通用的表示某用户的接口,常被其他需要携带用户信息返回的接口调用
- **接口实现**:查询user表获取用户概要,返回UserProfileVO
- 访问被删除的用户则返回空用户
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |


##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体 UserProfileVO
```json
{
  "code": 200,
  "msg": "操作成功",
  "data":{

    "id": 1,
    "username": "wddyxd",
    "nickName": "wddyxd",
    "avatar": "https://example.com/avatar.png"
      
    
  }
}
```

#### 获取自己的认证信息接口
##### 基础信息
- **接口名称**: 获取自己的认证信息
- **接口路径**: `/api/user/user/me`
- **请求方法**: GET
- **接口权限**: 所有用户登录后可访问
- **接口描述**: 获取自己的认证信息,在登录成功后每次跳转页面都会访问该接口
- **接口实现**: 访问接口时被spring-security的过滤器链拦截,
- 其中TokenAuthFilter会解析token并根据token信息从redis获得用户信息然后将信息包装到SecurityContextHolder,得不到信息就返回异常,
- (随着开发的进行,token存储的信息会得到充分利用,比如token存储的客户端可以让token不能跨端使用,token存储的ip实现ip请求限流)
- 然后从SecurityContextHolder获得用户信息并返回CurrentUserDTO
- 只需返回没有被逻辑删除的数据
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 401: token类的异常
- 500: 服务器错误

###### 响应体 CurrentUserDTO
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "id": 1,
    "username": "wddyxd",
    "nickName": "wddyxd",
    "avatar": "",
    "roles": [
      "ROLE_SUPER_ADMIN"
    ],
    "permissionValueList": [
      "user.add",
      "user.update",
      "user.list",
      "user.remove"
    ]
  }
}
```

#### 访问某用户接口
##### 基础信息
- **接口名称**: 访问某用户
- **接口路径**: `/api/user/user/visit/{id}`
- **请求方法**: GET
- **接口权限**: 任何用户无需登录都可访问
- **接口描述**: 在用户端或商户端点击某用户的概要可以访问该用户
- **接口实现**:查询user,user_detail,merchant_supplement表获取用户信息,返回UserVisitVO
- 访问被删除的用户则返回空用户
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |


##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体 UserVisitVO
```json
{
  "code": 200,
  "msg": "操作成功",
  "data":{
    
    "id": 1,
    "username": "wddyxd",
    "nickName": "wddyxd",
    "avatar": "https://example.com/avatar.png",
    "status": 0,

    "gender": 1,
    "birthday": "2005-10-21T12:17:56.000+00:00",
    "region": "上海",

    "shopName?": "广文书店",
    "shopCategory?": "美食",
    "shopAddress?": "汕头达濠西元大盘1010号",

    "shopStatus?": 1  
      
    
  }
}
```

#### 添加管理员接口
##### 基础信息
- **接口名称**: 添加管理员
- **接口路径**: `/api/user/user/addAdmin`
- **请求方法**: POST
- **接口权限**:需要user.add权限
- **接口描述**: 在后台的用户管理中添加用户,这里的用户指的是管理员
- **接口实现**: 传入CustomUserRegisterDTO,然后判断用户的用户名,手机或邮箱是否被其他用户占用,
- 如果都没被占用则直接添加用户,为这个用户赋予ROLE_NEW_ADMIN和ROLE_NEW_USER角色,然后在user_detail中添加默认的用户详细信息
- 否则返回错误
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体 (CustomUserRegisterDTO)
```json
{
  "username(String)": "wdd",
  "phone(String)": "13800000001",
  "phoneCode(String)": "123456",
  "email(String)": "xxxx@qq.com",
  "emailCode(String)": "123456",
  "password(String)": "123456"
}
```

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data":null
}
```

#### 更新用户密码接口
##### 基础信息
- **接口名称**: 更新用户密码
- **接口路径**: `/api/user/user/update/passowrd`
- **请求方法**: PUT
- **接口权限**: 需要user.update权限或更新者的id等于参数id
- **接口描述**: 更新用户密码
- **接口实现**:传入UpdatePasswordDTO,查询当前用户,
- 比较旧密码和新密码是否不一致,接下来比较旧密码,手机是否和查找到的用户的信息吻合,
- 接下来比较手机验证码是否和手机吻合,然后才更新密码
- 最后在在redis记录上次修改密码的时间戳,有效期5秒,有效期内禁止修改
- 查询不到用户或用户被逻辑删除则不应该执行更新
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体 UpdatePasswordDTO
```json
{
  "id(Long)": 1,
  "phoneCode(String)": "123456",
  "phone(String)": "15626448742",
  "oldPassword(String)": "123456",
  "newPassword(String)": "654321"
}
```

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data":null
}
```

#### 换绑手机号接口
##### 基础信息
- **接口名称**: 换绑手机号
- **接口路径**: `/api/user/user/update/phone`
- **请求方法**: PUT
- **接口权限**: 需要user.update权限或更新者的id等于参数id
- **接口描述**: 换绑手机号
- **接口实现**:传入UpdatePhoneDTO,查询当前用户,
- 比较旧手机号和新手机号是否不一致,接下来比较旧手机号是否和数据库的数据吻合,
- 接下来比较手机验证码是否和新手机号吻合,然后才更新手机号
- 在mysql设置手机号唯一性约束
- 查询不到用户或用户被逻辑删除则不应该执行更新
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体 UpdatePhoneDTO
```json
{
  "id(Long)": 1,
  "oldPhone(String)": "15626448742",
  "newPhone(String)": "15626448743",
  "phoneCode(String)": "123456"
}
```

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data":null
}
```

#### 换绑邮箱接口
##### 基础信息
- **接口名称**: 换绑邮箱
- **接口路径**: `/api/user/user/update/email`
- **请求方法**: PUT
- **接口权限**: 需要user.update权限或更新者的id等于参数id
- **接口描述**: 换绑邮箱
- **接口实现**:传入用户UpdateEmailDTO,查询当前用户,
- 比较旧邮箱和新邮箱是否不一致,接下来比较旧邮箱是否和数据库的数据吻合,
- 接下来比较邮箱验证码是否和新邮箱吻合,然后才更新邮箱
- 在mysql设置邮箱唯一性约束
- 查询不到用户或用户被逻辑删除则不应该执行更新
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体 UpdateEmailDTO
```json
{
  "id(Long)": 1,
  "oldEmail(String)": "15626448742",
  "newEmail(String)": "15626448743",
  "emailCode(String)": "123456"
}
```

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data":null
}
```

#### 更新头像接口
##### 基础信息
- **接口名称**: 更换头像
- **接口路径**: `/api/user/user/update/avatar`
- **请求方法**: PUT
- **接口权限**: 需要user.update权限或更新者的id等于参数id
- **接口描述**: 更换头像
- **接口实现**: 传入UpdateAvatarDTO更换头像,查询不到用户或用户被逻辑删除则不应该执行更新
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体 UpdateAvatarDTO
```json
{
  "id(Long)": 1,
  "avatar(String)": "http:/www.../avatar.png"
}
```

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data":null
}
```

#### 更新昵称接口
##### 基础信息
- **接口名称**: 更新昵称
- **接口路径**: `/api/user/user/update/nickName`
- **请求方法**: PUT
- **接口权限**: 需要user.update权限或更新者的id等于参数id
- **接口描述**: 更新昵称
- **接口实现**: 传入UpdateNickNameDTO来更新昵称,查询不到用户或用户被逻辑删除则不应该执行更新
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体 UpdateNickNameDTO
```json
{
  "id(Long)": 1,
  "nickname(String)": "wddyxd"
}
```

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data":null
}
```

#### 更新性别接口
##### 基础信息
- **接口名称**: 更新性别
- **接口路径**: `/api/user/user/update/gender`
- **请求方法**: PUT
- **接口权限**: 需要user.update权限或更新者的id等于参数id
- **接口描述**: 更换性别
- **接口实现**: 传入UpdateGenderDTO来更新昵称,查询不到用户或用户被逻辑删除则不应该执行更新
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体 UpdateGenderDTO
```json
{
  "id(Long)": 1,
  "gender(String)": "1"
}
```

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data":null
}
```

#### 更新生日接口
##### 基础信息
- **接口名称**: 更新生日
- **接口路径**: `/api/user/user/update/birthday`
- **请求方法**: PUT
- **接口权限**: 需要user.update权限或更新者的id等于参数id
- **接口描述**: 更新生日
- **接口实现**: 传入UpdateBirthdayDTO,查询不到用户或用户被逻辑删除则不应该执行更新,
- 更新后在redis进行记录,过期时间是1年,
- 访问接口时存在redis记录则拒绝更新
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体 UpdateBirthdayDTO
```json
{
  "id(Long)": 1,
  "birthday(String)": "2020-01-01"
}
```

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data":null
}
```

#### 更新地域接口
##### 基础信息
- **接口名称**: 更新地域
- **接口路径**: `/api/user/user/update/region`
- **请求方法**: PUT
- **接口权限**: 需要user.update权限或更新者的id等于参数id
- **接口描述**: 更新地域
- **接口实现**: 传入UpdateRegionDTO,查询不到用户或用户被逻辑删除则不应该执行更新,
- 更新后在redis进行记录,过期时间是90天,
- 访问接口时存在redis记录则拒绝更新
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体 UpdateRegionDTO
```json
{
  "id(Long)": 1,
  "region(String)": "广东"
}
```

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data":null
}
```

#### 实名认证接口
##### 基础信息
- **接口名称**: 实名认证
- **接口路径**: `/api/user/user/update/card`
- **请求方法**: PUT
- **接口权限**: 需要user.update权限或更新者的id等于参数id
- **接口描述**: 实名认证
- **接口实现**: 传入UpdateCardDTO ,虽然需要对接外部API,但这里简化实现:
- 检验IdCard格式正确后并且没有已使用的realName和IdCard则直接设置用户是已经完成实名认证的,并为用户升级角色,
- 查询不到用户或用户被逻辑删除则不应该执行更新,
- 在mysql为real_name和id_card添加唯一约束
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体 UpdateCardDTO
```json
{
  "id(Long)": 1,
  "realName(String)": "张三",
  "idCard(String)": "123456789012345678"
}
```

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data":null
}
```

#### 封禁/解封用户接口
##### 基础信息
- **接口名称**: 封禁/解封用户
- **接口路径**: `/api/user/user/status`
- **请求方法**: PUT
- **接口权限**: 需要user.update权限
- **接口描述**: 封禁/解封用户
- **接口实现**: 封禁/解封用户,封禁用户时让用户强制下线,废除用户的token,同时给用户发短信或邮箱,
- 查询不到用户或用户被逻辑删除则跳过
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体
| 参数名    | 是否必填 | 数据类型   | 说明  | 示例  |
|--------|------|--------|-----|-----|
| id     | 是    | Long   | id  | 1   |

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data":null
}
```

#### 删除用户接口
##### 基础信息
- **接口名称**: 删除用户
- **接口路径**: `/api/user/user/delete/{id}`
- **请求方法**: DELETE
- **接口权限**:需要user.delete权限
- **接口描述**: 只有管理员有权限删除用户,普通用户要注销需要将注销请求发送给管理员
- **接口实现**:- 在删除账户之前在redis查看上次删除该用户的时间戳如果存在则直接返回,
- 然后保证该用户没有注册商户,否则要先调用删除商户接口,
- 然后要须保证该该账户存在且该账户不存在自己的状态为尚未完成的订单,否则要调用强制取消和退货订单接口,
- 然后将用户的充值金额和领取的优惠券退还,
- 然后将唯一约束字段(都是varchar字段)修改成 "原先字段.DELETED.删除时间戳"的格式,然后将user,user_detail,user_address表的相关字段逻辑删除
- 然后将用户和用户相关角色的关联逻辑删除
- 然后在redis添加本次删除的时间戳
- **接口备注**:删除接口可能需要引入MQ和seata和状态机
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体
| 参数名         | 是否必填 | 数据类型    | 说明   | 示例                            |
|-------------|------|---------|------|-------------------------------|
| id          | 是    | Long    | id   | none                          |


##### 响应数据
###### 响应状态码
- 200: 删除成功
- 400: 请求参数错误
- 403: 权限不足（非管理员）
- 404: 用户不存在
- 409: 未满足删除前置条件，无法删除
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data":null
}
```

### 用户地址簿相关接口 UserAddressController

#### 获取个人用户地址簿接口
##### 基础信息
- **接口名称**: 获取个人用户地址簿
- **接口路径**: `/api/user/userAddress/list/{id}`
- **请求方法**: GET
- **接口权限**: 登录而且访问者的id等于参数的id
- **接口描述**: 获取个人用户地址簿
- **接口实现**: 在用户端个人中心或后台的用户管理可查询用户端地址簿,返回List<UserAddressDTO>
- 只需返回没有被逻辑删除的地址
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体 List<UserAddressDTO>
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": [
    {
      "id": 1,
      "receiver": "张三",
      "phone": "15626448742",
      "province": "广东",
      "city": "汕头",
      "district": "濠江",
      "address": "达濠街道西元大盘1010号",
      "isDefault": true
    }
  ]
}
```

#### 新增地址簿接口
##### 基础信息
- **接口名称**: 新增地址簿
- **接口路径**: `/api/user/userAddress/add`
- **请求方法**: POST
- **接口权限**: 登录而且访问者的id等于参数的id
- **接口描述**: 新增地址簿,仅允许用户添加地址
- **接口实现**: 传入UserAddressDTO,一个用户最多添加5个正常状态的地址簿,
- 如果将地址设为默认地址,则将之前默认地址设为非默认地址
- 用redis存储添加的时间戳,过期5秒,redis数据存在期间不能添加数据
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体 UserAddressDTO
```json
{
  "id": 1,
  "receiver": "张三",
  "phone": "15626448742",
  "province": "广东",
  "city": "汕头",
  "district": "濠江",
  "address": "达濠街道西元大盘1010号",
  "isDefault": true
}
```


##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": null
}
```

#### 修改地址簿接口
##### 基础信息
- **接口名称**: 修改地址簿
- **接口路径**: `/api/user/userAddress/update`
- **请求方法**: POST
- **接口权限**: 登录而且访问者的id等于参数的id
- **接口描述**: 修改地址簿
- **接口实现**: 传入List<UserAddressDTO>,注意只将第一个默认地址设为默认地址
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体 List<UserAddressDTO>
```json
[
  {
    "id": 1,
    "receiver": "张三",
    "phone": "15626448742",
    "province": "广东",
    "city": "汕头",
    "district": "濠江",
    "address": "达濠街道西元大盘1010号",
    "isDefault": true
  }
]
```


##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": null
}
```

#### 删除地址簿接口
##### 基础信息
- **接口名称**: 删除地址簿
- **接口路径**: `/api/user/userAddress/delete/{id}`
- **请求方法**: DELETE
- **接口权限**: 登录而且访问者的id等于参数的id
- **接口描述**: 删除地址簿
- **接口实现**: 逻辑删除地址簿
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |


##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体 List<UserAddressVO>
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": null
}
```

### 商户补丁相关接口 MerchantSupplementController

#### 删除商户接口
##### 基础信息
- **接口名称**: 删除商户
- **接口路径**: `/api/user/merchantSupplement/delete/{id}`
- **请求方法**: DELETE
- **接口权限**:需要user.delete权限
- **接口描述**: 只有管理员有权限删除商户,普通商户要注销需要将注销请求发送给管理员
- **接口实现**:- 在删除账户之前在redis查看上次删除该用户的时间戳如果存在则直接返回, 
- 否则要强制取消和退货为完成的订单(调用取消和退货订单接口)
- 然后先强制下架商品再删除商品(调用删除商品接口,其中回收所有的用户领取的自己发放的优惠券,然后将该商家的优惠劵折现删除),
- 然后将唯一约束字段(都是varchar字段)修改成 "原先字段.DELETED.删除时间戳"的格式,然后将merchant_supplement表逻辑删除
- 然后将用户和商户相关角色的关联逻辑删除
- 然后在redis添加本次删除的时间戳
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |


##### 响应数据
###### 响应状态码
- 200: 删除成功
- 400: 请求参数错误
- 403: 权限不足（非管理员）
- 404: 用户不存在
- 409: 未满足删除前置条件，无法删除
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data":null
}
```

#### 更新基础商户信息接口
##### 基础信息
- **接口名称**: 更新基础商户信息
- **接口路径**: `/api/user/merchantSupplement/update/custom`
- **请求方法**: PUT
- **接口权限**: 需要user.update权限或更新者的id等于参数id
- **接口描述**: 更新基础商户信息
- **接口实现**: 传入UpdateMerchantCustomDTO,更新基础商户信息,查询不到用户或用户被逻辑删除则不应该执行更新

##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体 UpdateMerchantCustomDTO
```json
{
  "id(Long)": 1,
  "shopName(String)": "广中书店",
  "shopCategoryId(String)": "1",
  "shopAddress(String)": "汕头达濠西元大盘1010号"
}
```

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data":null
}
```

#### 许可证认证接口
##### 基础信息
- **接口名称**: 许可证认证
- **接口路径**: `/api/user/merchantSupplement/update/license`
- **请求方法**: PUT
- **接口权限**: 需要user.update权限或更新者的id等于参数id
- **接口描述**: 许可证认证
- **接口实现**: 传入UpdateMerchantLicenseDTO,提供许可证后异步通知管理员审核,应该审核后管理员手动为其升级角色,
- 但这里实现为直接为该用户升级角色
- 查询不到用户或用户被逻辑删除则不应该执行更新

##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体 UpdateMerchantLicenseDTO
```json
{
  "id(Long)": 1,
  "shopLicense(String)": "xxx",
  "shopLicenseImage(String)": "xxx"
  }
```

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data":null
}
```

### 店铺分类相关接口 ShopCategoryController

#### 增加店铺分类接口
##### 基础信息
- **接口名称**: 增加店铺分类
- **接口路径**: `/api/user/shopCategory/add`
- **请求方法**: POST
- **接口权限**:需要shopCategory.add权限
- **接口描述**: 管理员可以在店铺分类界面增加店铺分类
- **接口实现**: 增加店铺分类
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体
| 参数名        | 是否必填 | 数据类型    | 说明     | 示例    |
|------------|------|---------|--------|-------|
| name       | 是    | string  | 店铺分类名  | 家居    |

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": null
}
```

#### 分页查询店铺分类接口
##### 基础信息
- **接口名称**: 分页查询店铺分类
- **接口路径**: `/api/user/shopCategory/list`
- **请求方法**: GET
- **接口权限**: 需要shopCategory.list权限
- **接口描述**: 在管理员的角色管理主界面查看所有存在的店铺分类
- **接口实现**: 在管理员的角色管理主界面查看所有存在的店铺分类,支持根据关键字搜索,
- 在mysql为店铺分类名建立索引以支持关键字搜索
- 返回List<ShopCategory>并由PageResult包装
- 注意无论店铺分类是否被逻辑删除都应该被被查到
- **接口备注**:由于店铺分类数量较少, 所以后期也可以改为分组获取全部店铺分类
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |


###### 请求体
| 参数名      | 是否必填    | 数据类型    | 说明    | 示例  |
|----------|---------|---------|-------|-----|
| pageNum  | 否(默认1)  | Integer | 页码    | 1   |
| pageSize | 否(默认10) | Integer | 每页数据量 | 10  |
| search   | 否(默认"") | string  | 关键字   | abc |


##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "records": [
      {
        "id": 1,
        "name": "家居",
        "code": "1001",
        "createTime": "2025-10-21T12:17:56.000+00:00",
        "updateTime": "2025-10-21T12:18:00.000+00:00",
        "deleted": false
      }
    ],
    "total": 1,
    "size": 10,
    "current": 1,
    "pages": 1
  }
}
```

#### 更新店铺分类内容接口
##### 基础信息
- **接口名称**: 更新店铺分类
- **接口路径**: `/api/user/shopCategory/update`
- **请求方法**: PUT
- **接口权限**:需要shopCategory.update权限
- **接口描述**: 管理员可以在店铺分类管理界面更新店铺分类信息
- **接口实现**: 更新店铺分类信息,店铺分类被逻辑删除则拒绝更新
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体
| 参数名  | 是否必填 | 数据类型   | 说明    | 示例        |
|------|------|--------|-------|-----------|
| name | 否    | string | 店铺分类名 | ROLE_USER |

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": null
}
```

#### 删除店铺分类接口
##### 基础信息
- **接口名称**: 删除店铺分类
- **接口路径**: `/api/user/shopCategory/delete/{id}`
- **请求方法**: DELETE
- **接口权限**:需要shopCategory.delete权限
- **接口描述**: 只有超级管理员有权限删除店铺分类,删除店铺分类按钮在店铺分类管理界面
- **接口实现**:- 删除店铺分类,然后遍历merchant_supplement表,将涉及被删除分类的记录变成"默认分类"
- 只有超级管理员才可以删除店铺分类
- 数据库第一个分类是默认分类,不能删除默认分类
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

##### 响应数据
###### 响应状态码
- 200: 删除成功
- 400: 请求参数错误
- 403: 权限不足（非管理员）
- 404: 用户不存在
- 409: 未满足删除前置条件，无法删除
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": null
}
```

### 角色相关接口 RoleController

#### 分页获取角色列表接口
##### 基础信息
- **接口名称**: 分页获取角色列表
- **接口路径**: `/api/user/role/list`
- **请求方法**: GET
- **接口权限**:需要role.list权限
- **接口描述**: 在管理员的角色管理主界面查看所有存在的角色
- **接口实现**: 在管理员的角色管理主界面查看所有存在的角色,支持根据关键字搜索,
- 在mysql为角色名建立索引以支持关键字搜索
- 返回List<Role>并由PageResult包装
- 注意无论角色是否被逻辑删除都应该被被查到
- **接口备注**:由于角色数量较少也只能根据客户端分为3个组,每个用户在每组最多只能获得一个角色
- ,所以后期也可以改为分组获取全部角色
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |


###### 请求体
| 参数名      | 是否必填    | 数据类型    | 说明    | 示例  |
|----------|---------|---------|-------|-----|
| pageNum  | 否(默认1)  | Integer | 页码    | 1   |
| pageSize | 否(默认10) | Integer | 每页数据量 | 10  |
| search   | 否(默认"") | string  | 关键字   | abc |


##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "records": [
      {
        "id": 1,
        "roleName": "ROLE_SUPER_ADMIN",
        "roleCode": "1001",
        "createTime": "2025-10-21T12:17:56.000+00:00",
        "updateTime": "2025-10-21T12:18:00.000+00:00",
        "deleted": false
      }
    ],
    "total": 1,
    "size": 10,
    "current": 1,
    "pages": 1
  }
}
```

#### 查看角色详细信息接口
##### 基础信息
- **接口名称**: 查看角色详细信息
- **接口路径**: `/api/user/role/detail/{id}`
- **请求方法**: GET
- **接口权限**: 需要role.list权限
- **接口描述**: 在管理员的角色管理主界面查看角色详情
- **接口实现**: 查询role和permissions表中获取角色信息和角色关联的权限
- 注意无论角色是否被逻辑删除都应该被被查到,但权限应该是没有被逻辑删除的
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "id": 1,
    "roleName": "ROLE_SUPER_ADMIN",
    "roleCode": "1001",
    "createTime": "2025-10-21T12:17:56.000+00:00",
    "updateTime": "2025-10-21T12:18:00.000+00:00",
    "deleted": false,
    
    "permissions": [
      {
        "id": 1,
        "name": "用户管理",
        "permissionValue": "user.list",
        "createTime": "2025-10-21T12:17:56.000+00:00",
        "updateTime": "2025-10-21T12:18:00.000+00:00",
        "deleted": false
      }
    ]
  }
}
```

#### 手动为特定用户分配角色接口
##### 基础信息
- **接口名称**: 手动为特定用户分配角色
- **接口路径**: `/api/user/role/assign`
- **请求方法**: POST
- **接口权限**: 需要user.update权限
- **接口描述**: 管理员可以在用户管理界面查看用户详细信息的时候为某用户分配角色
- **接口实现**:一个用户可以分配最多三个角色,分别是最多一个购物者角色,一个商户角色和一个管理员角色,
- 如果发现roleId不满足分配角色合法性则拒绝分配,
- 否则根据参数查询用户和用户的角色,然后删除用户拥有的角色,然后重新增加角色
- 如果原先没有商户角色但添加了商户则创建商户表,并插入默认商户信息(但如果给了最高级商户角色但没有许可证呢?)
- 只有超级管理员才可以给用户分配管理员角色,管理员只能给用户分配除管理员外的角色
- 如果查询不到用户或用户被逻辑删除则拒绝分配
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |


###### 请求体
| 参数名     | 是否必填 | 数据类型    | 说明     | 示例    |
|---------|------|---------|--------|-------|
| userId  | 是    | Integer | 用户id   | 1     |
| roleIds | 是    | Integer | 角色id数组 | 1,2,3 |


##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": null
}
```

#### 添加角色接口
##### 基础信息
- **接口名称**: 添加角色
- **接口路径**: `/api/user/role/add`
- **请求方法**: POST
- **接口权限**: 需要role.add权限
- **接口描述**: 管理员可以在角色管理界面添加角色
- **接口实现**: 添加角色
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体
| 参数名  | 是否必填 | 数据类型    | 说明   | 示例        |
|------|------|---------|------|-----------|
| name | 是    | string  | 角色名  | ROLE_USER |

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": null
}
```

#### 更新角色内容接口
##### 基础信息
- **接口名称**: 更新角色
- **接口路径**: `/api/user/role/update`
- **请求方法**: PUT
- **接口权限**: 需要role.update权限
- **接口描述**: 管理员可以在角色管理界面更新角色信息
- **接口实现**: 更新角色信息,角色被逻辑删除则拒绝更新
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体
| 参数名  | 是否必填 | 数据类型    | 说明   | 示例        |
|------|------|---------|------|-----------|
| name | 否    | string  | 角色名  | ROLE_USER |

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": null
}
```

#### 删除角色接口
##### 基础信息
- **接口名称**: 删除角色
- **接口路径**: `/api/user/role/delete/{id}`
- **请求方法**: DELETE
- **接口权限**: 需要role.delete权限
- **接口描述**: 只有超级管理员有权限删除角色,删除角色按钮在角色管理界面
- **接口实现**: 删除角色包括根据id将role表的主键等于id,
- role_permissions表role_id等于id和user_role表role_id等于id的行逻辑删除,
- 不能删除每个角色组的"默认角色",然后遍历用户,如果用户有该角色则将该角色变成所在组的"默认角色"
- 只有超级管理员才可以删除角色
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

##### 响应数据
###### 响应状态码
- 200: 删除成功
- 400: 请求参数错误
- 403: 权限不足（非管理员）
- 404: 用户不存在
- 409: 未满足删除前置条件，无法删除
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data":null
}
```

### 权限相关接口 PermissionController

#### 分页获取权限列表接口
##### 基础信息
- **接口名称**: 分页获取权限列表
- **接口路径**: `/api/user/permission/list`
- **请求方法**: GET
- **接口权限**: 需要permission.list权限
- **接口描述**: 在管理员的权限管理主界面查看所有存在的权限
- **接口实现**: 在管理员的权限管理主界面查看所有存在的权限,支持根据关键字搜索,
- 在mysql为权限值建立索引以支持关键字搜索
- 返回List<Permission>并由PageResult包装
- 注意无论用户是否被逻辑删除都应该被被查到
- - **接口备注**:由于权限数量较少也只能根据模块分组
- ,所以后期也可以改为分组获取全部权限
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |


###### 请求体
| 参数名      | 是否必填    | 数据类型    | 说明    | 示例  |
|----------|---------|---------|-------|-----|
| pageNum  | 否(默认1)  | Integer | 页码    | 1   |
| pageSize | 否(默认10) | Integer | 每页数据量 | 10  |
| search   | 否(默认"") | string  | 关键字   | abc |


##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "records": [
      {
        "id": 1,
        "name": "增加用户",
        "permissionValue": "user.add",
        "createTime": "2025-10-21T12:17:56.000+00:00",
        "updateTime": "2025-10-21T12:18:00.000+00:00",
        "deleted": false
      }
    ],
    "total": 1,
    "size": 10,
    "current": 1,
    "pages": 1
  }
}
```

#### 手动为角色分配权限接口
##### 基础信息
- **接口名称**: 手动为特定角色分配权限
- **接口路径**: `/api/user/permission/assign`
- **请求方法**: POST
- **接口权限**: 需要role.update权限
- **接口描述**: 管理员可以在角色管理界面查看角色详细信息的时候为某角色分配权限,
- **接口实现**: permissionIds都指向存在的正常运作的权限才可继续执行接口,
- 根据参数查询角色和角色的权限,然后删除角色拥有的权限,然后重新增加权限
- 只有超级管理员才可以给角色分配权限
- 如果角色被删除则拒绝执行接口
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |


###### 请求体
| 参数名           | 是否必填 | 数据类型    | 说明     | 示例    |
|---------------|------|---------|--------|-------|
| roleId        | 是    | Integer | 角色id   | 1     |
| permissionIds | 是    | Integer | 权限id数组 | 1,2,3 |


##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": null
}
```

#### 添加权限接口
##### 基础信息
- **接口名称**: 添加权限
- **接口路径**: `/api/user/permission/add`
- **请求方法**: POST
- **接口权限**: 需要permission.add权限
- **接口描述**: 管理员可以在权限管理界面添加权限
- **接口实现**: 添加权限
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体
| 参数名             | 是否必填 | 数据类型    | 说明   | 示例        |
|-----------------|------|---------|------|-----------|
| name            | 是    | string  | 角色名  | ROLE_USER |
| permissionValue | 是    | string  | 角色编码 | 1001      |

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": null
}
```

#### 更改权限内容接口
##### 基础信息
- **接口名称**: 更新权限内容接口
- **接口路径**: `/api/user/permission/update`
- **请求方法**: PUT
- **接口权限**:需要permissions.update权限
- **接口描述**: 管理员可以在权限管理界面更新权限信息
- **接口实现**: 更新权限信息,权限被逻辑删除则拒绝更新
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体
| 参数名             | 是否必填 | 数据类型    | 说明   | 示例        |
|-----------------|------|---------|------|-----------|
| name            | 是    | string  | 角色名  | ROLE_USER |
| permissionValue | 是    | string  | 角色编码 | 1001      |

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": null
}
```

#### 删除权限接口
##### 基础信息
- **接口名称**: 删除权限
- **接口路径**: `/api/user/permission/delete/{id}`
- **请求方法**: DELETE
- **接口权限**: 需要permission.delete权限
- **接口描述**: 只有超级管理员有权限删除权限,删除权限按钮在权限管理界面
- **接口实现**: 删除权限包括根据id将permissions表的主键等于id,
- role_permissions表permissions_id等于id的行逻辑删除
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体
| 参数名         | 是否必填 | 数据类型    | 说明   | 示例                            |
|-------------|------|---------|------|-------------------------------|
| id          | 是    | Long    | id   | none                          |


##### 响应数据
###### 响应状态码
- 200: 删除成功
- 400: 请求参数错误
- 403: 权限不足（非管理员）
- 404: 用户不存在
- 409: 未满足删除前置条件，无法删除
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data":{
    "id": 11232439947510
  }
}
```

## 商品模块 product-service

### 商品相关接口 ProductController

#### 分页获取商品列表接口
##### 基础信息
- **接口名称**: 分页获取商品列表
- **接口路径**: `/api/product/product/list`
- **请求方法**: GET
- **接口权限**: 需要product.list权限而且(参数userId等于访问者的id或访问者是管理员)
- **接口描述**: 在后台和商户端的商品管理界面查看所有商品
- **接口实现**: 传入ProductListDTO,在后台和商户端的商品管理界面查看所有存在的商品或当前商户的商品,
- 支持根据商品名搜索,支持根据创建时间或更新时间检索,支持根据商品分类检索,
- 支持根据商品状态检索,支持根据价格范围排序检索
- 在mysql建立索引以支持关键字搜索
- 返回List<ProductProfileVO>并由PageResult包装
- 这里是展示类而不是实体类,因为返回的商品不是商品本身,而是商品+商品分类+默认商品样式的整合
- 返回的商品的名字是商品名字和默认样式的名字的拼接,库存是总库存,价格是默认样式的价格,销量是总销量
- 注意无论商品是否被下架或逻辑删除都应该被被查到
- - **接口备注**:该接口不用于用户端!
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |


###### 请求体 ProductListDTO
```json
{
  "pageNum?(DEFAULT 1)(Integer)": 1,
  "pageSize?(DEFAULT 10)(Integer)": 10,
  "search?(DEFAULT '')(String)": "",
  "name?(DEFAULT '')(String)": "",
  "categoryId?(DEFAULT -1)(Long)": 0,
  "status?(DEFAULT 0)(Integer)": 0,
  "sortBy?(DEFAULT '')(String)": "",
  "sortOrder?(DEFAULT desc)(String)": "desc",
  "userId?(DEFAULT -1)(Long)": 0,
  "minPrice?(DEFAULT 0.00)(BigDecimal)": 0,
  "maxPrice?(DEFAULT 10000.00)(BigDecimal)": 10000
}
```

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体 List<ProductProfileVO>
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "records": [
      {
        "id": 1,
        "productSkuName": "蔡徐坤篮球",
        "userId": 1,
        "username": "wddyxd",
        "name": "篮球",
        "categoryName": "文具",
        "price": 50.00,
        "stock": 100,
        "sales": 100,
        "positiveComment": 10,
        "negativeComment": 0,
        "logo": "https://example.com/logo.png",
        "status": 1,
        "createTime": "2025-10-21T12:17:56.000+00:00",
        "updateTime": "2025-10-21T12:18:00.000+00:00",
        "deleted": false
      }
    ],
    "total": 1,
    "size": 10,
    "current": 1,
    "pages": 1
  }
}
```

#### 在用户端推送商品接口
##### 基础信息
- **接口名称**: 在用户端推送商品
- **接口路径**: `/api/product/product/feed`
- **请求方法**: GET
- **接口权限**: 任何用户无需登录可访问
- **接口描述**: 在用户端首页推送商品
- **接口实现**: 传入ProductFeedDTO,返回List<ProductProfileVO>
- 商品推送可用用机器学习实现也可用基于规则的算法实现,但这里不实现个性化推荐,采用简单推送.
- 每次触发都会推送的分类标识的最新商品,其中分类标识包括推荐商品和最新商品以及具体分类,
- 在高级搜索有筛选器,根据地区和排序进行筛选,每次触发该接口,前一次的返回结果不会丢失.
- 后续接入Elasticsearch
- **接口备注**:该接口只用于用户端!
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |


###### 请求体 ProductFeedDTO
```json
{
  "pageNum?(DEFAULT 1)(Integer)": 1,
  "pageSize?(DEFAULT 20)(Integer)": 20,
  "categoryCode?(DEFAULT 1)(Long)": 1,
  "search?(DEFAULT '')(String)": "",
  "region?(DEFAULT '')(String)": "",
  "sort?(DEFAULT '')(String)": ""
}
```

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体 List<ProductProfileVO>
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "records": [
      {
        "id": 1,
        "productSkuName": "蔡徐坤篮球",
        "userId": 1,
        "username": "wddyxd",
        "name": "篮球",
        "categoryName": "文具",
        "price": 50.00,
        "stock": 100,
        "sales": 100,
        "positiveComment": 10,
        "negativeComment": 0,
        "logo": "https://example.com/logo.png",
        "description": "篮球......",
        "status": 1,
        "createTime": "2025-10-21T12:17:56.000+00:00",
        "updateTime": "2025-10-21T12:18:00.000+00:00",
        "deleted": false
      }
    ],
    "total": 1,
    "size": 10,
    "current": 1,
    "pages": 1
  }
}
```

#### 在用户端访问商品接口
##### 基础信息
- **接口名称**: 在用户端访问商品
- **接口路径**: `/api/product/product/visit/{id}`
- **请求方法**: GET
- **接口权限**: 任何用户登录后可访问
- **接口描述**: 在用户端点击被推送的商品可以访问该商品
- **接口实现**: 返回ProductDetailVO,这个类展示了商品详情页面的信息ProductProfileVO,
- 用户概要指向商户UserProfileVO,优惠券指向用户领取的生效的可用优惠券List<CouponVO>,商品规格是该商品的所有规格List<ProductSkuVO>,
- 用户端不应该访问被下架或删除的商品
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data":{
      "productProfileVO(ProductProfileVO)": {
        "id": 1,
        "userId": 10,
        "productSkuName": "蔡徐坤篮球",
        "name": "篮球",
        "categoryId": 1,
        "categoryName": "文具",
        "price": 50.00,
        "stock": 100,
        "sales": 100,
        "logo": "https://example.com/logo.png",
        "positiveComment": 10,
        "negativeComment": 0,
        "description": "篮球......",
        "status": 1,
        "createTime": "2025-10-21T12:17:56.000+00:00",
        "updateTime": "2025-10-21T12:18:00.000+00:00",
        "deleted": false
      },
      
      "userProfileVO(UserProfileVO)": {
        "id": 10,
        "username": "wddyxd",
        "nickName": "wddyxd",
        "avatar": "https://example.com/avatar.png"
      },
      
      "couponVO(List<CouponVO>)": [
        {
          "id": 1,
          "name": "蔡徐坤联名优惠券",
          "getType": 1,
          "targetType": 1,
          "isDiscount": 1,
          "targetId": 1,
          "threshold": 100.00,
          "value": 0.1,
          "stock": 100,
          "sendingStock": 10,
          "status": 1,
          "startTime": "2025-10-21T12:17:56.000+00:00",
          "endTime": "2025-10-21T12:17:56.000+00:00",
          "isDeleted": false,
          "createTime": "2025-10-21T12:17:56.000+00:00",
          "updateTime": "2025-10-21T12:18:00.000+00:00",

          "pointer": "优惠券指向的商户昵称或标明公用优惠券"
        }
      ],
      
      "productSkuVO(List<ProductSkuVO>)": [
        {
          "id": 1000,
          "productId": 1,
          "specs": "颜色:褐色,尺寸:L",
          "price": 50.00,
          "stock": 100,
          "sales": 100,
          "logo": "https://example.com/logo.png"
        }
      ]
  }
}
```

#### 查看商品详情接口
##### 基础信息
- **接口名称**: 查看商品详情
- **接口路径**: `/api/product/product/productDetail/{id}`
- **请求方法**: GET
- **接口权限**:需要product.list权限而且(访问者的id等于参数的userId或者访问者是管理员)
- **接口描述**: 查看商品的详细信息,商户端和管理端查看商品时访问该接口
- **接口实现**: 返回ProductDetailVO,这个类展示了商品详情页面的信息ProductProfileVO,
- 用户概要指向商户UserProfileVO,优惠券指向商品的所有可用优惠券List<CouponVO>,商品规格是该商品的所有规格List<ProductSkuVO>,
- 在商户端和后台可以访问被下架或删除的商品
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |


##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data":{
    "productProfileVO(ProductProfileVO)": {
      "id": 1,
      "userId": 10,
      "productSkuName": "蔡徐坤篮球",
      "name": "篮球",
      "categoryId": 1,
      "categoryName": "文具",
      "price": 50.00,
      "stock": 100,
      "sales": 100,
      "logo": "https://example.com/logo.png",
      "positiveComment": 10,
      "negativeComment": 0,
      "description": "篮球......",
      "status": 1,
      "createTime": "2025-10-21T12:17:56.000+00:00",
      "updateTime": "2025-10-21T12:18:00.000+00:00",
      "deleted": false
    },

    "userProfileVO(UserProfileVO)": {
      "id": 10,
      "username": "wddyxd",
      "nickName": "wddyxd",
      "avatar": "https://example.com/avatar.png"
    },

    "couponVO(List<CouponVO>)": [
      {
        "id": 1,
        "name": "蔡徐坤联名优惠券",
        "getType": 1,
        "targetType": 1,
        "isDiscount": 1,
        "targetId": 1,
        "threshold": 100.00,
        "value": 0.1,
        "stock": 100,
        "sendingStock": 10,
        "status": 1,
        "startTime": "2025-10-21T12:17:56.000+00:00",
        "endTime": "2025-10-21T12:17:56.000+00:00",
        "isDeleted": false,
        "createTime": "2025-10-21T12:17:56.000+00:00",
        "updateTime": "2025-10-21T12:18:00.000+00:00",

        "pointer": "优惠券指向的商户昵称或标明公用优惠券"
      }
    ],

    "productSkuVO(List<ProductSkuVO>)": [
      {
        "id": 1000,
        "productId": 1,
        "specs": "颜色:褐色,尺寸:L",
        "price": 50.00,
        "stock": 100,
        "sales": 100,
        "logo": "https://example.com/logo.png"
      }
    ]
  }
}
```

#### 添加商品接口
##### 基础信息
- **接口名称**: 增加商品
- **接口路径**: `/api/product/product/add`
- **请求方法**: POST
- **接口权限**: 需要product.add权限而且访问者的id等于参数的userId
- **接口描述**: 商户上架一件商品
- **接口实现**: 传入ProductAddDTO,先查询商品指向的商品分类是否存在,如果存在且没被逻辑删除则进入下一步,
- 在事务中，商品和规格需要互相引用 ID，但它们的 ID 在插入数据库前才能生成，这造成了依赖循环,
- 所以需要在操作数据库前手动生成ID的工作(这里采用mybatis_plus的雪花算法),
- 然后遍历规格,为每个规格设置productId,检查价格和规格的合法性,计算规格的总库存然后加到商品的总库存字段,
- 然后查看商品规格中第一个isDefault=true的规格,将这个规格的id赋给商品的productSkuId字段,
- 在插入前在redis插入添加商品的时间戳,过期时间5秒,下次访问接口时如果查询到该redis记录则直接返回
- 然后将商品和规格插入到数据库,数据库对没有处理的字段默认处理
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体 ProductAddDTO
```json
{
  "name": "篮球",
  "categoryId": 1,
  "description": "篮球......",
  "userId": 1,
  "productSku": [
    {
      "isDefault": true,
      "specs": "颜色:褐色,尺寸:L",
      "price": 50.00,
      "stock": 100,
      "logo": "https://example.com/logo.png",
      "skuCode": "BM-L"
    },
    {
      "...": "..."
    }
  ]
}
```

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": null
}
```

#### 修改商品内容接口
##### 基础信息
- **接口名称**: 修改商品内容
- **接口路径**: `/api/prodcut/product/update`
- **请求方法**: PUT
- **接口权限**: 需要product.update权限而且(访问者的id等于参数的userId或者访问者是管理员)
- **接口描述**: 在商品管理界面更新商品内容,但不同时更新规格的内容
- **接口实现**: 传入ProductBasicUpdateDTO,商品被逻辑删除则拒绝更新,查询到的商品存在不合法,不匹配的情况则拒绝更新
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体
```json
{
  "id": 1,
  "name": "篮球",
  "categoryId": 1,
  "description": "篮球......",
  "productSkuId": 1
}
```

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": null
}
```

#### 删除商品接口
##### 基础信息
- **接口名称**: 删除商品
- **接口路径**: `/api/prodcut/product/delete/{id}`
- **请求方法**: PUT
- **接口权限**: 需要product.delete权限而且(访问者的id等于参数的userId或者访问者是管理员)
- **接口描述**: 商家或管理员删除商品
- **接口实现**: 查询商品,如果商品的id和userId合法吻合则进入下一步,
- 查找商品和规格并进行逻辑删除,先删除商品,再删除商品的规格,回收用户持有的优惠券,并回收该商品的所有优惠券
- 商品或规格被逻辑删除则跳过
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": null
}
```

#### 下架/上架商品接口
##### 基础信息
- **接口名称**: 下架/上架商品
- **接口路径**: `/api/prodcut/product/status/{id}`
- **请求方法**: PUT
- **接口权限**: 需要product.update权限而且(访问者的id等于参数的userId或者访问者是管理员)
- **接口描述**: 下架/上架商品
- **接口实现**: 下架/上架商品,商品被逻辑删除则拒绝更新
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": null
}
```

### 商品分类相关接口 ProductCategoryController

#### 添加商品分类接口
##### 基础信息
- **接口名称**: 添加商品分类
- **接口路径**: `/api/product/productCategory/add`
- **请求方法**: POST
- **接口权限**:需要productCategory.add权限
- **接口描述**: 管理员可以在商品分类管理界面添加商品分类
- **接口实现**: 添加商品分类
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体
| 参数名        | 是否必填 | 数据类型    | 说明     | 示例    |
|------------|------|---------|--------|-------|
| name       | 是    | string  | 商品分类名  | 文具    |

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": null
}
```

#### 修改商品分类接口
##### 基础信息
- **接口名称**: 更新商品分类
- **接口路径**: `/api/product/productCategory/update`
- **请求方法**: PUT
- **接口权限**:需要productCategory.update权限
- **接口描述**: 管理员可以在商品分类管理界面更新商品分类信息
- **接口实现**: 更新商品分类信息,商品分类被逻辑删除则拒绝更新
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体
| 参数名        | 是否必填 | 数据类型    | 说明     | 示例    |
|------------|------|---------|--------|-------|
| name       | 是    | string  | 商品分类名  | 文具    |

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": null
}
```

#### 分页查询商品分类列表接口
##### 基础信息
- **接口名称**: 分页查询商品分类列表
- **接口路径**: `/api/product/productCategory/list`
- **请求方法**: GET
- **接口权限**: 需要productCategory.list权限
- **接口描述**: 在管理员的商品分类管理主界面查看所有存在的商品分类
- **接口实现**: 在管理员的商品分类主界面查看所有存在的权限,支持根据关键字搜索,
- 在mysql为分类名建立索引以支持关键字搜索
- 返回List<ProductCategory>并由PageResult包装
- 注意无论用户是否被逻辑删除都应该被被查到
- - **接口备注**:由于商品分类数量较少也只能根据模块分组
- ,所以后期也可以改为分组获取全部商品分类
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |


###### 请求体
| 参数名      | 是否必填    | 数据类型    | 说明    | 示例  |
|----------|---------|---------|-------|-----|
| pageNum  | 否(默认1)  | Integer | 页码    | 1   |
| pageSize | 否(默认10) | Integer | 每页数据量 | 10  |
| search   | 否(默认"") | string  | 关键字   | abc |


##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "records": [
      {
        "id": 1,
        "name": "文具",
        "code": "1111",
        "createTime": "2025-10-21T12:17:56.000+00:00",
        "updateTime": "2025-10-21T12:18:00.000+00:00",
        "deleted": false
      }
    ],
    "total": 1,
    "size": 10,
    "current": 1,
    "pages": 1
  }
}
```

#### 删除商品分类接口
##### 基础信息
- **接口名称**: 删除商品分类
- **接口路径**: `/api/user/productCategory/delete/{id}`
- **请求方法**: DELETE
- **接口权限**:需要productCategory.delete权限
- **接口描述**: 只有管理员有权限删除商品分类,删除商品分类按钮在商品分类管理界面
- **接口实现**: 删除商品分类包括根据id将product_category表的主键等于id的行逻辑删除,
- 不能删除"默认商品分类"即第一个分类,然后遍历商品,如果商品有该商品分类则将该商品分类变成"默认商品分类"
- 只有超级管理员才可以删除商品分类
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体
| 参数名         | 是否必填 | 数据类型    | 说明   | 示例                            |
|-------------|------|---------|------|-------------------------------|
| id          | 是    | Long    | id   | none                          |


##### 响应数据
###### 响应状态码
- 200: 删除成功
- 400: 请求参数错误
- 403: 权限不足（非管理员）
- 404: 用户不存在
- 409: 未满足删除前置条件，无法删除
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data":null
}
```

### 商品规格相关接口 ProductSkuController

#### 查看某商品的规格接口
##### 基础信息
- **接口名称**: 查看某商品的规格
- **接口路径**: `/api/product/productSku/list/{id}`
- **请求方法**: GET
- **接口权限**: 任何人登录后可访问
- **接口描述**: 查看某个商品的商品规格的详细信息,通常在调用商品详情接口中远程调用该接口
- **接口实现**: 查看某个商品的商品规格的详细信息,返回List<ProductSkuVO>,不能查询到被删除的商品规格
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": [
    {
      "id": 1000,
      "productId": 1,
      "specs": "颜色:褐色,尺寸:L",
      "price": 50.00,
      "stock": 100,
      "sales": 100,
      "logo": "https://example.com/logo.png"
    }
  ]
}
```

#### 添加商品规格接口
##### 基础信息
- **接口名称**: 添加商品规格
- **接口路径**: `/api/product/productSku/add`
- **请求方法**: POST
- **接口权限**: 需要product.list权限而且(访问者的id等于参数的userId或者访问者是管理员)
- **接口描述**: 在创建商品后编辑商品时可用
- **接口实现**: 传入ProductSkuDTO,添加商品规格后,要刷新商品的库存,注意商品规格要指向合法的商品
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体 ProductSkuDTO
```json
{
  "id?": null,
  "productId": 1,
  "specs": "颜色:褐色,尺寸:L",
  "price": 50.00,
  "stock": 100,
  "logo": "https://example.com/logo.png"
}
```

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": null
}
```

#### 修改商品规格接口
##### 基础信息
- **接口名称**: 更新商品分类
- **接口路径**: `/api/product/productSku/update`
- **请求方法**: PUT
- **接口权限**: 需要product.update权限而且(访问者的id等于参数的userId或者访问者是管理员)
- **接口描述**: 在创建商品后编辑商品时可用
- **接口实现**: 传入ProductSkuDTO,更新商品规格后,要刷新商品的库存,注意商品规格要指向合法的商品
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体 ProductSkuDTO
```json
{
  "id": 1,
  "productId": 1,
  "specs": "颜色:褐色,尺寸:L",
  "price": 50.00,
  "stock": 100,
  "logo": "https://example.com/logo.png"
}
```

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": null
}
```

#### 删除商品规格接口
##### 基础信息
- **接口名称**: 删除商品规格
- **接口路径**: `/api/prodcut/productSku/delete/{id}`
- **请求方法**: PUT
- **接口权限**: 需要product.delete权限而且(访问者的id等于参数的userId或者访问者是管理员)
- **接口描述**: 删除商品的规格
- **接口实现**: 删除商品的规格,但不能删除该商品的最后一个商品规格,
- 也不能删除商品的默认规格,如果规格无法指向具体商品则在删除后跳过,删除后修改商品库存
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": null
}
```

### 优惠券相关接口 CouponController

#### 分页查询优惠券列表接口
##### 基础信息
- **接口名称**: 分页获取优惠券列表
- **接口路径**: `/api/product/coupon/list`
- **请求方法**: GET
- **接口权限**: 需要coupon.list权限而且(访问者的id等于参数的userId或访问者是管理员)
- **接口描述**: 在后台和商户端的优惠券管理界面查看平台的所有优惠券或当前商户的优惠券
- **接口实现**: 传入CouponListDTO,在后台和商户端的商品管理界面查看所有存在的优惠券或当前商户的优惠券,
- 在mysql为优惠券名建立索引以支持关键字搜索
- 返回List<CouponVO>并由PageResult包装
- 注意无论优惠券是否被逻辑删除都应该被被查到
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |


###### 请求体 CouponListDTO
```json
{
  "pageNum?(DEFAULT 1)(Integer)": 1,
  "pageSize?(DEFAULT 10)(Integer)": 10,
  "search?(DEFAULT '')(String)": "",
  "userId?(DEFAULT -1)(Long)":-1,
  "productId?(DEFAULT -1)(Long)": -1
}
```

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "records": [
      {
        "id": 1,
        "name": "蔡徐坤联名优惠券",
        "getType": 1,
        "targetType": 1,
        "isDiscount": 1,
        "targetId": 1,
        "threshold": 100.00,
        "value": 0.1,
        "stock": 100,
        "sendingStock": 10,
        "status": 1,
        "startTime": "2025-10-21T12:17:56.000+00:00",
        "endTime": "2025-10-21T12:17:56.000+00:00",
        "isDeleted": false,
        "createTime": "2025-10-21T12:17:56.000+00:00",
        "updateTime": "2025-10-21T12:18:00.000+00:00",

        "pointer": "优惠券指向的商户昵称或标明公用优惠券"
      }
    ],
    "total": 1,
    "size": 10,
    "current": 1,
    "pages": 1
  }
}
```

#### 查看某商户的某商品可用的优惠券列表接口
##### 基础信息
- **接口名称**: 查看某商户的某商品可用的优惠券列表
- **接口路径**: `/api/product/coupon/detail/{id}`
- **请求方法**: GET
- **接口权限**: 需要coupon.list权限而且(访问者的id等于参数的userId或者访问者是管理员)
- **接口描述**: 查看商品详情接口调用该接口
- **接口实现**: 传入商品的id,返回List<CouponVO>,查看某商户的某商品的所有未过期未被删除的优惠券,
- 另外的,对于全场通用优惠券没有筛选条件,对于指定商户的优惠券返回该商户的优惠券,对于指定商品的优惠券返回该商品的优惠券
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": [
    {
      "id": 1,
      "name": "蔡徐坤联名优惠券",
      "getType": 1,
      "targetType": 1,
      "isDiscount": 1,
      "targetId": 1,
      "threshold": 100.00,
      "value": 0.1,
      "stock": 100,
      "sendingStock": 10,
      "status": 1,
      "startTime": "2025-10-21T12:17:56.000+00:00",
      "endTime": "2025-10-21T12:17:56.000+00:00",
      "isDeleted": false,
      "createTime": "2025-10-21T12:17:56.000+00:00",
      "updateTime": "2025-10-21T12:18:00.000+00:00",

      "pointer": "优惠券指向的商户昵称或标明公用优惠券"
    }
  ]
}
```

#### 查看某用户在某商品可用的优惠券列表接口
##### 基础信息
- **接口名称**: 查看某用户在某商品可用的优惠券列表
- **接口路径**: `/api/product/coupon/visit/{id}`
- **请求方法**: GET
- **接口权限**: 然后用户登录后可访问
- **接口描述**: 由访问商品接口调用该接口
- **接口实现**: 传入商品的id,返回List<CouponVO>,查看自己所有的已领取的未过期未被删除且未被使用的优惠券,
- 另外的,对于全场通用优惠券没有筛选条件,对于指定商户的优惠券返回该商户的优惠券,对于指定商品的优惠券返回该商品的优惠券
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": [
    {
      "id": 1,
      "name": "蔡徐坤联名优惠券",
      "getType": 1,
      "targetType": 1,
      "isDiscount": 1,
      "targetId": 1,
      "threshold": 100.00,
      "value": 0.1,
      "stock": 100,
      "sendingStock": 10,
      "status": 1,
      "startTime": "2025-10-21T12:17:56.000+00:00",
      "endTime": "2025-10-21T12:17:56.000+00:00",
      "isDeleted": false,
      "createTime": "2025-10-21T12:17:56.000+00:00",
      "updateTime": "2025-10-21T12:18:00.000+00:00",

      "pointer": "优惠券指向的商户昵称或标明公用优惠券"
    }
  ]
}
```

#### 添加优惠券接口
##### 基础信息
- **接口名称**: 添加优惠券
- **接口路径**: `/api/product/coupon/add`
- **请求方法**: POST
- **接口权限**: 需要coupon.add权限而且(访问者的id等于参数的userId或访问者是管理员)
- **接口描述**: 添加优惠券
- **接口实现**: 传入CouponDTO,添加优惠券,注意相关数据是正数值,如果targetId有效须判断指向对象是否没有被删除
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体 CouponDTO
```json
{
  "id?": null,
  "name": "优惠券名称",
  "getType": 1,
  "targetType": 1,
  "isDiscount": 1,
  "targetId?(DEFAULT 0)": 0,
  "threshold": 100.00,
  "value": 0.1,
  "startTime": "2025-10-21T12:17:56.000+00:00",
  "endTime": "2025-10-21T12:17:56.000+00:00",
  "stock": 100
}
```

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": null
}
```

#### 修改优惠券接口
##### 基础信息
- **接口名称**: 修改优惠券
- **接口路径**: `/api/product/coupon/update`
- **请求方法**: POST
- **接口权限**: 需要coupon.update权限而且(访问者的id等于参数的userId或访问者是管理员)
- **接口描述**: 修改优惠券
- **接口实现**: 传入CouponDTO,修改优惠券,注意相关数据是正数值,如果targetId有效须判断指向对象是否没有被删除
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体 CouponDTO
```json
{
  "id": 1,
  "name": "优惠券名称",
  "getType": 1,
  "targetType": 1,
  "isDiscount": 1,
  "targetId?(DEFAULT 0)": 0,
  "threshold": 100.00,
  "value": 0.1,
  "startTime": "2025-10-21T12:17:56.000+00:00",
  "endTime": "2025-10-21T12:17:56.000+00:00",
  "stock": 100
}
```



##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": null
}
```

#### 删除优惠券接口
##### 基础信息
- **接口名称**: 删除优惠券
- **接口路径**: `/api/prodcut/coupon/delete/{id}`
- **请求方法**: PUT
- **接口权限**: 需要coupon.delete权限而且(访问者的id等于参数的userId或访问者是管理员)
- **接口描述**: 删除优惠券
- **接口实现**: 删除优惠券,删除时先回收用户领取的优惠券,如果优惠券不是全场通用却没有绑定合法的商户或商品则删除后打日志
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": null
}
```

### 用户的优惠券相关接口 UserCouponController

#### 查询某用户领取的可用优惠券列表接口
##### 基础信息
- **接口名称**: 查询某用户领取的可用优惠券列表
- **接口路径**: `/api/product/userCoupon/list`
- **请求方法**: GET
- **接口权限**: 需要userCoupon.list权限且访问者的id等于参数的userId
- **接口描述**: 在用户端的个人中心的优惠券界面查看自己领取的优惠券
- **接口实现**: 返回List<UserCouponVO>,查看自己所有的已领取的未被删除的优惠券,
- 要保证用户领取的优惠券指向的优惠券合法
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体 List<UserCouponVO>
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": [
    {
      "id": 1,
      "name": "蔡徐坤联名优惠券",
      "getType": 1,
      "targetType": 1,
      "isDiscount": 1,
      "targetId": 1,
      "threshold": 100.00,
      "value": 0.1,
      "stock": 100,
      "sendingStock": 10,
      "status": 1,
      "startTime": "2025-10-21T12:17:56.000+00:00",
      "endTime": "2025-10-21T12:17:56.000+00:00",
      "isDeleted": false,
      "createTime": "2025-10-21T12:17:56.000+00:00",
      "updateTime": "2025-10-21T12:18:00.000+00:00",

      "pointer": "优惠券指向的商户昵称或标明公用优惠券",

      "getTime": "2025-10-21T12:17:56.000+00:00",
      "useTime": "2025-10-21T12:17:56.000+00:00",
      "orderId": 1,
      "use_status": 1
      
    }
  ]
}
```

#### 领取优惠券接口
##### 基础信息
- **接口名称**: 领取优惠券
- **接口路径**: `/api/product/userCoupon/add/{id}`
- **请求方法**: POST
- **接口权限**: 需要userCoupon.add权限且访问者的id等于参数的userId
- **接口描述**: 用户进行领取优惠券操作
- **接口实现**: 领取优惠券,只有在优惠券没被删除,在生效的时候才可执行操作,
- 要注意一人一券,就要试图解决高并发问题,然后要将优惠券的库存减少
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": null
}
```

#### 消费优惠券接口
##### 基础信息
- **接口名称**: 消费优惠券
- **接口路径**: `/api/product/userCoupon/consume/{id}/{orderId}`
- **请求方法**: POST
- **接口权限**: 需要userCoupon.update权限且访问者的id等于参数的userId
- **接口描述**: 用户在下单时进行优惠券的消费
- **接口实现**: 用户在下单时进行优惠券的消费,传入orderId后生成useTime,status代表该优惠券被消费
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": null
}
```

#### 回收用户领取的优惠券接口
##### 基础信息
- **接口名称**: 回收用户领取的优惠券
- **接口路径**: `/api/product/userCoupon/destroy/{id}`
- **请求方法**: POST
- **接口权限**: 需要userCoupon.delete权限
- **接口描述**: 由于一些原因,触发优惠券的删除,这时会回收用户领取的优惠券,在优惠券被删除时调用接口
- **接口实现**: 传入优惠券的id,批量逻辑删除该couponId指向的所有用户领取的优惠券,然后减去优惠券的库存
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |


##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": null
}
```

## 订单模块 order-service

### 订单相关接口 OrderMainController

#### 新增订单接口
##### 基础信息
- **接口名称**: 新增订单
- **接口路径**: `/api/order/orderMain/add`
- **请求方法**: POST
- **接口权限**: 需要order.add权限而且访问者的id等于参数的userId
- **接口描述**: 用户进行下单操作
- **接口实现**: 传入OrderAddDTO,将token信息和userId比对并检查用户是否可以正常使用,
- 然后查看指向的商品和规格是否存在,没被删除,在上架和在正常使用,
- 然后查看用户领取的优惠券指向的优惠券是否存在,未删除且在生效而且满足使用条件,
- 然后查询商品和商品规格,在生成的订单添加商品快照,然后减少商品和规格的库存,
- 然后在用户领取的优惠券标记优惠券已经使用,然后计算订单总价格和实际价格,
- 然后生成一份"待付款"的订单状态记录order_status_log,然后生成一份收货地址快照order_address.
- 要注意超卖问题,分布事务问题,并发性能问题,幂等性问题等.
- 添加订单备注,比如用了什么优惠券,
- 然后将该订单存入数据库. 
- 将该订单传入定时任务,如果15分钟没有付款就执行取消订单操作
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体 OrderAddDTO
```json
{
  "userId": 1,
  "productId": 1,
  "skuId": 1,
  "quantity": 1,
  "userCouponIds": [1]
}
```

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": null
}
```

#### 用户端分页查询订单列表接口
##### 基础信息
- **接口名称**: 用户端分页查询订单列表
- **接口路径**: `/api/order/orderMain/list/user`
- **请求方法**: GET
- **接口权限**: 需要order.list权限而且访问者的id等于参数的userId
- **接口描述**: 用户端在个人中心查看订单列表
- **接口实现**: 在用户端根据订单的状态(全部,未付款,待发货,待收货,已完成,已取消)来查询没有被删除的订单的列表,
- 当再次访问这个接口时前一次的返回结果会保留,
- 携带的用户信息是商家信息
- 返回List<OrderProfileVO>并由PageResult包装
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |


###### 请求体
| 参数名      | 是否必填    | 数据类型    | 说明    | 示例 |
|----------|---------|---------|-------|----|
| pageNum  | 否(默认1)  | Integer | 页码    | 1  |
| pageSize | 否(默认10) | Integer | 每页数据量 | 10 |
| status   | 是       | Integer | 订单状态  | 0  |



##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体 List<OrderProfileVO>
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "records": [
      {
        "id": 1,
        "userId": 1,
        "productId": 1,
        "skuId": 1,
        "quantity": 1,
        
        "productName": "商品名称",
        "skuSpecs": "商品规格",
        "logo": "商品图片",
        
        "totalPrice": 100,
        "payPrice": 90,
        
        "status": 0,
        "isDeleted": false,
        

        "userProfileVO": {
          "id": 1,
          "username": "wddyxd",
          "nickName": "wddyxd",
          "avatar": "https://example.com/avatar.png"
        }
      }
    ],
    "total": 1,
    "size": 10,
    "current": 1,
    "pages": 1
  }
}
```

#### 商户端分页查询订单列表接口
##### 基础信息
- **接口名称**: 用户端分页查询订单列表
- **接口路径**: `/api/order/orderMain/list/merchant`
- **请求方法**: GET
- **接口权限**: 需要order.list权限而且访问者的id等于参数的userId
- **接口描述**: 商户端在订单管理页面查看商家的所有商品的订单列表
- **接口实现**: 在商户端根据订单的状态, 
- 来查询没有被删除的订单的列表,
- 支持根据商户名称,购买者名称,商品名称和商品规格进行关键字检索
- - 携带的用户信息是用户信息
- 返回List<OrderProfileVO>并由PageResult包装
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |


###### 请求体
| 参数名      | 是否必填    | 数据类型    | 说明    | 示例 |
|----------|---------|---------|-------|----|
| pageNum  | 否(默认1)  | Integer | 页码    | 1  |
| pageSize | 否(默认10) | Integer | 每页数据量 | 10 |
| search   | 否(默认"") | String  | 关键字   | "" |




##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体 List<OrderProfileVO>
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "records": [
      {
        "id": 1,
        "userId": 1,
        "productId": 1,
        "skuId": 1,
        "quantity": 1,
        
        "productName": "商品名称",
        "skuSpecs": "商品规格",
        "logo": "商品图片",
        
        "totalPrice": 100,
        "payPrice": 90,
        
        "status": 0,
        "isDeleted": false,
        

        "userProfileVO": {
          "id": 1,
          "username": "wddyxd",
          "nickName": "wddyxd",
          "avatar": "https://example.com/avatar.png"
        }
      }
    ],
    "total": 1,
    "size": 10,
    "current": 1,
    "pages": 1
  }
}
```

#### 后台端分页查询订单列表接口
##### 基础信息
- **接口名称**: 后台端分页查询订单列表
- **接口路径**: `/api/order/orderMain/list/admin`
- **请求方法**: GET
- **接口权限**: 需要order.list权限
- **接口描述**: 后台端在订单管理页面查看网站的所有订单列表
- **接口实现**: 在后台端根据订单的状态,
- 来查询没有被删除的订单的列表,
- 支持根据商户名称,购买者名称,商品名称和商品规格进行关键字检索
- - 携带的用户信息是用户信息
- 返回List<OrderProfileVO>并由PageResult包装
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |


###### 请求体
| 参数名      | 是否必填    | 数据类型    | 说明    | 示例 |
|----------|---------|---------|-------|----|
| pageNum  | 否(默认1)  | Integer | 页码    | 1  |
| pageSize | 否(默认10) | Integer | 每页数据量 | 10 |
| search   | 否(默认"") | String  | 关键字   | "" |




##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体 List<OrderProfileVO>
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "records": [
      {
        "id": 1,
        "userId": 1,
        "productId": 1,
        "skuId": 1,
        "quantity": 1,
        
        "productName": "商品名称",
        "skuSpecs": "商品规格",
        "logo": "商品图片",
        
        "totalPrice": 100,
        "payPrice": 90,
        
        "status": 0,
        "isDeleted": false,

        "userProfileVO": {
          "id": 1,
          "username": "wddyxd",
          "nickName": "wddyxd",
          "avatar": "https://example.com/avatar.png"
        }
      }
    ],
    "total": 1,
    "size": 10,
    "current": 1,
    "pages": 1
  }
}
```

#### 查看订单详细信息接口
##### 基础信息
- **接口名称**: 查看订单详细信息
- **接口路径**: `/api/order/orderMain/orderDetail/{id}`
- **请求方法**: GET
- **接口权限**:需要order.list权限而且(访问者的id等于订单的userId或访问者是管理员)
- **接口描述**: 查看订单的详细信息,商户端和管理端点击订单时访问该接口
- **接口实现**: 返回OrderDetailVO,包括访问被下架或删除的订单
- **接口备注**:用户端不可访问
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体 OrderDetailVO
```json
{
  "code": 200,
  "msg": "操作成功",
  "data":{
    "order": {
      "id": 1,
      "userId": 1,
      "productId": 1,
      "skuId": 1,
      "quantity": 1,
      "totalPrice": 100,
      "payPrice": 90,
      "productName": "商品名称",
      "skuSpecs": "商品规格",
      "remark": "订单备注",
      "payMethod": 0,
      "status": 0,
      "isDeleted": false,
      "createTime": "2023-01-01 00:00:00",
      "updateTime": "2023-01-01 00:00:00"
    },
    "userProfileVOMap": {
      "buyer": {
        "userProfileVO": {
          "id": 1,
          "username": "wddyxd",
          "nickName": "wddyxd",
          "avatar": "https://example.com/avatar.png"
        }
      },
      "merchant": {
        "userProfileVO": {
          "id": 2,
          "username": "wddy",
          "nickName": "wddy",
          "avatar": "https://example.com/avatar.png"
        }
      }
    },
    "ProductProfileVO": {
      "...": "..."
    },
    "userCouponVO": [
      {
        "id": "user_coupon的主键id",
        "couponId": "coupon的主键id",
        "getTime": "2025-10-21T12:17:56.000+00:00",

        "name": "蔡徐坤联名优惠券",
        "getType": 1,
        "targetType": 1,
        "isDiscount": 1,
        "targetId": 1,
        "threshold": 100.00,
        "value": 0.1,
        "endTime": "2025-10-21T12:17:56.000+00:00",

        "merchantId": "优惠券指向的商户id",
        "nickName": "优惠券指向的商户昵称"

      }
    ],
    "orderAddress": {
      "id": 1,
      "orderId": 1,
      "userId": 1,
      "username": "wddyxd",
      "nickName": "wddyxd",
      "avatar": "https://example.com/avatar.png",
      "province": "北京",
      "city": "北京",
      "district": "北京",
      "address": "北京",
      "phone": "13888888888",
      "createTime": "2025-10-21T12:17:56.000+00:00",
      "updateTime": "2025-10-21T12:18:00.000+00:00",
      "deleted": false
    },
    "orderStatusLog": [
      {
        "id": 1,
        "orderId": 1,
        "operatorId": 1,
        "operateTime": "2025-10-21T12:17:56.000+00:00",
        "status": 0,
        "remark": "用户发起订单",
        "createTime": "2025-10-21T12:17:56.000+00:00",
        "updateTime": "2025-10-21T12:18:00.000+00:00",
        "deleted": false
      }
    ]
    
  }
}
```

#### 修改订单信息接口
##### 基础信息
- **接口名称**: 修改订单信息
- **接口路径**: `/api/order/orderMain/update`
- **请求方法**: PUT
- **接口权限**: order.update权限而且(访问者的id等于订单的userId或访问者是管理员)
- **接口描述**: 用户在订单状态改变后触发该接口
- **接口实现**: 传入OrderUpdateDTO,修改订单信息
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体
```json
{
  "id": 1,
  "status": 1,
  "payMethod": 1
}
```

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": null
}
```

### 订单状态相关接口 OrderStatusLogController

#### 订单支付接口
##### 基础信息
- **接口名称**: 订单支付
- **接口路径**: `/api/order/orderStatusLog/pay/{id}`
- **请求方法**: POST
- **接口权限**: 需要orderStatusLog.add权限
- **接口描述**: 用户支付订单
- **接口实现**: 传入订单id,检查订单是否处于 "待支付" 状态,直接生成order_status_log表,
- 后续接入支付服务器,然后调用修改订单接口,解决幂等性问题,调用新增财务接口
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": null
}
```

#### 订单发货接口
##### 基础信息
- **接口名称**: 订单发货
- **接口路径**: `/api/order/orderStatusLog/ship/{id}`
- **请求方法**: POST
- **接口权限**:需要orderStatusLog.add权限
- **接口描述**: 商家为订单发货
- **接口实现**: 传入订单id,检查订单是否处于 "已支付" 状态,直接生成order_status_log表,
- 然后调用修改订单接口,解决幂等性问题
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": null
}
```

#### 订单收货接口
##### 基础信息
- **接口名称**: 订单收货
- **接口路径**: `/api/order/orderStatusLog/receive/{id}`
- **请求方法**: POST
- **接口权限**:需要orderStatusLog.add权限
- **接口描述**: 用户为订单收货
- **接口实现**: 传入订单id,检查订单是否处于 "已发货" 状态,直接生成order_status_log表,
- 然后调用修改订单接口,解决幂等性问题
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": null
}
```

#### 取消订单接口
##### 基础信息
- **接口名称**: 取消订单
- **接口路径**: `/api/order/orderStatusLog/cancel/{id}`
- **请求方法**: POST
- **接口权限**:需要orderStatusLog.add权限
- **接口描述**: 订单超时为支付时触发
- **接口实现**: 传入订单id,检查订单是否处于 "待支付" 状态,直接生成order_status_log表,
- 然后恢复商品规格库存,然后退还优惠券给用户,然后调用修改订单接口,解决幂等性问题
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": null
}
```

#### 订单退货接口
##### 基础信息
- **接口名称**: 订单退货
- **接口路径**: `/api/order/orderStatusLog/rollback/{id}`
- **请求方法**: POST
- **接口权限**:需要orderStatusLog.add权限
- **接口描述**: 用户主动退货或商家被迫退货触发
- **接口实现**: 传入订单id,检查订单是否不是处于 "待支付" 状态,直接生成order_status_log表,
- 然后将已支付的钱退回给用户,然后恢复商品规格库存,然后退还优惠券给用户,然后调用修改订单接口,解决幂等性问题
- 不编写退货后退回已收货的商品的业务逻辑
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": null
}
```

#### 列出订单状态接口
##### 基础信息
- **接口名称**: 列出订单状态
- **接口路径**: `/api/order/orderStatusLog/list/{id}`
- **请求方法**: GET
- **接口权限**: 需要orderStatusLog.list权限
- **接口描述**: 查看订单的详细信息时调用该接口
- **接口实现**: 传入订单id返回List<OrderStatusLog>
- **接口备注**: 用户端不可访问
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体 List<OrderStatusLog>
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": [
    {
      "id": 1,
      "orderId": 1,
      "operatorId": 1,
      "operateTime": "2025-10-21T12:17:56.000+00:00",
      "status": 0,
      "remark": "用户发起订单",
      "createTime": "2025-10-21T12:17:56.000+00:00",
      "updateTime": "2025-10-21T12:18:00.000+00:00",
      "deleted": false
    }
  ]
}
```

### 订单地址快照相关接口 OrderAddressController

#### 新增订单地址接口
##### 基础信息
- **接口名称**: 新增订单地址
- **接口路径**: `/api/order/orderAddress/add`
- **请求方法**: POST
- **接口权限**: 需要order.add权限而且访问者的id等于参数的userId
- **接口描述**: 用户在下单时调用该接口
- **接口实现**: 根据token得到用户信息,从而得到默认地址并生成订单地址
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": null
}
```

#### 修改订单地址接口
##### 基础信息
- **接口名称**: 修改订单地址
- **接口路径**: `/api/order/orderAddress/update/{id}`
- **请求方法**: PUT
- **接口权限**: 需要order.update权限而且访问者的id等于参数的userId
- **接口描述**: 用户可用在订单收货前修改订单地址
- **接口实现**: 传入用户地址id,从而修改订单地址
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": null
}
```

#### 查询特定订单地址接口
##### 基础信息
- **接口名称**: 查询特定订单地址
- **接口路径**: `/api/order/orderAddress/detail/{id}`
- **请求方法**: PUT
- **接口权限**: 需要order.list权限而且(访问者的id等于参数的userId或访问者是管理员)
- **接口描述**: 查询订单的唯一的订单地址
- **接口实现**: 传入订单id,从而查询订单地址OrderAddress
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体 OrderAddress
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": "..."
}
```

### 财务接口 FinancialFlowController

#### 新增财务接口
##### 基础信息
- **接口名称**: 新增财务
- **接口路径**: `/api/order/financialFlow/add`
- **请求方法**: POST
- **接口权限**: 非基础角色登录后可用
- **接口描述**: 用户访问涉及支付的接口时调用该接口
- **接口实现**: 生成财务
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |

###### 请求体 FinancialFlowDTO
```json
{
  "tradeType": 2,
  "amount": 100.00
}
```

##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": null
}
```

#### 分页查询财务接口
##### 基础信息
- **接口名称**: 后台端分页查询财务
- **接口路径**: `/api/order/financialFlow/list`
- **请求方法**: GET
- **接口权限**: 需要order.list权限
- **接口描述**: 后台端在订单管理页面查看网站的所有财务列表
- **接口实现**: 后台端在订单管理页面查看网站的所有财务列表
- 返回List<FinancialFlow>并由PageResult包装
##### 请求参数
###### 请求头
| 参数名          | 是否必填 | 数据类型   | 说明    | 示例                                      |
|--------------|------|--------|-------|-----------------------------------------|
| Content-Type | 是    | string | 请求体类型 | application/json                        |
| token        | 是    | string | 令牌    | eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... |


###### 请求体
| 参数名      | 是否必填    | 数据类型    | 说明    | 示例 |
|----------|---------|---------|-------|----|
| pageNum  | 否(默认1)  | Integer | 页码    | 1  |
| pageSize | 否(默认10) | Integer | 每页数据量 | 10 |
| search   | 否(默认"") | String  | 关键字   | "" |




##### 响应数据
###### 响应状态码
- 200: 请求成功
- 400: 请求参数错误
- 500: 服务器错误

###### 响应体
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "records": [
      {
        "...": "..."
      }
    ],
    "total": 1,
    "size": 10,
    "current": 1,
    "pages": 1
  }
}
```
