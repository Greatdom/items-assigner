# 数据库设计文档（MySQL）

## 用户表

### 1.用户主表（user）
| 字段名         | 类型               | 属性        | 说明              |
|-------------|------------------|-----------|-----------------|
| id          | bigint           | 主键，自增     | 主键              |
| username    | varchar(20)      | 非空，唯一     | 登录用户名           |
| phone       | varchar(20)      | 非空，唯一     | 手机号             |
| email       | varchar(30)      | 非空，唯一     | 邮箱              |
| password    | varchar(32)      | 非空        | 加密密码            |
| nick_name   | varchar(50)      | 非空        | 昵称/店铺名          |
| avatar      | varchar(255)     | 默认空       | 头像URL           |
| status      | tinyint unsigned | 非空        | 0-禁用 1-正常 2-待审核 |
| is_deleted  | tinyint unsigned | 非空        | 0-未删除 1-已删除     |
| create_time | datetime         | 非空，默认当前时间 | 创建时间            |
| update_time | datetime         | 非空，自动刷新   | 更新时间            |

### 2.用户角色表（role）
| 字段名         | 类型               | 属性        | 说明          |
|-------------|------------------|-----------|-------------|
| id          | bigint           | 主键，自增     | 主键          |
| role_name   | varchar(20)      | 非空，唯一     | 角色名称        |
| role_code   | varchar(20)      | 默认空       | 角色编码        |
| remark      | varchar(255)     | 默认空       | 备注          |
| is_deleted  | tinyint unsigned | 非空        | 0-未删除 1-已删除 |
| create_time | datetime         | 非空，默认当前时间 | 创建时间        |
| update_time | datetime         | 非空，自动刷新   | 更新时间        |

### 3.用户角色关系表（user_role）
| 字段名         | 类型               | 属性        | 说明          |
|-------------|------------------|-----------|-------------|
| id          | bigint           | 主键，自增     | 主键          |
| role_id     | bigint           | 非空        | 角色id        |
| user_id     | bigint           | 非空        | 用户id        |
| is_deleted  | tinyint unsigned | 非空        | 0-未删除 1-已删除 |
| create_time | datetime         | 非空，默认当前时间 | 创建时间        |
| update_time | datetime         | 非空，自动刷新   | 更新时间        |

### 4.用户权限表（permissions）
| 字段名              | 类型               | 属性        | 说明          |
|------------------|------------------|-----------|-------------|
| id               | bigint           | 主键，自增     | 主键          |
| name             | varchar(20)      | 非空，唯一     | 权限名称        |
| permission_value | varchar(50)      | 默认空       | 权限值         |
| is_deleted       | tinyint unsigned | 非空        | 0-未删除 1-已删除 |
| create_time      | datetime         | 非空，默认当前时间 | 创建时间        |
| update_time      | datetime         | 非空，自动刷新   | 更新时间        |

### 5.用户权限关系表（role_permissions）
| 字段名            | 类型               | 属性        | 说明          |
|----------------|------------------|-----------|-------------|
| id             | bigint           | 主键，自增     | 主键          |
| role_id        | bigint           | 非空        | 角色id        |
| permissions_id | bigint           | 非空        | 权限id        |
| is_deleted     | tinyint unsigned | 非空        | 0-未删除 1-已删除 |
| create_time    | datetime         | 非空，默认当前时间 | 创建时间        |
| update_time    | datetime         | 非空，自动刷新   | 更新时间        |


### 6. 用户明细表（user_detail）
| 字段名                 | 类型               | 属性        | 说明           |
|---------------------|------------------|-----------|--------------|
| id                  | bigint           | 主键，自增     | 主键           |
| user_id             | bigint           | 非空，唯一     | 关联user.id    |
| real_name           | varchar(50)      | 默认空       | 真实姓名         |
| gender              | tinyint          | 默认0       | 0-未知 1-男 2-女 |
| birthday            | date             | 默认NULL    | 生日           |
| region              | varchar(100)     | 默认空       | 地区           |
| id_card             | varchar(20)      | 默认空，加密    | 身份证号         |
| is_id_card_verified | tinyint unsigned | 非空        | 0-未认证 1-已认证  |
| last_login_ip       | varchar(50)      | 默认空       | 上次登录IP       |
| last_login_time     | datetime         | 默认NULL    | 上次登录时间       |
| money               | decimal(10, 2)   | 默认0.00    | 账户余额-不适用管理员  |
| is_deleted          | tinyint unsigned | 非空        | 0-未删除 1-已删除  |
| create_time         | datetime         | 非空，默认当前时间 | 创建时间         |
| update_time         | datetime         | 非空，自动刷新   | 更新时间         |

### 7.商户补强表
| 字段名                | 类型               | 属性        | 说明           |
|--------------------|------------------|-----------|--------------|
| id                 | bigint           | 主键，自增     | 主键           |
| user_id            | bigint           | 非空        | 关联user.id    |
| shop_address       | varchar(255)     | 非空        | 店铺地址         |
| shop_license       | varchar(255)     | 默认空       | 营业执照ID       |
| shop_license_image | varchar(255)     | 默认空       | 营业执照图片ID     |
| shop_star          | tinyint unsigned | 默认0       | 开始时为0代表空，1~5 |
| shop_status        | tinyint unsigned | 默认0       | 0-开张 1-关闭    |
| is_deleted         | tinyint unsigned | 非空        | 0-未删除 1-已删除  |
| create_time        | datetime         | 非空，默认当前时间 | 创建时间         |
| update_time        | datetime         | 非空，自动刷新   | 更新时间         |


### 8. 用户地址表（user_address）
| 字段名         | 类型               | 属性        | 说明          |
|-------------|------------------|-----------|-------------|
| id          | bigint           | 主键，自增     | 主键          |
| user_id     | bigint           | 非空        | 关联user.id   |
| receiver    | varchar(50)      | 非空        | 收货人姓名       |
| phone       | varchar(20)      | 非空        | 收货人手机       |
| province    | varchar(20)      | 非空        | 省份          |
| city        | varchar(20)      | 非空        | 城市          |
| district    | varchar(20)      | 非空        | 区县          |
| address     | varchar(255)     | 非空        | 详细地址        |
| is_default  | tinyint unsigned | 非空，默认0    | 0-非默认 1-默认  |
| is_deleted  | tinyint unsigned | 非空        | 0-未删除 1-已删除 |
| create_time | datetime         | 非空，默认当前时间 | 创建时间        |
| update_time | datetime         | 非空，自动刷新   | 更新时间        |


---

## 商品模块

### 1. 商品表（product）
| 字段名         | 类型               | 属性        | 说明          |
|-------------|------------------|-----------|-------------|
| id          | bigint           | 主键，自增     | 主键          |
| name        | varchar(100)     | 非空        | 商品名称        |
| price       | decimal(10,2)    | 非空        | 售价          |
| stock       | int              | 非空，默认0    | 库存          |
| category_id | bigint           | 非空        | 关联分类表       |
| description | text             | 默认空       | 商品描述        |
| logo        | varchar(255)     | 默认空       | 主图URL       |
| user_id     | bigint           | 非空        | 上架商户ID      |
| status      | tinyint unsigned | 非空        | 0-下架 1-上架   |
| is_deleted  | tinyint unsigned | 非空        | 0-未删除 1-已删除 |
| create_time | datetime         | 非空，默认当前时间 | 创建时间        |
| update_time | datetime         | 非空，自动刷新   | 更新时间        |

### 2. 商品分类表（product_category）
| 字段名         | 类型               | 属性        | 说明          |
|-------------|------------------|-----------|-------------|
| id          | bigint           | 主键，自增     | 主键          |
| name        | varchar(50)      | 非空        | 分类名称        |
| code        | varchar(30)      | 非空，唯一     | 分类标识        |
| is_deleted  | tinyint unsigned | 非空        | 0-未删除 1-已删除 |
| create_time | datetime         | 非空，默认当前时间 | 创建时间        |
| update_time | datetime         | 非空，自动刷新   | 更新时间        |

### 3. 商品规格表（product_sku）
| 字段名         | 类型               | 属性        | 说明            |
|-------------|------------------|-----------|---------------|
| id          | bigint           | 主键，自增     | 主键            |
| product_id  | bigint           | 非空        | 关联商品ID        |
| specs       | varchar(100)     | 非空        | 规格描述，如“红色-XL” |
| price       | decimal(10,2)    | 非空        | 规格售价          |
| stock       | int              | 非空，默认0    | 规格库存          |
| sku_code    | varchar(50)      | 非空，唯一     | 规格编码          |
| is_deleted  | tinyint unsigned | 非空        | 0-未删除 1-已删除   |
| create_time | datetime         | 非空，默认当前时间 | 创建时间          |
| update_time | datetime         | 非空，自动刷新   | 更新时间          |

### 4. 商品活动优惠表（product_discount）

---

## 订单模块

### 1. 订单详情表（order_item）
| 字段名          | 类型               | 属性        | 说明          |
|--------------|------------------|-----------|-------------|
| id           | bigint           | 主键，自增     | 主键          |
| order_id     | bigint           | 非空        | 订单ID        |
| product_id   | bigint           | 非空        | 商品ID        |
| sku_id       | bigint           | 非空        | 规格ID，无规格为0  |
| quantity     | int              | 非空，默认1    | 购买数量        |
| unit_price   | decimal(10,2)    | 非空        | 下单单价        |
| total_price  | decimal(10,2)    | 非空        | 小计金额        |
| product_name | varchar(100)     | 非空        | 商品名称快照      |
| sku_specs    | varchar(100)     | 默认空       | 规格快照        |
| is_deleted   | tinyint unsigned | 非空        | 0-未删除 1-已删除 |
| create_time  | datetime         | 非空，默认当前时间 | 创建时间        |
| update_time  | datetime         | 非空，自动刷新   | 更新时间        |

### 2. 订单地址表（order_address）
| 字段名         | 类型               | 属性        | 说明          |
|-------------|------------------|-----------|-------------|
| id          | bigint           | 主键，自增     | 主键          |
| order_id    | bigint           | 非空        | 订单ID        |
| user_id     | bigint           | 非空        | 下单用户ID      |
| receiver    | varchar(50)      | 非空        | 收货人姓名       |
| phone       | varchar(20)      | 非空        | 收货人手机       |
| province    | varchar(20)      | 非空        | 省份          |
| city        | varchar(20)      | 非空        | 城市          |
| district    | varchar(20)      | 非空        | 区县          |
| address     | varchar(255)     | 非空        | 详细地址        |
| is_deleted  | tinyint unsigned | 非空        | 0-未删除 1-已删除 |
| create_time | datetime         | 非空，默认当前时间 | 创建时间        |
| update_time | datetime         | 非空，自动刷新   | 更新时间        |

### 3. 订单状态日志表（order_status_log）
| 字段名          | 类型               | 属性        | 说明                            |
|--------------|------------------|-----------|-------------------------------|
| id           | bigint           | 主键，自增     | 主键                            |
| order_id     | bigint           | 非空        | 订单ID                          |
| operator_id  | bigint           | 默认0       | 0-系统，其他为用户/商户/管理员ID           |
| status       | tinyint unsigned | 非空        | 0-待付款 1-待发货 2-待收货 3-已完成 4-已取消 |
| pay_method   | tinyint unsigned | 非空        | 0-未选择 1-微信支付 2-支付宝支付          |
| ship_time    | datetime         | 默认空       | 发货时间                          |
| receive_time | datetime         | 默认空       | 收货时间                          |
| cancel_time  | datetime         | 默认空       | 取消时间                          |
| remark       | varchar(255)     | 默认空       | 状态变更说明                        |
| is_deleted   | tinyint unsigned | 非空        | 0-未删除 1-已删除                   |
| create_time  | datetime         | 非空，默认当前时间 | 创建时间                          |
| update_time  | datetime         | 非空，自动刷新   | 更新时间                          |

### 4.订单主表
| 字段名         | 类型               | 属性        | 说明                 |
|-------------|------------------|-----------|--------------------|
| id          | bigint           | 主键，自增     | 主键                 |
| user_id     | bigint           | 非空        | 下单用户ID             |
| total_price | decimal(10,2)    | 非空        | 订单总金额              |
| pay_price   | decimal(10,2)    | 非空        | 实际支付金额             |
| remark      | varchar(255)     | 默认空       | 订单备注(比如优惠明细，发货要求等) |
| is_deleted  | tinyint unsigned | 非空        | 0-未删除 1-已删除        |
| create_time | datetime         | 非空，默认当前时间 | 创建时间               |
| update_time | datetime         | 非空，自动刷新   | 更新时间               |

### 5. 订单评价表（order_comment）
| 字段名               | 类型               | 属性        | 说明                              |
|-------------------|------------------|-----------|---------------------------------|
| id                | bigint           | 主键，自增     | 主键                              |
| is_follow_comment | tinyint unsigned | 非空，默认 0   | 0 - 不是追评 1 - 是追评                |
| comment_id        | bigint           | 非空        | 被跟评的ID-启用时order_item_id失效       |
| order_item_id     | bigint           | 非空        | 关联 order.id（确保评价对应具体子订单）        |
| product_id        | bigint           | 非空        | 关联 product.id（商品 ID）            |
| sku_id            | bigint           | 非空        | 关联 product_sku.id（规格 ID，无规格为 0） |
| user_id           | bigint           | 非空        | 评价用户 ID（关联 user.id）             |
| score             | tinyint unsigned | 非空        | 评分（1-5 分）                       |
| content           | text             | 默认空       | 评价内容                            |
| images            | varchar(255)     | 默认空       | 评价图片-支持单图 URL                   |
| is_anonymous      | tinyint unsigned | 非空，默认 0   | 0 - 非匿名 1 - 匿名                  |
| is_deleted        | tinyint unsigned | 非空        | 0-未删除 1-已删除                     |
| create_time       | datetime         | 非空，默认当前时间 | 创建时间                            |
| update_time       | datetime         | 非空，自动刷新   | 更新时间                            |

### 6. 售后单表(after_sale)
| 字段名           | 类型               | 属性        | 说明                                                      |
|---------------|------------------|-----------|---------------------------------------------------------|
| id            | bigint           | 主键，自增     | 主键（售后单 ID）                                              |
| after_sale_no | varchar(50)      | 非空，唯一     | 售后单号（业务标识，如 AS20240520xxxx）                             |
| order_id      | bigint           | 非空        | 关联 order.id（主订单 ID）                                     |
| order_item_id | bigint           | 非空        | 关联 order_item.id（关联具体订单项，支持部分售后）                        |
| user_id       | bigint           | 非空        | 申请人 ID（关联 user.id）                                      |
| type          | tinyint unsigned | 非空        | 售后类型（0 - 仅退款 1 - 退货退款 2 - 换货）                           |
| reason        | varchar(255)     | 非空        | 售后原因                                                    |
| description   | text             | 默认空       | 详细描述                                                    |
| images        | varchar(1000)    | 默认空       | 凭证图片 URL（多图用逗号分隔）                                       |
| amount        | decimal(10,2)    | 非空        | 申请金额（退款 / 赔偿金额）                                         |
| status        | tinyint unsigned | 非空        | 处理状态（0 - 待审核 1 - 审核通过 2 - 审核拒绝 3 - 处理中 4 - 已完成 5 - 已取消） |
| handler_id    | bigint           | 默认 0      | 处理人 ID（0 - 系统 其他为管理员 / 商户 ID）                           |
| handle_time   | datetime         | 默认 NULL   | 处理完成时间                                                  |
| handle_remark | varchar(255)     | 默认空       | 处理备注（如拒绝原因）                                             |
| is_deleted    | tinyint unsigned | 非空        | 0 - 未删除 1 - 已删除                                         |
| create_time   | datetime         | 非空，默认当前时间 | 创建时间                                                    |
| update_time   | datetime         | 非空，自动刷新   | 更新时间                                                    |

---

## 购物车与优惠券

### 1. 购物车表（shopping_cart）
| 字段名         | 类型               | 属性        | 说明          |
|-------------|------------------|-----------|-------------|
| id          | bigint           | 主键，自增     | 主键          |
| user_id     | bigint           | 非空        | 用户ID        |
| product_id  | bigint           | 非空        | 商品ID        |
| sku_id      | bigint           | 非空        | 规格ID，无规格为0  |
| quantity    | int              | 非空，默认1    | 商品数量        |
| is_selected | tinyint unsigned | 非空，默认1    | 0-未选中 1-选中  |
| is_deleted  | tinyint unsigned | 非空        | 0-未删除 1-已删除 |
| create_time | datetime         | 非空，默认当前时间 | 创建时间        |
| update_time | datetime         | 非空，自动刷新   | 更新时间        |

### 2. 优惠券表（coupon）
| 字段名             | 类型               | 属性        | 说明                       |
|-----------------|------------------|-----------|--------------------------|
| id              | bigint           | 主键，自增     | 主键                       |
| name            | varchar(100)     | 非空        | 优惠券名称                    |
| get_type        | tinyint unsigned | 非空        | 0-满减 1-折扣                |
| target_type     | tinyint unsigned | 非空        | 0-全场通用 1-指定商户可用 2-指定商品可用 |
| is_discount     | tinyint unsigned | 默认0       | 0-通用 1-商品优惠时不可用          |
| target_id       | bigint           | 非空        | 优惠券目标ID，无指定为0            |
| threshold       | decimal(10,2)    | 非空，默认0    | 使用门槛                     |
| value           | decimal(10,2)    | 非空        | 优惠值（满减为金额，折扣为百分比）        |
| start_time      | datetime         | 非空        | 生效时间                     |
| end_time        | datetime         | 非空        | 失效时间                     |
| stock           | int              | 非空，默认0    | 发放总量                     |
| remaining_stock | int              | 非空，默认0    | 剩余数量                     |
| status          | tinyint unsigned | 非空        | 0-未生效 1-生效中 2-已过期        |
| is_deleted      | tinyint unsigned | 非空        | 0-未删除 1-已删除              |
| create_time     | datetime         | 非空，默认当前时间 | 创建时间                     |
| update_time     | datetime         | 非空，自动刷新   | 更新时间                     |

### 3. 用户优惠券表（user_coupon）
| 字段名         | 类型               | 属性        | 说明                |
|-------------|------------------|-----------|-------------------|
| id          | bigint           | 主键，自增     | 主键                |
| user_id     | bigint           | 非空        | 用户ID              |
| coupon_id   | bigint           | 非空        | 优惠券ID             |
| get_time    | datetime         | 非空，默认当前时间 | 领取时间              |
| use_time    | datetime         | 默认NULL    | 使用时间              |
| order_id    | bigint           | 默认NULL    | 使用订单ID            |
| status      | tinyint unsigned | 非空        | 0-未使用 1-已使用 2-已过期 |
| is_deleted  | tinyint unsigned | 非空        | 0-未删除 1-已删除       |
| create_time | datetime         | 非空，默认当前时间 | 创建时间              |
| update_time | datetime         | 非空，自动刷新   | 更新时间              |

---

## 财务模块

### 1. 财务流水表（financial_flow）
| 字段名         | 类型               | 属性        | 说明                           |
|-------------|------------------|-----------|------------------------------|
| id          | bigint           | 主键，自增     | 主键                           |
| user_id     | bigint           | 非空        | 用户ID --所有角色通用                |
| trade_type  | tinyint unsigned | 非空        | 0-充值 1-提现 2-订单支付 3-退款 4-平台佣金 |
| amount      | decimal(10,2)    | 非空        | 正数收入，负数支出                    |
| trade_no    | varchar(50)      | 非空，唯一     | 交易单号                         |
| status      | tinyint unsigned | 非空        | 0-处理中 1-成功 2-失败              |
| remark      | varchar(255)     | 默认空       | 交易备注                         |
| is_deleted  | tinyint unsigned | 非空        | 0-未删除 1-已删除                  |
| create_time | datetime         | 非空，默认当前时间 | 创建时间                         |
| update_time | datetime         | 非空，自动刷新   | 更新时间                         |

### 2.网站明细表（site_detail）
| 字段名         | 类型               | 属性        | 说明        |
|-------------|------------------|-----------|-----------|
| web_name    | varchar(50)      | 非空        | 网站名称      |
| web_url     | varchar(255)     | 非空        | 网站URL     |
| web_logo    | varchar(255)     | 默认空       | 网站logo    |
| web_desc    | varchar(255)     | 默认空       | 网站描述      |
| web_money   | decimal(10,2)    | 默认0       | 网站余额      |
| web_status  | tinyint unsigned | 非空        | 0-正常 1-维护 |
| create_time | datetime         | 非空，默认当前时间 | 创建时间      |
| update_time | datetime         | 非空，自动刷新   | 更新时间      |

---

## 聊天模块
### 1. 聊天记录表（chat_record）

### 2. 语句表（chat_sentence）

### 3.网站处理事项表 （site_handle）

### 4.系统信息及公告表 （system_info）